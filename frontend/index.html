<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FOLIO Enrich</title>
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #242836;
    --surface3: #2e3348;
    --border: #2e3348;
    --text: #e4e6f0;
    --text-dim: #8b8fa3;
    --accent: #6c8cff;
    --accent-dim: #4a5fa0;
    --green: #4caf7c;
    --orange: #e8a54c;
    --red: #e05555;
    --cyan: #5ec4d4;
    --purple: #b07ee8;
    --highlight: rgba(108,140,255,0.15);
    --highlight-confirmed: rgba(108,140,255,0.22);
    --highlight-preliminary: rgba(108,140,255,0.08);
    --highlight-rejected: rgba(224,85,85,0.08);

    /* Branch colors */
    --branch-actor: #5ec4d4;
    --branch-area-of-law: #e8a54c;
    --branch-document: #b07ee8;
    --branch-engagement: #4caf7c;
    --branch-event: #e05555;
    --branch-location: #6c8cff;
    --branch-governmental: #e887a0;
    --branch-legal-entity: #7bed9f;
    --branch-industry: #f0c040;
    --branch-service: #50c8ff;
    --branch-default: #8b8fa3;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow: hidden;
  }

  /* Header */
  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 10px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    height: 48px;
    flex-shrink: 0;
    overflow: visible;
    position: relative;
    z-index: 50;
  }

  header h1 { font-size: 18px; font-weight: 600; letter-spacing: -0.3px; white-space: nowrap; }
  header h1 span { color: var(--accent); }

  .status-bar {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-left: 8px;
    flex-shrink: 1;
    min-width: 0;
  }

  .status-chip {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px;
    border-radius: 4px;
    background: var(--surface2);
    border: 1px solid var(--border);
    font-size: 11px;
    color: var(--text-dim);
    white-space: nowrap;
    cursor: default;
    transition: border-color 0.2s;
    position: relative;
  }

  .status-chip:hover { border-color: var(--accent-dim); }

  .status-chip .chip-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .status-chip .chip-dot.green { background: var(--green); }
  .status-chip .chip-dot.orange { background: var(--orange); }
  .status-chip .chip-dot.red { background: var(--red); }
  .status-chip .chip-dot.gray { background: #555; }
  .status-chip .chip-dot.blue { background: var(--accent); }

  .status-chip .chip-label { font-weight: 500; color: var(--text); }
  .status-chip .chip-detail { color: var(--text-dim); }

  /* Tooltip for status chips — use fixed positioning to avoid layout shift */
  .status-chip[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: fixed;
    top: 44px;
    left: auto;
    background: var(--surface3);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 11px;
    color: var(--text);
    white-space: nowrap;
    z-index: 100;
    pointer-events: none;
  }

  .header-right {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
  }

  .status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--green);
    display: inline-block;
  }

  .status-dot.disconnected { background: var(--red); }

  .header-btn {
    background: var(--surface2);
    color: var(--text-dim);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px 12px;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.15s;
  }

  .header-btn:hover { border-color: var(--accent-dim); color: var(--text); }

  /* Main layout */
  main {
    display: grid;
    grid-template-columns: minmax(350px, 1fr) minmax(400px, 1.5fr);
    gap: 0;
    height: calc(100vh - 48px);
  }

  .panel {
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .panel-left { border-right: 1px solid var(--border); }

  .panel-header {
    padding: 10px 16px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
  }

  .panel-header h2 {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-dim);
  }

  .panel-body {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
  }

  /* Right panel: light mode via CSS variable overrides — cascades to all children */
  .panel-right {
    --bg: #ffffff;
    --surface: #f5f6f8;
    --surface2: #ecedf1;
    --surface3: #e2e4ea;
    --border: #d0d2da;
    --text: #1a1a2e;
    --text-dim: #6b6b80;
    --accent: #3b64e0;
    --accent-dim: #5a7ae8;
    --green: #16a34a;
    --orange: #d97706;
    --red: #dc2626;
    --cyan: #0891b2;
    --purple: #7c3aed;
    --highlight: rgba(59,100,224,0.10);
    --highlight-confirmed: rgba(59,100,224,0.15);
    background: var(--bg);
    color: var(--text);
  }

  .panel-right .panel-body { background: var(--bg); color: var(--text); }
  .panel-right .panel-body::-webkit-scrollbar-thumb { background: #c0c0cc; }
  .panel-right .panel-body::-webkit-scrollbar-thumb:hover { background: #9090a0; }

  /* Right-panel p style overrides (inline styles from JS) */
  .panel-right .panel-body p[style] { color: #6b6b80 !important; }

  /* Forms and inputs */
  .form-group {
    margin-bottom: 12px;
  }

  .form-group label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-dim);
    margin-bottom: 4px;
  }

  .form-row {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  select, input[type="text"], input[type="password"] {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 10px;
    font-size: 12px;
    width: 100%;
    transition: border-color 0.15s;
  }

  select:hover, input:hover { border-color: var(--accent-dim); }
  select:focus, input:focus { outline: none; border-color: var(--accent); }

  button {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 14px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }

  button:hover { border-color: var(--accent-dim); }

  button.primary {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
    font-weight: 600;
  }

  button.primary:hover { background: #5a7ae8; }
  button.primary:disabled { opacity: 0.5; cursor: not-allowed; }

  button.secondary { background: transparent; border-color: var(--border); color: var(--text-dim); }
  button.secondary:hover { color: var(--text); }

  button.small { padding: 3px 8px; font-size: 11px; }

  textarea {
    width: 100%;
    min-height: 100px;
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    font-family: 'SF Mono', 'Fira Code', Consolas, monospace;
    font-size: 12px;
    line-height: 1.6;
    resize: vertical;
  }

  textarea:focus { outline: none; border-color: var(--accent); }

  /* Collapsible sections */
  .collapsible {
    margin-bottom: 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
  }

  .collapsible-header {
    padding: 8px 12px;
    background: var(--surface);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-dim);
    user-select: none;
  }

  .collapsible-header:hover { color: var(--text); }

  .collapsible-header .arrow {
    transition: transform 0.2s;
    font-size: 10px;
  }

  .collapsible-header.open .arrow { transform: rotate(90deg); }

  .collapsible-body {
    display: none;
    padding: 12px;
  }

  .collapsible-body.open { display: block; }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 0;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    flex-shrink: 0;
    overflow-x: auto;
  }

  .tab {
    padding: 8px 16px;
    font-size: 12px;
    cursor: pointer;
    color: var(--text-dim);
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* Annotated text */
  .annotated-text {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 14px;
    line-height: 1.8;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #1a1a2e;
  }

  .annotation-span {
    background: rgba(59,100,224,0.13);
    border-bottom: 2px solid #3b64e0;
    cursor: pointer;
    border-radius: 2px;
    padding: 1px 2px;
    transition: background 0.15s;
    position: relative;
    color: #1a1a2e;
  }

  .annotation-span:hover { background: rgba(59,100,224,0.25); }

  /* Annotation state styles */
  .annotation-span[data-state="preliminary"] {
    background: rgba(59,100,224,0.07);
    border-bottom-style: dashed;
    opacity: 0.85;
  }
  .annotation-span[data-state="confirmed"] {
    background: rgba(59,100,224,0.13);
    border-bottom-style: solid;
  }
  .annotation-span[data-state="rejected"] {
    background: rgba(200,40,40,0.08);
    border-bottom-color: #c82828;
    border-bottom-style: dotted;
    text-decoration: line-through;
    opacity: 0.5;
  }

  /* Branch-colored annotations — WCAG-safe on white background
     Border colors darkened for >=3:1 contrast against #fff (non-text UI).
     Background tints at 0.10-0.13 alpha keep text at >=4.5:1 against #1a1a2e. */
  .annotation-span[data-branch="Actor / Player"]                { border-bottom-color: #1e6fa0; background: rgba(30,111,160,0.12); }
  .annotation-span[data-branch="Area of Law"]                   { border-bottom-color: #1a5276; background: rgba(26,82,118,0.12); }
  .annotation-span[data-branch="Asset Type"]                    { border-bottom-color: #6b5600; background: rgba(107,86,0,0.10); }
  .annotation-span[data-branch="Communication Modality"]        { border-bottom-color: #7b4d93; background: rgba(123,77,147,0.11); }
  .annotation-span[data-branch="Currency"]                      { border-bottom-color: #7a5a00; background: rgba(122,90,0,0.10); }
  .annotation-span[data-branch="Data Format"]                   { border-bottom-color: #4a5568; background: rgba(74,85,104,0.10); }
  .annotation-span[data-branch="Document / Artifact"]           { border-bottom-color: #9c4a10; background: rgba(156,74,16,0.10); }
  .annotation-span[data-branch="Document Metadata"]             { border-bottom-color: #8b5e3c; background: rgba(139,94,60,0.10); }
  .annotation-span[data-branch="Engagement Terms"]              { border-bottom-color: #10613a; background: rgba(16,97,58,0.12); }
  .annotation-span[data-branch="Event"]                         { border-bottom-color: #b91c1c; background: rgba(185,28,28,0.10); }
  .annotation-span[data-branch="Financial Concepts and Metrics"]{ border-bottom-color: #6e4b00; background: rgba(110,75,0,0.10); }
  .annotation-span[data-branch="Forums and Venues"]             { border-bottom-color: #7b2d8e; background: rgba(123,45,142,0.11); }
  .annotation-span[data-branch="Governmental Body"]             { border-bottom-color: #1a6091; background: rgba(26,96,145,0.12); }
  .annotation-span[data-branch="Industry"]                      { border-bottom-color: #065550; background: rgba(6,85,80,0.12); }
  .annotation-span[data-branch="Language"]                      { border-bottom-color: #7a3b10; background: rgba(122,59,16,0.10); }
  .annotation-span[data-branch="Legal Authorities"]             { border-bottom-color: #8b1a1a; background: rgba(139,26,26,0.10); }
  .annotation-span[data-branch="Legal Entity"]                  { border-bottom-color: #085e40; background: rgba(8,94,64,0.12); }
  .annotation-span[data-branch="Legal Use Cases"]               { border-bottom-color: #4a3570; background: rgba(74,53,112,0.11); }
  .annotation-span[data-branch="Location"]                      { border-bottom-color: #105560; background: rgba(16,85,96,0.12); }
  .annotation-span[data-branch="Matter Narrative"]              { border-bottom-color: #6d3580; background: rgba(109,53,128,0.11); }
  .annotation-span[data-branch="Matter Narrative Format"]       { border-bottom-color: #1a6894; background: rgba(26,104,148,0.12); }
  .annotation-span[data-branch="Objectives"]                    { border-bottom-color: #b03020; background: rgba(176,48,32,0.10); }
  .annotation-span[data-branch="Service"]                       { border-bottom-color: #065e4e; background: rgba(6,94,78,0.12); }
  .annotation-span[data-branch="Standards Compatibility"]       { border-bottom-color: #4a5a6a; background: rgba(74,90,106,0.10); }
  .annotation-span[data-branch="Status"]                        { border-bottom-color: #864a08; background: rgba(134,74,8,0.10); }
  .annotation-span[data-branch="System Identifiers"]            { border-bottom-color: #3d4d5a; background: rgba(61,77,90,0.10); }

  .annotation-span[data-branch="Actor / Player"]:hover                { background: rgba(30,111,160,0.22); }
  .annotation-span[data-branch="Area of Law"]:hover                   { background: rgba(26,82,118,0.22); }
  .annotation-span[data-branch="Asset Type"]:hover                    { background: rgba(107,86,0,0.20); }
  .annotation-span[data-branch="Communication Modality"]:hover        { background: rgba(123,77,147,0.20); }
  .annotation-span[data-branch="Currency"]:hover                      { background: rgba(122,90,0,0.20); }
  .annotation-span[data-branch="Data Format"]:hover                   { background: rgba(74,85,104,0.20); }
  .annotation-span[data-branch="Document / Artifact"]:hover           { background: rgba(156,74,16,0.20); }
  .annotation-span[data-branch="Document Metadata"]:hover             { background: rgba(139,94,60,0.20); }
  .annotation-span[data-branch="Engagement Terms"]:hover              { background: rgba(16,97,58,0.22); }
  .annotation-span[data-branch="Event"]:hover                         { background: rgba(185,28,28,0.20); }
  .annotation-span[data-branch="Financial Concepts and Metrics"]:hover{ background: rgba(110,75,0,0.20); }
  .annotation-span[data-branch="Forums and Venues"]:hover             { background: rgba(123,45,142,0.20); }
  .annotation-span[data-branch="Governmental Body"]:hover             { background: rgba(26,96,145,0.22); }
  .annotation-span[data-branch="Industry"]:hover                      { background: rgba(6,85,80,0.22); }
  .annotation-span[data-branch="Language"]:hover                      { background: rgba(122,59,16,0.20); }
  .annotation-span[data-branch="Legal Authorities"]:hover             { background: rgba(139,26,26,0.20); }
  .annotation-span[data-branch="Legal Entity"]:hover                  { background: rgba(8,94,64,0.22); }
  .annotation-span[data-branch="Legal Use Cases"]:hover               { background: rgba(74,53,112,0.20); }
  .annotation-span[data-branch="Location"]:hover                      { background: rgba(16,85,96,0.22); }
  .annotation-span[data-branch="Matter Narrative"]:hover              { background: rgba(109,53,128,0.20); }
  .annotation-span[data-branch="Matter Narrative Format"]:hover       { background: rgba(26,104,148,0.22); }
  .annotation-span[data-branch="Objectives"]:hover                    { background: rgba(176,48,32,0.20); }
  .annotation-span[data-branch="Service"]:hover                       { background: rgba(6,94,78,0.22); }
  .annotation-span[data-branch="Standards Compatibility"]:hover       { background: rgba(74,90,106,0.20); }
  .annotation-span[data-branch="Status"]:hover                        { background: rgba(134,74,8,0.20); }
  .annotation-span[data-branch="System Identifiers"]:hover            { background: rgba(61,77,90,0.20); }

  /* Concept tooltip */
  .concept-tooltip {
    position: fixed;
    background: #ffffff;
    border: 1px solid #d0d0da;
    border-radius: 10px;
    padding: 16px;
    max-width: 400px;
    min-width: 250px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    z-index: 1000;
    display: none;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    color: #1a1a2e;
  }

  .concept-tooltip.visible { display: block; }

  .tooltip-label { font-size: 15px; font-weight: 600; color: #3b64e0; margin-bottom: 2px; }
  .tooltip-branch { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; padding: 2px 6px; border-radius: 3px; display: inline-block; }
  .tooltip-definition { font-size: 13px; color: #1a1a2e; line-height: 1.5; margin-bottom: 8px; }
  .tooltip-meta { font-size: 11px; color: #6b6b80; display: flex; gap: 12px; margin-bottom: 6px; }
  .tooltip-iri a { color: #3b64e0; text-decoration: none; font-size: 11px; word-break: break-all; }
  .tooltip-iri a:hover { text-decoration: underline; }

  /* Feedback UI in tooltip — scoped to .concept-tooltip to override global dark styles */
  .concept-tooltip .tooltip-feedback { margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e5ea; }
  .concept-tooltip .tooltip-feedback-row { display: flex; align-items: center; gap: 8px; }
  .concept-tooltip .tooltip-feedback-btn {
    background: #ffffff; border: 1px solid #d0d0da; border-radius: 6px; padding: 4px 10px;
    cursor: pointer; font-size: 16px; display: flex; align-items: center; gap: 4px;
    color: #6b6b80; transition: all 0.15s; min-height: auto; line-height: 1;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif; white-space: nowrap;
  }
  .concept-tooltip .tooltip-feedback-btn:hover { border-color: #3b64e0; background: #f0f4ff; }
  .concept-tooltip .tooltip-feedback-btn.active-up,
  .concept-tooltip .tooltip-feedback-btn.active-up:hover { border-color: #166534; background: #dcfce7; color: #166534; }
  .concept-tooltip .tooltip-feedback-btn.active-down,
  .concept-tooltip .tooltip-feedback-btn.active-down:hover { border-color: #991b1b; background: #fee2e2; color: #991b1b; }
  .concept-tooltip .tooltip-feedback-btn:disabled { opacity: 0.5; cursor: default; }
  .concept-tooltip .tooltip-feedback-note {
    width: 100%; margin-top: 6px; padding: 6px 8px; border: 1px solid #d0d0da;
    border-radius: 6px; font-size: 12px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    resize: vertical; min-height: 28px; max-height: 80px;
    background: #ffffff; color: #1a1a2e; line-height: 1.4;
  }
  .concept-tooltip .tooltip-feedback-note::placeholder { color: #a0a0b0; }
  .concept-tooltip .tooltip-feedback-note:focus { outline: none; border-color: #3b64e0; box-shadow: 0 0 0 2px rgba(59, 100, 224, 0.15); }
  .concept-tooltip .tooltip-feedback-saved { font-size: 11px; color: #166534; margin-left: auto; }

  /* Lineage trail in tooltip */
  .concept-tooltip .tooltip-lineage { margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e5ea; }
  .concept-tooltip .tooltip-lineage-toggle {
    font-size: 11px; color: #3b64e0; cursor: pointer; background: none; border: none;
    padding: 0; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }
  .concept-tooltip .tooltip-lineage-toggle:hover { text-decoration: underline; }
  .concept-tooltip .tooltip-lineage-list { margin-top: 6px; padding: 0; list-style: none; font-size: 11px; color: #6b6b80; }
  .concept-tooltip .tooltip-lineage-list li { padding: 3px 0; border-bottom: 1px solid #f0f0f4; display: flex; gap: 6px; }
  .concept-tooltip .tooltip-lineage-list li:last-child { border-bottom: none; }
  .concept-tooltip .lineage-stage-name { font-weight: 600; color: #1a1a2e; min-width: 100px; font-size: 11px; }
  .concept-tooltip .lineage-action { color: #3b64e0; min-width: 60px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
  .concept-tooltip .lineage-detail-text { color: #6b6b80; flex: 1; font-size: 11px; }
  .concept-tooltip .lineage-confidence { font-weight: 600; color: #555; font-size: 10px; background: #f0f0f4; padding: 0 4px; border-radius: 3px; }

  /* Insights panel */
  .insights-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px; flex-wrap: wrap; gap: 8px;
  }
  .insights-header h3 { font-size: 14px; font-weight: 600; color: var(--text); margin: 0; }
  .insights-actions { display: flex; gap: 6px; flex-wrap: wrap; }

  .insights-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
  .insights-stat {
    padding: 14px 12px; border-radius: 8px; text-align: center;
    background: var(--surface); border: 1px solid var(--border);
  }
  .insights-stat-value { font-size: 22px; font-weight: 700; color: var(--accent); }
  .insights-stat-label { font-size: 11px; color: var(--text-dim); margin-top: 4px; }
  .insights-stat.stat-up .insights-stat-value { color: var(--green); }
  .insights-stat.stat-down .insights-stat-value { color: var(--red); }

  .insights-section { margin-bottom: 20px; }
  .insights-section-title {
    font-size: 11px; font-weight: 600; color: var(--text-dim); text-transform: uppercase;
    letter-spacing: 0.5px; margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid var(--border);
  }

  .insights-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .insights-table th {
    text-align: left; padding: 8px 10px; color: var(--text-dim); font-weight: 600;
    border-bottom: 1px solid var(--border); font-size: 11px;
  }
  .insights-table td {
    padding: 10px; border-bottom: 1px solid var(--border); color: var(--text); vertical-align: top;
  }
  .insights-table tr:last-child td { border-bottom: none; }
  .insights-table tr:hover td { background: var(--highlight); }

  .insights-rating-up { color: var(--green); font-weight: 600; }
  .insights-rating-down { color: var(--red); font-weight: 600; }
  .insights-comment {
    color: var(--text); background: var(--surface); padding: 4px 8px;
    border-radius: 4px; font-style: italic; font-size: 12px; margin-top: 4px;
    border-left: 2px solid var(--accent);
  }
  .insights-lineage-detail {
    font-size: 11px; color: var(--text); margin-top: 8px;
    line-height: 1.5;
  }
  .insights-lineage-detail .lineage-stage {
    display: flex; align-items: baseline; gap: 6px;
    padding: 4px 0; border-bottom: 1px solid var(--border);
  }
  .insights-lineage-detail .lineage-stage:last-child { border-bottom: none; }
  .insights-lineage-detail .lineage-stage-name {
    font-weight: 600; font-size: 11px; color: var(--accent);
    white-space: nowrap; min-width: 110px;
  }
  .insights-lineage-detail .lineage-action {
    font-size: 10px; font-weight: 600; text-transform: uppercase;
    padding: 1px 5px; border-radius: 3px; white-space: nowrap;
  }
  .lineage-action.act-created { background: #e3f2fd; color: #1565c0; }
  .lineage-action.act-confirmed { background: #e8f5e9; color: #2e7d32; }
  .lineage-action.act-rejected { background: #fce4ec; color: #c62828; }
  .lineage-action.act-enriched { background: #f3e5f5; color: #6a1b9a; }
  .lineage-action.act-identified { background: #fff3e0; color: #e65100; }
  .lineage-action.act-branch_assigned { background: #e0f2f1; color: #00695c; }
  .lineage-action.act-kept { background: #fff8e1; color: #f57f17; }
  .insights-lineage-detail .lineage-detail-text {
    font-size: 11px; color: var(--text-dim); flex: 1;
  }
  .insights-lineage-detail .lineage-confidence {
    font-size: 10px; font-weight: 600; white-space: nowrap;
    padding: 1px 6px; border-radius: 3px; background: #f0f0f0; color: #555;
  }
  .insights-empty { color: var(--text-dim); font-size: 13px; text-align: center; padding: 40px 16px; }

  .insights-bar { display: flex; height: 6px; border-radius: 3px; overflow: hidden; background: var(--surface3); }
  .insights-bar-up { background: var(--green); }
  .insights-bar-down { background: var(--red); }

  .insights-stage-row { display: flex; align-items: center; gap: 10px; padding: 6px 0; }
  .insights-stage-name { font-size: 12px; color: var(--text); min-width: 130px; font-weight: 500; }
  .insights-stage-counts { font-size: 11px; color: var(--text-dim); min-width: 80px; text-align: right; }

  .insights-concept-label { font-weight: 500; color: var(--text); }
  .insights-concept-sub { font-size: 11px; color: var(--text-dim); }

  /* Pipeline progress */
  .pipeline-progress {
    padding: 8px 16px;
    background: var(--surface);
    border-top: 1px solid var(--border);
    flex-shrink: 0;
  }

  .progress-bar {
    height: 3px;
    background: var(--surface3);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 6px;
  }

  .progress-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.3s ease;
  }

  .progress-stages {
    display: flex;
    gap: 4px;
    font-size: 10px;
    color: var(--text-dim);
    flex-wrap: wrap;
  }

  .stage-pill {
    padding: 1px 6px;
    border-radius: 3px;
    background: var(--surface2);
  }

  .stage-pill.active { background: rgba(108,140,255,0.2); color: var(--accent); }
  .stage-pill.done { background: rgba(76,175,124,0.2); color: var(--green); }
  .stage-pill.error { background: rgba(224,85,85,0.2); color: var(--red); }

  .status-text {
    font-size: 11px;
    color: var(--text-dim);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .activity-log-wrapper {
    position: relative;
    border-top: 1px solid var(--border);
    margin-top: 6px;
    padding-top: 4px;
  }

  .activity-log {
    max-height: 240px;
    overflow-y: auto;
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 11px;
  }

  .btn-copy-log {
    position: absolute;
    top: 4px;
    right: 0;
    background: var(--surface2);
    color: var(--text-dim);
    border: 1px solid var(--border);
    border-radius: 4px;
    font-size: 10px;
    padding: 1px 6px;
    cursor: pointer;
    z-index: 1;
  }
  .btn-copy-log:hover { background: var(--border); color: var(--text); }

  .activity-entry {
    display: flex;
    align-items: baseline;
    gap: 6px;
    padding: 1px 0;
    line-height: 1.5;
  }

  .activity-ts {
    color: var(--text-dim);
    opacity: 0.6;
    flex-shrink: 0;
    font-size: 10px;
  }

  .activity-stage {
    flex-shrink: 0;
    padding: 0 5px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
    background: var(--surface2);
    color: var(--accent);
  }

  .activity-stage.orchestrator { color: var(--text-dim); }

  .activity-msg {
    color: var(--text);
  }

  /* Concepts sidebar */
  .concept-group { margin-bottom: 16px; }
  .concept-group-header {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 6px 0;
    border-bottom: 1px solid #d0d0da;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #1a1a2e;
  }

  .concept-group-count {
    font-size: 10px;
    background: #eeeef3;
    color: #4a4a60;
    padding: 1px 6px;
    border-radius: 8px;
    font-weight: 400;
  }

  .concept-item {
    padding: 8px 10px;
    border: 1px solid #d0d0da;
    border-radius: 6px;
    margin-top: 4px;
    cursor: pointer;
    transition: background 0.15s;
    font-size: 12px;
    color: #1a1a2e;
  }

  .concept-item:hover { background: #f0f0f5; }
  .concept-name { font-weight: 600; color: #1a1a2e; }
  .concept-meta { font-size: 11px; color: #6b6b80; margin-top: 2px; }
  .concept-header { display: flex; justify-content: space-between; align-items: baseline; }
  .confidence-pct { font-weight: 600; font-size: 12px; }
  .confidence-pct.conf-high { color: #166534; }
  .confidence-pct.conf-mid { color: #92400e; }
  .confidence-pct.conf-low { color: #991b1b; }

  .confidence-bar { height: 6px; background: #d0d0da; border-radius: 3px; margin-top: 4px; overflow: hidden; }
  .confidence-fill { height: 100%; border-radius: 3px; }
  .confidence-fill.conf-high { background: #22c55e; }
  .confidence-fill.conf-mid { background: #f59e0b; }
  .confidence-fill.conf-low { background: #ef4444; }

  .tooltip-confidence { display: inline-block; padding: 2px 8px; border-radius: 10px; font-weight: 600; font-size: 13px; margin-bottom: 8px; }
  .tooltip-confidence.conf-high { background: #dcfce7; color: #166534; }
  .tooltip-confidence.conf-mid { background: #fef3c7; color: #92400e; }
  .tooltip-confidence.conf-low { background: #fee2e2; color: #991b1b; }

  .aol-item { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
  .aol-item .aol-name { flex: 1; min-width: 0; }
  .aol-item .confidence-bar { flex: 0 0 60px; margin-top: 0; }

  .confidence-legend { display: flex; align-items: center; gap: 8px; font-size: 10px; color: #6b6b80; margin-right: 8px; }
  .confidence-legend .legend-dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; }
  .confidence-legend .legend-dot.conf-high { background: #22c55e; }
  .confidence-legend .legend-dot.conf-mid { background: #f59e0b; }
  .confidence-legend .legend-dot.conf-low { background: #ef4444; }

  .meta-value .confidence-badge { display: inline-block; padding: 1px 6px; border-radius: 8px; font-weight: 600; font-size: 11px; }
  .confidence-badge.conf-high { background: #dcfce7; color: #166534; }
  .confidence-badge.conf-mid { background: #fef3c7; color: #92400e; }
  .confidence-badge.conf-low { background: #fee2e2; color: #991b1b; }

  /* Export buttons */
  .export-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 6px;
  }

  .export-btn {
    font-size: 11px;
    padding: 8px 10px;
    border-radius: 6px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }

  .export-btn .ext { font-size: 9px; color: #6b6b80; }

  /* Metadata grid */
  .meta-grid {
    display: grid;
    grid-template-columns: 130px 1fr;
    gap: 4px 12px;
    font-size: 12px;
  }

  .meta-key { color: #6b6b80; font-weight: 500; padding: 2px 0; }
  .meta-value { color: #1a1a2e; padding: 2px 0; word-break: break-word; }

  /* Settings modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    z-index: 2000;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.visible { display: flex; }

  .modal {
    background: #ffffff;
    border: 1px solid #d0d0da;
    border-radius: 12px;
    padding: 24px;
    max-width: 540px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    color: #1a1a2e;
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  }

  .modal h3 {
    font-size: 16px;
    margin-bottom: 16px;
    color: #1a1a2e;
  }

  .modal::-webkit-scrollbar-thumb { background: #c0c0cc; }
  .modal::-webkit-scrollbar-thumb:hover { background: #9090a0; }

  .modal .form-group { margin-bottom: 14px; }
  .modal .form-group label { color: #4a4a60; }

  .modal-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-top: 20px;
  }

  /* Modal input/select overrides for light background */
  .modal select,
  .modal input[type="text"],
  .modal input[type="password"] {
    background: #f5f5f8;
    color: #1a1a2e;
    border: 1px solid #c0c0cc;
  }
  .modal select:hover,
  .modal input:hover { border-color: #3b64e0; }
  .modal select:focus,
  .modal input:focus { outline: none; border-color: #3b64e0; }

  /* Modal button overrides */
  .modal button.secondary {
    background: transparent;
    border-color: #c0c0cc;
    color: #4a4a60;
  }
  .modal button.secondary:hover {
    border-color: #3b64e0;
    color: #1a1a2e;
  }

  /* Synthetic generator */
  .doc-type-tree { font-size: 12px; }

  .doc-type-category {
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    gap: 6px;
    color: #1a1a2e;
  }

  .doc-type-category:hover { background: #f0f0f5; }

  .doc-type-subtypes {
    display: none;
    padding-left: 24px;
  }

  .doc-type-subtypes.open { display: block; }

  .doc-type-subtype {
    padding: 4px 10px;
    cursor: pointer;
    border-radius: 4px;
    font-size: 11px;
    color: #6b6b80;
  }

  .doc-type-subtype:hover { background: #f0f0f5; color: #1a1a2e; }
  .doc-type-subtype.selected { background: rgba(59,100,224,0.10); color: #3b64e0; }

  .radio-group { display: flex; gap: 12px; margin-top: 4px; }
  .radio-group label { font-size: 12px; color: #1a1a2e; display: flex; align-items: center; gap: 4px; cursor: pointer; text-transform: none; letter-spacing: 0; font-weight: 400; }
  .radio-group input[type="radio"] { accent-color: #3b64e0; }

  /* Toggle switch */
  .toggle { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #6b6b80; cursor: pointer; }
  .toggle input { display: none; }
  .toggle-track {
    width: 32px; height: 18px;
    background: #c0c0cc;
    border-radius: 9px;
    position: relative;
    transition: background 0.2s;
  }
  .toggle input:checked + .toggle-track { background: #3b64e0; }
  .toggle-thumb {
    width: 14px; height: 14px;
    background: #fff;
    border-radius: 50%;
    position: absolute;
    top: 2px; left: 2px;
    transition: left 0.2s;
  }
  .toggle input:checked + .toggle-track .toggle-thumb { left: 16px; }

  /* Spinner */
  .spinner {
    display: inline-block;
    width: 12px; height: 12px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    vertical-align: middle;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #6b6b80;
  }

  .empty-state h3 { font-size: 14px; margin-bottom: 6px; color: #1a1a2e; }

  /* File upload zone */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 12px;
    font-size: 12px;
    color: var(--text-dim);
  }

  .upload-zone:hover { border-color: var(--accent-dim); color: var(--text); }
  .upload-zone.dragover { border-color: var(--accent); background: rgba(108,140,255,0.05); }
  .upload-zone input { display: none; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent-dim); }

  /* Sample buttons */
  .sample-grid {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .sample-btn {
    font-size: 11px;
    padding: 4px 10px;
  }

  /* Tag badge for branch */
  .branch-tag {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.3px;
  }

  .test-status { font-size: 11px; margin-top: 6px; }
  .test-status.ok { color: #1e8c4a; }
  .test-status.error { color: #c82828; }

  .btn-test-sm {
    font-size: 11px; padding: 2px 8px; margin-left: 8px;
    border: 1px solid #c0c0cc; border-radius: 4px;
    background: #f5f5f8; color: #1a1a2e; cursor: pointer;
  }
  .btn-test-sm:hover { background: #e0e0e8; }

  /* Settings modal header */
  .settings-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 14px;
    margin-bottom: 16px;
    border-bottom: 1px solid #d0d0da;
  }
  .settings-header h3 { margin: 0; font-size: 16px; color: #1a1a2e; }
  .settings-header-actions { display: flex; gap: 10px; }
  .settings-header-actions button {
    background: none; border: none; cursor: pointer;
    font-size: 13px; padding: 4px 10px; border-radius: 6px;
  }
  .settings-header-actions .btn-cancel { color: #6b6b80; }
  .settings-header-actions .btn-cancel:hover { background: #f0f0f5; }
  .settings-header-actions .btn-save {
    color: #3b64e0; font-weight: 600;
  }
  .settings-header-actions .btn-save:hover { background: rgba(59,100,224,0.08); }

  .settings-section-label {
    font-size: 11px; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.5px; color: #6b6b80; margin-bottom: 10px;
  }

  /* Provider cards */
  .provider-card {
    border: 1px solid #d0d0da;
    border-radius: 8px;
    padding: 12px 14px;
    margin-bottom: 10px;
    background: #ffffff;
    transition: border-color 0.15s, background 0.15s;
  }
  .provider-card.active {
    border-color: #3b64e0;
    background: rgba(59,100,224,0.05);
  }
  .provider-card-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }
  .provider-card-header input[type="radio"] {
    accent-color: #3b64e0;
    margin: 0;
    cursor: pointer;
  }
  .provider-card-header .provider-name {
    font-weight: 600; font-size: 13px; flex: 1; color: #1a1a2e;
  }
  .provider-card-header .btn-test-card {
    font-size: 11px; padding: 2px 10px;
    border: 1px solid #c0c0cc; border-radius: 4px;
    background: #f5f5f8; color: #1a1a2e; cursor: pointer;
  }
  .provider-card-header .btn-test-card:hover { background: #e0e0e8; }
  .provider-card-header .test-status {
    font-size: 11px; min-width: 60px;
  }

  .provider-card-field {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
  }
  .provider-card-field .field-label {
    font-size: 11px; color: #6b6b80; width: 46px;
    text-align: right; flex-shrink: 0;
  }
  .provider-card-field input,
  .provider-card-field select {
    flex: 1; min-width: 0;
    font-size: 12px; padding: 5px 8px;
    background: #f5f5f8; color: #1a1a2e;
    border: 1px solid #c0c0cc; border-radius: 4px;
  }
  .provider-card-field .btn-refresh {
    background: #f5f5f8; color: #6b6b80;
    border: 1px solid #c0c0cc; border-radius: 4px;
    cursor: pointer; font-size: 13px; padding: 3px 7px;
    line-height: 1;
  }
  .provider-card-field .btn-refresh:hover { background: #e0e0e8; color: #1a1a2e; }

  .provider-card-cost {
    font-size: 11px; color: #6b6b80;
    padding-left: 54px; margin-top: 2px;
  }
</style>
</head>
<body>

<header>
  <h1><span>FOLIO</span> Enrich</h1>
  <div class="status-bar" id="statusBar">
    <div class="status-chip" id="chipBackend" data-tooltip="Checking...">
      <span class="chip-dot gray"></span>
      <span class="chip-label">Backend</span>
      <span class="chip-detail" id="chipBackendDetail">...</span>
    </div>
    <div class="status-chip" id="chipFolio" data-tooltip="FOLIO ontology status">
      <span class="chip-dot gray"></span>
      <span class="chip-label">FOLIO</span>
      <span class="chip-detail" id="chipFolioDetail">...</span>
    </div>
    <div class="status-chip" id="chipEmbedding" data-tooltip="Embedding service status">
      <span class="chip-dot gray"></span>
      <span class="chip-label">Embedding</span>
      <span class="chip-detail" id="chipEmbeddingDetail">...</span>
    </div>
    <div class="status-chip" id="chipLLM" data-tooltip="LLM provider status" onclick="openSettings()" style="cursor:pointer">
      <span class="chip-dot gray"></span>
      <span class="chip-label">LLM</span>
      <span class="chip-detail" id="chipLLMDetail">...</span>
    </div>
    <div class="status-chip" id="chipSpacy" data-tooltip="spaCy NLP status">
      <span class="chip-dot gray"></span>
      <span class="chip-label">spaCy</span>
      <span class="chip-detail" id="chipSpacyDetail">...</span>
    </div>
  </div>
  <div class="header-right">
    <div class="confidence-legend">
      <span class="legend-dot conf-high"></span><span>High (&ge;80%)</span>
      <span class="legend-dot conf-mid"></span><span>Medium (50–79%)</span>
      <span class="legend-dot conf-low"></span><span>Low (&lt;50%)</span>
    </div>
    <label class="toggle" title="Toggle uncertain annotations">
      <input type="checkbox" id="hideUncertainToggle" checked onchange="toggleUncertain()">
      <span class="toggle-track"><span class="toggle-thumb"></span></span>
      <span>Show all</span>
    </label>
  </div>
</header>

<main>
  <!-- Left panel: Input -->
  <div class="panel panel-left">
    <div class="panel-header">
      <h2>Document Input</h2>
    </div>
    <div class="panel-body">
      <!-- LLM Configuration (inline) -->
      <div class="collapsible">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <span class="arrow">&#9654;</span>
          LLM Provider
          <span style="margin-left:auto;font-weight:400;font-size:11px" id="llmSummary">Loading...</span>
        </div>
        <div class="collapsible-body" id="llmConfig">
          <div class="form-row" style="margin-bottom:8px">
            <div style="flex:1">
              <label>Provider</label>
              <select id="providerSelect" onchange="onProviderChange()"></select>
            </div>
            <div style="flex:1">
              <label>Model</label>
              <select id="modelSelect"></select>
            </div>
          </div>
          <div class="form-group" id="apiKeyGroup">
            <label>API Key</label>
            <div class="form-row">
              <input type="password" id="apiKeyInput" placeholder="sk-...">
              <button class="small" onclick="testConnection()">Test</button>
            </div>
            <div class="test-status" id="testStatus"></div>
          </div>
        </div>
      </div>

      <!-- Upload & Enrich -->
      <div class="form-row" style="margin-bottom:8px">
        <button class="primary" id="enrichBtn" onclick="submitEnrichment()">Enrich Document</button>
        <button class="secondary" onclick="clearAll()">Clear</button>
      </div>

      <!-- File upload -->
      <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
        Drop a file here or click to upload (PDF, DOCX, HTML, MD, TXT, RTF, EML, MSG)
        <input type="file" id="fileInput" accept=".pdf,.docx,.doc,.html,.htm,.md,.txt,.rtf,.eml,.msg" onchange="handleFileUpload(event)">
      </div>

      <!-- Text input -->
      <textarea id="docInput" placeholder="Paste your legal document text here..."></textarea>

      <!-- Sample documents -->
      <div style="margin-top:12px">
        <label style="font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-dim)">Quick Start</label>

        <label style="font-size:10px;font-weight:600;letter-spacing:0.3px;color:var(--text-dim);margin-top:6px;display:block">Litigation</label>
        <div class="sample-grid" style="margin-top:3px">
          <button class="secondary sample-btn" onclick="loadSample('motion')">Motion to Dismiss</button>
          <button class="secondary sample-btn" onclick="loadSample('complaint')">Complaint</button>
          <button class="secondary sample-btn" onclick="loadSample('opinion')">Court Opinion</button>
          <button class="secondary sample-btn" onclick="loadSample('appellate')">Appellate Brief</button>
          <button class="secondary sample-btn" onclick="loadSample('injunction')">TRO/Injunction</button>
          <button class="secondary sample-btn" onclick="loadSample('settlement')">Settlement</button>
        </div>

        <label style="font-size:10px;font-weight:600;letter-spacing:0.3px;color:var(--text-dim);margin-top:6px;display:block">Transactional</label>
        <div class="sample-grid" style="margin-top:3px">
          <button class="secondary sample-btn" onclick="loadSample('contract')">Contract Clause</button>
          <button class="secondary sample-btn" onclick="loadSample('nda')">NDA</button>
          <button class="secondary sample-btn" onclick="loadSample('lease')">Commercial Lease</button>
          <button class="secondary sample-btn" onclick="loadSample('employment')">Employment Agreement</button>
          <button class="secondary sample-btn" onclick="loadSample('merger')">Merger Agreement</button>
        </div>

        <label style="font-size:10px;font-weight:600;letter-spacing:0.3px;color:var(--text-dim);margin-top:6px;display:block">Advisory</label>
        <div class="sample-grid" style="margin-top:3px">
          <button class="secondary sample-btn" onclick="loadSample('advice_litigation')">Litigation Advice Memo</button>
          <button class="secondary sample-btn" onclick="loadSample('advice_regulatory')">Regulatory Advice Memo</button>
        </div>

        <label style="font-size:10px;font-weight:600;letter-spacing:0.3px;color:var(--text-dim);margin-top:6px;display:block">Regulatory</label>
        <div class="sample-grid" style="margin-top:3px">
          <button class="secondary sample-btn" onclick="loadSample('regulatory')">Regulatory Filing</button>
          <button class="secondary sample-btn" onclick="loadSample('patent')">Patent Application</button>
        </div>
      </div>

      <div style="margin-top:8px">
        <label style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-dim)">Narratives</label>
        <div class="sample-grid" style="margin-top:4px">
          <button class="secondary sample-btn" onclick="loadSample('narr_pi')">Personal Injury</button>
          <button class="secondary sample-btn" onclick="loadSample('narr_antitrust')">Antitrust</button>
          <button class="secondary sample-btn" onclick="loadSample('narr_contract')">Commercial Contract</button>
          <button class="secondary sample-btn" onclick="loadSample('narr_ma')">M&amp;A Deal</button>
          <button class="secondary sample-btn" onclick="loadSample('narr_bankruptcy')">Bankruptcy</button>
          <button class="secondary sample-btn" onclick="loadSample('narr_regulatory')">Regulatory</button>
          <button class="secondary sample-btn" onclick="loadSample('narr_advisory')">Advisory</button>
        </div>
      </div>

      <div style="margin-top:8px">
        <label style="font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-dim)">Generate Your Own</label>
        <div class="sample-grid" style="margin-top:4px">
          <button class="secondary sample-btn" onclick="openSynthetic()">Generate...</button>
        </div>
      </div>
    </div>

    <!-- Pipeline progress -->
    <div class="pipeline-progress" id="pipelineProgress">
      <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
      <div class="progress-stages" id="progressStages"></div>
      <div class="activity-log-wrapper">
        <button class="btn-copy-log" onclick="copyActivityLog()" title="Copy log to clipboard">Copy</button>
        <div class="activity-log" id="activityLog"></div>
      </div>
      <div class="status-text">
        <span id="statusText">Ready</span>
        <span id="statusBadge" style="font-size:10px;color:var(--text-dim)">idle</span>
      </div>
    </div>
  </div>

  <!-- Right panel: Results -->
  <div class="panel panel-right">
    <div class="tabs">
      <div class="tab active" data-tab="annotated" onclick="switchTab(this, 'annotated')">Annotated Text</div>
      <div class="tab" data-tab="concepts" onclick="switchTab(this, 'concepts')">Concepts</div>
      <div class="tab" data-tab="triples" onclick="switchTab(this, 'triples')">Triples</div>
      <div class="tab" data-tab="metadata" onclick="switchTab(this, 'metadata')">Metadata</div>
      <div class="tab" data-tab="export" onclick="switchTab(this, 'export')">Export</div>
      <div class="tab" data-tab="insights" onclick="switchTab(this, 'insights'); loadInsights()">Insights</div>
    </div>
    <div class="panel-body" id="resultBody">
      <div class="tab-content active" id="tab-annotated">
        <div class="empty-state" id="emptyState">
          <h3>No annotations yet</h3>
          <p>Paste a legal document and click "Enrich Document" to see FOLIO annotations.</p>
        </div>
        <div class="annotated-text" id="annotatedText" style="display:none"></div>
      </div>
      <div class="tab-content" id="tab-concepts">
        <div id="conceptsList"></div>
      </div>
      <div class="tab-content" id="tab-triples">
        <div id="triplesList"></div>
      </div>
      <div class="tab-content" id="tab-metadata">
        <div id="metadataDisplay"></div>
      </div>
      <div class="tab-content" id="tab-export">
        <p style="color:#6b6b80;font-size:12px;margin-bottom:12px">Download annotations in any of the 12 supported formats:</p>
        <div class="export-grid" id="exportButtons"></div>
      </div>
      <div class="tab-content" id="tab-insights">
        <div id="insightsPanel"></div>
      </div>
    </div>
  </div>
</main>

<!-- Tooltip -->
<div class="concept-tooltip" id="tooltip"></div>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal" style="max-width:560px">
    <div class="settings-header">
      <h3>LLM Provider Settings</h3>
      <div class="settings-header-actions">
        <button class="btn-cancel" onclick="closeSettings()">Cancel</button>
        <button class="btn-save" onclick="saveSettings()">Save &amp; Close</button>
      </div>
    </div>
    <div class="settings-section-label">Cloud Providers</div>
    <div id="settingsProviderCards"></div>
  </div>
</div>

<!-- Synthetic Document Generator Modal -->
<div class="modal-overlay" id="syntheticModal">
  <div class="modal" style="max-width:600px">
    <h3>Generate Synthetic Legal Document</h3>
    <p style="font-size:12px;color:#6b6b80;margin-bottom:16px">Select a document type to generate a realistic legal document for testing.</p>
    <div class="doc-type-tree" id="docTypeTree"></div>
    <div style="margin-top:16px">
      <label style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:#6b6b80">Length</label>
      <div class="radio-group">
        <label><input type="radio" name="synLength" value="short" checked> Short (1-5 pages)</label>
        <label><input type="radio" name="synLength" value="medium"> Medium (10-30 pages)</label>
        <label><input type="radio" name="synLength" value="long"> Long (50-100 pages)</label>
      </div>
    </div>
    <div class="form-group" style="margin-top:12px">
      <label>Jurisdiction (optional)</label>
      <select id="synJurisdiction">
        <option value="Federal">US Federal</option>
        <option value="New York">New York</option>
        <option value="California">California</option>
        <option value="Texas">Texas</option>
        <option value="Delaware">Delaware</option>
        <option value="England and Wales">England &amp; Wales</option>
        <option value="Canada">Canada</option>
        <option value="Australia">Australia</option>
        <option value="Generic">Generic</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="secondary" onclick="closeSynthetic()">Cancel</button>
      <button class="primary" id="generateBtn" onclick="generateSynthetic()">Generate &amp; Annotate</button>
    </div>
  </div>
</div>

<script>
const API = 'http://localhost:8731';
let currentJobId = null;
let currentJob = null;
let pollInterval = null;
let uploadedFilename = null;
let pollTimeout = null;
let eventSource = null;
let accumulatedAnnotations = [];
let normalizedText = null;      // canonical full_text from backend, used for progressive rendering
let activityEntries = [];
let providersData = {};   // provider name → metadata {display_name, requires_api_key, default_model, api_key_set}
let knownModels = {};     // provider name → [{id, name, context_window}]
let pricingData = {};     // model id → {input_cost_per_1k, output_cost_per_1k, ...}
let selectedDocType = null;
let showUncertain = true;

// ==============================================
// Session Cache — persist pipeline results across reloads
// ==============================================

function cacheState() {
  if (!currentJob || !currentJobId) return;
  try {
    sessionStorage.setItem('folio_enrich_cache', JSON.stringify({
      jobId: currentJobId,
      job: currentJob,
      annotations: accumulatedAnnotations,
      normalizedText: normalizedText,
      activity: activityEntries,
      docInput: document.getElementById('docInput')?.value || '',
      filename: uploadedFilename,
    }));
  } catch (e) { /* quota exceeded — ignore */ }
}

function restoreState() {
  try {
    const raw = sessionStorage.getItem('folio_enrich_cache');
    if (!raw) return false;
    const cache = JSON.parse(raw);
    if (!cache.jobId || !cache.job) return false;

    currentJobId = cache.jobId;
    currentJob = cache.job;
    accumulatedAnnotations = cache.annotations || [];
    normalizedText = cache.normalizedText || null;
    activityEntries = cache.activity || [];
    uploadedFilename = cache.filename || null;

    if (cache.docInput) {
      document.getElementById('docInput').value = cache.docInput;
    }

    renderResults(currentJob);
    renderProgressStages('completed');
    renderActivityLog();
    const annCount = (currentJob.result?.annotations || []).length;
    setStatus(`Completed: ${annCount} annotations (cached)`, 'completed');
    return true;
  } catch (e) {
    console.warn('Failed to restore cached state:', e);
    return false;
  }
}

function clearCache() {
  sessionStorage.removeItem('folio_enrich_cache');
}

const PIPELINE_STAGES = [
  'pending', 'ingesting', 'normalizing', 'enriching', 'identifying',
  'resolving', 'matching', 'judging', 'exporting', 'completed'
];

const STAGE_LABELS = {
  pending: 'Queued', ingesting: 'Ingesting', normalizing: 'Normalizing',
  enriching: 'Enriching', identifying: 'Identifying', resolving: 'Resolving',
  matching: 'Matching', judging: 'Judging', exporting: 'Exporting', completed: 'Done'
};

const BRANCH_COLORS = {
  'Actor / Player': '#1e6fa0',
  'Area of Law': '#1a5276',
  'Asset Type': '#6b5600',
  'Communication Modality': '#7b4d93',
  'Currency': '#7a5a00',
  'Data Format': '#4a5568',
  'Document / Artifact': '#9c4a10',
  'Document Metadata': '#8b5e3c',
  'Engagement Terms': '#10613a',
  'Event': '#b91c1c',
  'Financial Concepts and Metrics': '#6e4b00',
  'FOLIO Type': '#6b5c00',
  'Forums and Venues': '#7b2d8e',
  'Governmental Body': '#1a6091',
  'Industry': '#065550',
  'Language': '#7a3b10',
  'Legal Authorities': '#8b1a1a',
  'Legal Entity': '#085e40',
  'Legal Use Cases': '#4a3570',
  'Location': '#105560',
  'Matter Narrative': '#6d3580',
  'Matter Narrative Format': '#1a6894',
  'Objectives': '#b03020',
  'Service': '#065e4e',
  'Standards Compatibility': '#4a5a6a',
  'Status': '#864a08',
  'System Identifiers': '#3d4d5a',
};

const EXPORT_FORMATS = [
  { name: 'json', label: 'JSON', ext: '.json' },
  { name: 'jsonld', label: 'JSON-LD', ext: '.jsonld' },
  { name: 'xml', label: 'XML', ext: '.xml' },
  { name: 'csv', label: 'CSV', ext: '.csv' },
  { name: 'jsonl', label: 'JSONL', ext: '.jsonl' },
  { name: 'parquet', label: 'Parquet', ext: '.parquet' },
  { name: 'elasticsearch', label: 'Elasticsearch', ext: '.ndjson' },
  { name: 'neo4j', label: 'Neo4j CSV', ext: '.csv' },
  { name: 'rag', label: 'RAG Chunks', ext: '.json' },
  { name: 'rdf', label: 'RDF/Turtle', ext: '.ttl' },
  { name: 'brat', label: 'brat', ext: '.ann' },
  { name: 'html', label: 'HTML', ext: '.html' },
  { name: 'excel', label: 'Excel', ext: '.xlsx' },
];

const SAMPLES = {
  motion: `UNITED STATES DISTRICT COURT\nSOUTHERN DISTRICT OF NEW YORK\n\nCase No. 1:24-cv-03456-ABC\n\nACME CORPORATION, Plaintiff,\nv.\nWIDGET INDUSTRIES, INC., Defendant.\n\nDEFENDANT'S MOTION TO DISMISS\n\nDefendant Widget Industries, Inc., by and through its undersigned counsel, hereby moves this Court pursuant to Federal Rule of Civil Procedure 12(b)(6) for an Order dismissing the Complaint filed by Plaintiff Acme Corporation for failure to state a claim upon which relief can be granted.\n\nIn support of this Motion, Defendant respectfully submits the following Memorandum of Law.\n\nMEMORANDUM OF LAW\n\nI. INTRODUCTION\n\nPlaintiff's Complaint alleges breach of contract and negligence arising from a commercial supply agreement between the parties. However, the Complaint fails to allege the essential elements required to sustain either cause of action under New York law.\n\nII. LEGAL STANDARD\n\nTo survive a motion to dismiss under Rule 12(b)(6), a complaint must contain sufficient factual matter, accepted as true, to state a claim to relief that is plausible on its face. Ashcroft v. Iqbal, 556 U.S. 662, 678 (2009). A claim has facial plausibility when the plaintiff pleads factual content that allows the court to draw the reasonable inference that the defendant is liable for the misconduct alleged. Id.\n\nIII. ARGUMENT\n\nA. The Breach of Contract Claim Should Be Dismissed\n\nUnder New York law, the elements of breach of contract are: (1) the existence of a valid contract; (2) performance by the plaintiff; (3) breach by the defendant; and (4) resulting damages. Harris v. Seward Park Housing Corp., 79 A.D.3d 425, 426 (1st Dep't 2010).\n\nHere, the Complaint fails to identify the specific contractual provision allegedly breached. The Complaint merely alleges in conclusory fashion that Defendant "failed to perform its obligations under the Agreement." Such threadbare recitals of the elements of a cause of action are insufficient under Iqbal.\n\nB. The Negligence Claim Should Be Dismissed\n\nThe negligence claim is barred by the economic loss doctrine. Under New York law, a plaintiff cannot recover in tort for purely economic losses arising from a breach of contract. Clark-Fitzpatrick, Inc. v. Long Island R.R. Co., 70 N.Y.2d 382, 389 (1987).\n\nIV. CONCLUSION\n\nFor the foregoing reasons, Defendant respectfully requests that this Court grant its Motion to Dismiss and dismiss the Complaint in its entirety with prejudice.\n\nDated: January 15, 2024\nNew York, New York\n\nRespectfully submitted,\n\nJOHNSON & SMITH LLP\n\nBy: /s/ Sarah Johnson\nSarah Johnson, Esq.\nAttorneys for Defendant Widget Industries, Inc.`,
  contract: `FORCE MAJEURE AND TERMINATION PROVISIONS\n\nSection 14.1 Force Majeure. Neither party shall be liable for any failure or delay in performing its obligations under this Agreement if such failure or delay results from circumstances beyond the reasonable control of that party, including but not limited to acts of God, natural disasters, war, terrorism, riots, embargoes, acts of civil or military authorities, fire, floods, epidemics, pandemics, quarantine restrictions, strikes, or transportation disruptions (each a "Force Majeure Event").\n\nSection 14.2 Notice of Force Majeure. The affected party shall provide written notice to the other party within five (5) business days of becoming aware of the Force Majeure Event, describing the nature of the event and the expected duration of the delay.\n\nSection 14.3 Termination for Convenience. Either party may terminate this Agreement for any reason upon ninety (90) days' prior written notice to the other party. Upon such termination, the terminating party shall pay all amounts due for services performed through the effective date of termination.\n\nSection 14.4 Termination for Cause. Either party may terminate this Agreement immediately upon written notice if the other party: (a) commits a material breach of this Agreement and fails to cure such breach within thirty (30) days after receiving written notice thereof; (b) becomes insolvent or files for bankruptcy protection; or (c) assigns this Agreement without the prior written consent of the other party.\n\nSection 14.5 Effect of Termination. Upon termination or expiration of this Agreement: (a) all licenses granted hereunder shall immediately terminate; (b) each party shall return or destroy all Confidential Information of the other party; (c) any accrued rights and obligations shall survive termination; and (d) Sections 8 (Confidentiality), 10 (Indemnification), 11 (Limitation of Liability), and 15 (Governing Law) shall survive termination.\n\nSection 14.6 Governing Law and Dispute Resolution. This Agreement shall be governed by and construed in accordance with the laws of the State of Delaware, without regard to its conflict of laws principles. Any dispute arising under this Agreement shall be resolved by binding arbitration administered by the American Arbitration Association under its Commercial Arbitration Rules.`,
  nda: `MUTUAL NON-DISCLOSURE AGREEMENT\n\nThis Mutual Non-Disclosure Agreement ("Agreement") is entered into as of April 1, 2024 (the "Effective Date"), by and between:\n\nPARTY A: Meridian Technologies, Inc., a Delaware corporation with its principal place of business at 2400 Sand Hill Road, Suite 300, Menlo Park, California 94025 ("Meridian"); and\n\nPARTY B: Atlas Data Systems, LLC, a New York limited liability company with its principal place of business at 250 Park Avenue South, 12th Floor, New York, New York 10003 ("Atlas").\n\nEach of Meridian and Atlas may be referred to individually as a "Party" and collectively as the "Parties."\n\nRECITALS\n\nWHEREAS, the Parties wish to explore a potential business relationship involving the integration of Meridian's artificial intelligence platform with Atlas's enterprise data management solutions (the "Purpose"); and\n\nWHEREAS, in connection with the Purpose, each Party may disclose to the other certain confidential and proprietary information; and\n\nWHEREAS, the Parties desire to set forth the terms and conditions under which such confidential information will be disclosed, received, and protected.\n\nNOW, THEREFORE, in consideration of the mutual covenants and agreements set forth herein, and for other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the Parties agree as follows:\n\nARTICLE 1. DEFINITION OF CONFIDENTIAL INFORMATION\n\n1.1 "Confidential Information" means any and all non-public, proprietary, or confidential information disclosed by either Party (the "Disclosing Party") to the other Party (the "Receiving Party"), whether orally, in writing, electronically, or by inspection of tangible objects, including without limitation:\n\n(a) trade secrets, inventions, ideas, processes, formulas, source and object code, algorithms, data, programs, software, specifications, and other works of authorship;\n\n(b) technical information including research, development, designs, engineering, hardware configuration, test results, and manufacturing processes;\n\n(c) business information including financial data, customer lists, vendor lists, pricing strategies, marketing plans, business strategies, forecasts, unpublished financial statements, budgets, projections, and licensing opportunities;\n\n(d) information regarding personnel, including organizational structure, compensation, and skill sets; and\n\n(e) any information that a reasonable person would understand to be confidential given the nature of the information and the circumstances of disclosure.\n\n1.2 Confidential Information shall not include information that: (a) was publicly known and generally available in the public domain prior to the time of disclosure by the Disclosing Party; (b) becomes publicly known and generally available after disclosure by the Disclosing Party through no wrongful action or inaction of the Receiving Party; (c) is already in the possession of the Receiving Party at the time of disclosure, as shown by the Receiving Party's files and records prior to the time of disclosure; (d) is obtained by the Receiving Party from a third party without a breach of such third party's obligations of confidentiality; or (e) is independently developed by the Receiving Party without use of or reference to the Disclosing Party's Confidential Information, as shown by documents and other competent evidence in the Receiving Party's possession.\n\nARTICLE 2. OBLIGATIONS OF THE RECEIVING PARTY\n\n2.1 Non-Disclosure. The Receiving Party shall not disclose any Confidential Information to any third parties without the prior written consent of the Disclosing Party, except as expressly permitted under this Agreement.\n\n2.2 Standard of Care. The Receiving Party shall protect the Disclosing Party's Confidential Information using the same degree of care that it uses to protect its own confidential information of a similar nature, but in no event less than a reasonable degree of care.\n\n2.3 Permitted Disclosures. The Receiving Party may disclose Confidential Information to its officers, directors, employees, agents, consultants, and professional advisors ("Representatives") who: (a) have a need to know such information in connection with the Purpose; and (b) are bound by written obligations of confidentiality no less restrictive than those set forth herein. The Receiving Party shall be responsible for any breach of this Agreement by its Representatives.\n\n2.4 Compelled Disclosure. If the Receiving Party is compelled by law, regulation, or legal process to disclose any Confidential Information, the Receiving Party shall, to the extent legally permitted, provide the Disclosing Party with prompt written notice of such requirement so that the Disclosing Party may seek a protective order or other appropriate remedy. The Receiving Party shall disclose only such Confidential Information as is legally required and shall use commercially reasonable efforts to obtain confidential treatment for any Confidential Information so disclosed.\n\nARTICLE 3. INTELLECTUAL PROPERTY RIGHTS\n\n3.1 Retention of Rights. All Confidential Information shall remain the property of the Disclosing Party. Nothing in this Agreement shall be construed as granting any rights, by license or otherwise, to the Receiving Party under any patent, copyright, trademark, or other intellectual property right of the Disclosing Party, except for the limited right to use such Confidential Information in connection with the Purpose.\n\n3.2 No Obligation. Nothing in this Agreement shall obligate either Party to proceed with any transaction or business relationship, or to purchase any service or product from the other Party.\n\nARTICLE 4. RETURN OR DESTRUCTION OF MATERIALS\n\n4.1 Upon the written request of the Disclosing Party, or upon termination of this Agreement, the Receiving Party shall promptly: (a) return all originals and copies of Confidential Information in tangible form; or (b) destroy all copies of Confidential Information in tangible and electronic form, and certify such destruction in writing. Notwithstanding the foregoing, the Receiving Party may retain one archival copy of the Confidential Information solely for compliance and legal purposes, subject to the continuing obligations of confidentiality set forth herein.\n\nARTICLE 5. TERM AND TERMINATION\n\n5.1 This Agreement shall be effective as of the Effective Date and shall continue in effect for a period of two (2) years, unless earlier terminated by either Party upon thirty (30) days' prior written notice to the other Party.\n\n5.2 The obligations of confidentiality set forth in this Agreement shall survive any termination or expiration of this Agreement for a period of three (3) years following the date of disclosure of such Confidential Information.\n\nARTICLE 6. REMEDIES\n\n6.1 Each Party acknowledges that any breach or threatened breach of this Agreement may cause irreparable harm to the Disclosing Party for which monetary damages may be an inadequate remedy. Accordingly, the Disclosing Party shall be entitled to seek equitable relief, including injunction and specific performance, in addition to all other remedies available at law or in equity, without the necessity of posting any bond or other security.\n\nARTICLE 7. GENERAL PROVISIONS\n\n7.1 Governing Law. This Agreement shall be governed by and construed in accordance with the laws of the State of Delaware, without regard to its conflict of laws principles.\n\n7.2 Entire Agreement. This Agreement constitutes the entire agreement between the Parties with respect to the subject matter hereof and supersedes all prior or contemporaneous oral or written agreements concerning such subject matter.\n\n7.3 Amendments. This Agreement may not be amended except by a written instrument signed by both Parties.\n\n7.4 Assignment. Neither Party may assign this Agreement without the prior written consent of the other Party, except that either Party may assign this Agreement to an affiliate or in connection with a merger, acquisition, or sale of all or substantially all of its assets.\n\n7.5 Severability. If any provision of this Agreement is held to be invalid or unenforceable, the remaining provisions shall continue in full force and effect.\n\n7.6 Counterparts. This Agreement may be executed in counterparts, each of which shall be deemed an original, but all of which together shall constitute one and the same instrument.\n\nIN WITNESS WHEREOF, the Parties have executed this Agreement as of the Effective Date.\n\nMERIDIAN TECHNOLOGIES, INC.\n\nBy: /s/ Katherine Chen\nName: Katherine Chen\nTitle: Chief Executive Officer\nDate: April 1, 2024\n\nATLAS DATA SYSTEMS, LLC\n\nBy: /s/ Marcus Williams\nName: Marcus Williams\nTitle: Managing Director\nDate: April 1, 2024`,

  complaint: `UNITED STATES DISTRICT COURT\nWESTERN DISTRICT OF WASHINGTON AT SEATTLE\n\nCase No. 2:24-cv-00891-JLR\n\nEMILY CHEN, individually and on\nbehalf of all others similarly situated,\n\n    Plaintiff,\n\nv.\n\nEVERGREEN HEALTH SYSTEMS, INC.,\na Washington corporation,\n\n    Defendant.\n\nCLASS ACTION COMPLAINT\n\nJURY TRIAL DEMANDED\n\nPlaintiff Emily Chen ("Plaintiff"), individually and on behalf of all others similarly situated, by and through her undersigned attorneys, brings this Class Action Complaint against Defendant Evergreen Health Systems, Inc. ("Evergreen" or "Defendant") and alleges the following based on personal knowledge, the investigation of counsel, and information and belief:\n\nNATURE OF THE ACTION\n\n1. This is a class action brought on behalf of approximately 2.4 million current and former patients of Evergreen Health Systems whose protected health information ("PHI") and personally identifiable information ("PII") was compromised in a massive data breach discovered on or about January 15, 2024 (the "Data Breach").\n\n2. Defendant Evergreen is one of the largest healthcare networks in the Pacific Northwest, operating seventeen hospitals and over ninety outpatient clinics across Washington, Oregon, and Idaho.\n\n3. The compromised data includes patients' names, dates of birth, Social Security numbers, medical record numbers, health insurance information, diagnosis and treatment information, prescription records, and financial account information.\n\n4. The Data Breach resulted from Defendant's failure to implement and maintain reasonable and adequate security measures to protect patients' sensitive personal and medical information, in violation of its obligations under federal and state law.\n\nPARTIES\n\n5. Plaintiff Emily Chen is a natural person and citizen of the State of Washington residing in King County. Plaintiff has been a patient of Evergreen since 2019 and received notification on February 3, 2024, that her personal and medical information was compromised in the Data Breach.\n\n6. Defendant Evergreen Health Systems, Inc. is a Washington corporation with its principal place of business at 1200 Medical Center Drive, Bellevue, Washington 98004. Evergreen provides healthcare services to patients throughout the Pacific Northwest and maintains electronic health records containing sensitive patient information.\n\nJURISDICTION AND VENUE\n\n7. This Court has subject matter jurisdiction pursuant to 28 U.S.C. § 1332(d)(2) because this is a class action in which the aggregate amount in controversy exceeds $5,000,000, exclusive of interest and costs, and at least one member of the proposed class is a citizen of a state different from Defendant.\n\n8. This Court has personal jurisdiction over Defendant because Evergreen is incorporated in Washington, maintains its principal place of business in this District, and conducts substantial business throughout this District.\n\n9. Venue is proper in this District pursuant to 28 U.S.C. § 1391(b) because Defendant resides in this District and a substantial part of the events giving rise to the claims occurred in this District.\n\nFACTUAL ALLEGATIONS\n\nI. Defendant's Collection and Storage of Sensitive Patient Data\n\n10. In the ordinary course of providing healthcare services, Evergreen collects, processes, and stores vast quantities of sensitive personal and medical information from its patients, including but not limited to: full legal names, dates of birth, Social Security numbers, home addresses, telephone numbers, email addresses, health insurance policy numbers, medical record numbers, clinical diagnoses, treatment plans, prescription medications, laboratory results, and billing and payment information.\n\n11. Patients provide this information to Evergreen with the reasonable expectation that Defendant will safeguard it in accordance with industry standards and applicable law, including the Health Insurance Portability and Accountability Act of 1996 ("HIPAA"), 42 U.S.C. § 1320d et seq., and its implementing regulations.\n\nII. The Data Breach\n\n12. On or about December 20, 2023, unauthorized actors gained access to Evergreen's computer network through a vulnerability in the company's remote access infrastructure. The intrusion went undetected for approximately twenty-six days.\n\n13. On January 15, 2024, Evergreen's information security team detected anomalous network activity and initiated an investigation with the assistance of a third-party cybersecurity firm.\n\n14. The investigation revealed that the unauthorized actors had accessed databases containing the PHI and PII of approximately 2.4 million current and former patients. The attackers exfiltrated data over the twenty-six-day period using encrypted channels to avoid detection.\n\n15. On February 1, 2024, Evergreen began notifying affected individuals by mail. The notification letters offered twelve months of complimentary credit monitoring and identity theft protection services.\n\nIII. Defendant's Inadequate Security Practices\n\n16. Upon information and belief, the Data Breach was the direct result of Evergreen's failure to implement and maintain reasonable security measures, including but not limited to:\n\n(a) Failure to implement multi-factor authentication on remote access systems;\n(b) Failure to timely apply security patches to known vulnerabilities;\n(c) Failure to maintain adequate network segmentation to limit lateral movement;\n(d) Failure to implement sufficient intrusion detection and monitoring systems;\n(e) Failure to encrypt sensitive patient data at rest;\n(f) Failure to conduct regular penetration testing and security assessments; and\n(g) Failure to maintain an adequate incident response plan.\n\n17. These failures violated HIPAA's Security Rule, 45 C.F.R. Part 164, which requires covered entities to implement administrative, physical, and technical safeguards to ensure the confidentiality, integrity, and availability of electronic protected health information.\n\nCLASS ALLEGATIONS\n\n18. Plaintiff brings this action pursuant to Federal Rules of Civil Procedure 23(a), 23(b)(2), and 23(b)(3) on behalf of the following class:\n\nAll persons in the United States whose personal information and/or protected health information was compromised in the Data Breach announced by Evergreen Health Systems, Inc. in February 2024 (the "Class").\n\n19. Excluded from the Class are Defendant, its officers, directors, and employees; the Judge assigned to this case; and any person who timely opts out of the Class.\n\n20. Numerosity: The Class is so numerous that joinder of all members is impracticable. Upon information and belief, the Class consists of approximately 2.4 million individuals.\n\n21. Commonality: Common questions of law and fact exist as to all members of the Class, including whether Defendant failed to implement reasonable security measures, whether Defendant's conduct violated applicable laws, and whether Class members suffered damages as a result.\n\n22. Typicality: Plaintiff's claims are typical of the claims of the Class because Plaintiff and all Class members were similarly harmed by Defendant's failure to protect their personal information.\n\n23. Adequacy: Plaintiff will fairly and adequately protect the interests of the Class. Plaintiff has retained counsel experienced in class action and data breach litigation.\n\nFIRST CAUSE OF ACTION\n(Negligence)\n\n24. Plaintiff realleges and incorporates by reference all preceding paragraphs.\n\n25. Defendant owed a duty of care to Plaintiff and the Class to exercise reasonable care in safeguarding their personal and medical information.\n\n26. Defendant breached this duty by failing to implement and maintain reasonable security measures to protect patient data from unauthorized access.\n\n27. As a direct and proximate result of Defendant's negligence, Plaintiff and the Class have suffered damages including but not limited to: the exposure of their sensitive personal and medical information, out-of-pocket expenses for credit monitoring, increased risk of identity theft and fraud, loss of the benefit of their bargain, and diminution in the value of their personal information.\n\nSECOND CAUSE OF ACTION\n(Violation of Washington Consumer Protection Act, RCW 19.86 et seq.)\n\n28. Plaintiff realleges and incorporates by reference all preceding paragraphs.\n\n29. Defendant's conduct constitutes an unfair or deceptive act or practice in violation of the Washington Consumer Protection Act.\n\n30. Defendant represented to patients that it would safeguard their personal and medical information, but failed to do so.\n\nTHIRD CAUSE OF ACTION\n(Breach of Implied Contract)\n\n31. Plaintiff realleges and incorporates by reference all preceding paragraphs.\n\n32. When Plaintiff and Class members provided their personal and medical information to Defendant, an implied contract was formed under which Defendant agreed to protect such information using reasonable security measures.\n\n33. Defendant breached this implied contract by failing to maintain adequate security measures, resulting in the Data Breach.\n\nPRAYER FOR RELIEF\n\nWHEREFORE, Plaintiff, individually and on behalf of the Class, respectfully requests that the Court:\n\n(a) Certify the proposed Class;\n(b) Appoint Plaintiff as Class Representative;\n(c) Appoint Plaintiff's counsel as Class Counsel;\n(d) Award compensatory and consequential damages;\n(e) Award statutory damages where applicable;\n(f) Award injunctive and declaratory relief;\n(g) Award reasonable attorneys' fees and costs;\n(h) Award pre-judgment and post-judgment interest; and\n(i) Grant such other and further relief as the Court deems just and proper.\n\nJURY DEMAND\n\nPlaintiff demands a trial by jury on all claims so triable.\n\nDated: March 1, 2024\nSeattle, Washington\n\nRespectfully submitted,\n\nPACIFIC NORTHWEST LEGAL GROUP\n\nBy: /s/ David A. Park\nDAVID A. PARK (WSBA No. 35278)\nMEGAN L. FOSTER (WSBA No. 42891)\n1201 Third Avenue, Suite 3600\nSeattle, WA 98101\nTelephone: (206) 555-7200\ndpark@pnwlegal.com\nmfoster@pnwlegal.com\n\nAttorneys for Plaintiff and the Proposed Class`,

  lease: `COMMERCIAL LEASE AGREEMENT\n\nThis Commercial Lease Agreement (this "Lease") is made and entered into as of March 15, 2024, by and between:\n\nLANDLORD: Harbor Point Properties LLC, a Maryland limited liability company ("Landlord"), with an address at 800 Light Street, Suite 200, Baltimore, Maryland 21230; and\n\nTENANT: Chesapeake Analytics Corp., a Delaware corporation ("Tenant"), with an address at 100 International Drive, Suite 1400, Baltimore, Maryland 21202.\n\nARTICLE 1. PREMISES\n\n1.1 Landlord hereby leases to Tenant, and Tenant hereby leases from Landlord, approximately 12,500 rentable square feet of office space located on the fourteenth (14th) floor of the building commonly known as Harbor Point Tower, located at 1000 Wills Street, Baltimore, Maryland 21231 (the "Building"), as more particularly described and outlined on Exhibit A attached hereto (the "Premises").\n\n1.2 Tenant's Proportionate Share of the Building shall be 4.17%, calculated by dividing the rentable square footage of the Premises (12,500 sq. ft.) by the total rentable square footage of the Building (300,000 sq. ft.).\n\nARTICLE 2. TERM\n\n2.1 Initial Term. The initial term of this Lease shall commence on June 1, 2024 (the "Commencement Date") and shall expire on May 31, 2031, unless sooner terminated in accordance with the terms hereof (the "Initial Term").\n\n2.2 Renewal Options. Tenant shall have two (2) options to renew this Lease for additional periods of five (5) years each (each a "Renewal Term"), upon written notice to Landlord not less than twelve (12) months prior to the expiration of the then-current term. The Base Rent during each Renewal Term shall be the then-prevailing fair market rental rate for comparable office space in the Inner Harbor submarket, but in no event less than the Base Rent in effect during the last year of the immediately preceding term.\n\nARTICLE 3. RENT\n\n3.1 Base Rent. Tenant shall pay to Landlord annual base rent ("Base Rent") in the following amounts:\n\nLease Year 1 (June 1, 2024 - May 31, 2025): $43.00 per rentable sq. ft. ($537,500.00 annually; $44,791.67 monthly)\nLease Years 2-3: $44.29 per rentable sq. ft. ($553,625.00 annually; $46,135.42 monthly)\nLease Years 4-5: $45.62 per rentable sq. ft. ($570,250.00 annually; $47,520.83 monthly)\nLease Years 6-7: $46.99 per rentable sq. ft. ($587,375.00 annually; $48,947.92 monthly)\n\n3.2 Additional Rent. In addition to Base Rent, Tenant shall pay Tenant's Proportionate Share of Operating Expenses (as defined in Section 3.3) and Real Estate Taxes (as defined in Section 3.4) in excess of the Base Year amounts (collectively, "Additional Rent").\n\n3.3 Operating Expenses. "Operating Expenses" shall mean all costs and expenses incurred by Landlord in connection with the ownership, management, operation, maintenance, and repair of the Building and the Land, including but not limited to: utilities, janitorial services, security, insurance premiums, management fees (not to exceed 4% of gross revenues), landscaping, snow removal, elevator maintenance, and capital improvements required by governmental authority or that are reasonably expected to reduce Operating Expenses, amortized over their useful life with interest at the Prime Rate plus two percent (2%).\n\n3.4 Real Estate Taxes. "Real Estate Taxes" shall mean all taxes, assessments, and governmental charges levied upon or with respect to the Building and the Land, including any taxes imposed in lieu thereof.\n\nARTICLE 4. SECURITY DEPOSIT\n\n4.1 Upon execution of this Lease, Tenant shall deposit with Landlord the sum of $89,583.34, representing two (2) months' Base Rent (the "Security Deposit"). The Security Deposit shall be held by Landlord as security for the faithful performance by Tenant of all terms, covenants, and conditions of this Lease.\n\n4.2 If Tenant fully performs all of its obligations under this Lease, the Security Deposit or any remaining balance thereof shall be returned to Tenant within thirty (30) days after the expiration or earlier termination of this Lease and Tenant's surrender of the Premises.\n\nARTICLE 5. USE OF PREMISES\n\n5.1 Permitted Use. The Premises shall be used and occupied solely for general office purposes, including data analytics, software development, and related administrative functions, and for no other purpose without the prior written consent of Landlord.\n\n5.2 Compliance with Laws. Tenant shall comply with all applicable federal, state, and local laws, ordinances, codes, rules, and regulations in its use and occupancy of the Premises, including without limitation the Americans with Disabilities Act of 1990 and all environmental laws.\n\nARTICLE 6. MAINTENANCE AND REPAIRS\n\n6.1 Landlord's Obligations. Landlord shall maintain in good condition and repair the structural elements of the Building, the Building's mechanical, electrical, plumbing, and HVAC systems, the common areas, the elevators, the exterior windows, and the roof.\n\n6.2 Tenant's Obligations. Tenant shall, at its sole cost and expense, maintain the Premises in good order, condition, and repair, including all non-structural interior improvements, fixtures, and equipment installed by or on behalf of Tenant.\n\nARTICLE 7. INSURANCE\n\n7.1 Tenant's Insurance. Throughout the Term, Tenant shall maintain at its expense: (a) commercial general liability insurance with limits of not less than $2,000,000 per occurrence and $5,000,000 in the aggregate; (b) property insurance covering Tenant's personal property, trade fixtures, and leasehold improvements in an amount equal to the full replacement cost thereof; (c) workers' compensation insurance as required by law; and (d) business interruption insurance covering a period of not less than twelve (12) months.\n\n7.2 Landlord shall be named as an additional insured on Tenant's commercial general liability policy. Certificates of insurance shall be delivered to Landlord prior to the Commencement Date and annually thereafter.\n\nARTICLE 8. ASSIGNMENT AND SUBLETTING\n\n8.1 Tenant shall not assign this Lease or sublet all or any portion of the Premises without the prior written consent of Landlord, which consent shall not be unreasonably withheld, conditioned, or delayed. Any assignment or subletting without Landlord's consent shall be void and shall constitute a default under this Lease.\n\n8.2 Notwithstanding Section 8.1, Tenant may assign this Lease or sublet the Premises without Landlord's consent to: (a) any entity that controls, is controlled by, or is under common control with Tenant; or (b) any entity that acquires all or substantially all of Tenant's assets or equity interests, provided such entity has a net worth equal to or greater than Tenant's net worth at the time of such transaction.\n\nARTICLE 9. DEFAULT AND REMEDIES\n\n9.1 Events of Default. The occurrence of any of the following shall constitute an "Event of Default": (a) Tenant fails to pay any installment of Rent within ten (10) days after written notice; (b) Tenant fails to observe or perform any other material term or condition of this Lease and fails to cure such failure within thirty (30) days after written notice; (c) Tenant files a petition in bankruptcy or is adjudicated bankrupt; or (d) Tenant abandons the Premises.\n\n9.2 Landlord's Remedies. Upon an Event of Default, Landlord may: (a) terminate this Lease by written notice; (b) re-enter the Premises and relet the same; and (c) recover from Tenant all damages incurred by reason of such default, including the worth at the time of award of the unpaid rent for the balance of the Term discounted to present value.\n\nIN WITNESS WHEREOF, the parties have executed this Lease as of the date first written above.\n\nHARBOR POINT PROPERTIES LLC\n\nBy: /s/ James R. O'Brien\nName: James R. O'Brien\nTitle: Managing Member\n\nCHESAPEAKE ANALYTICS CORP.\n\nBy: /s/ Priya Sharma\nName: Priya Sharma\nTitle: Chief Financial Officer`,

  patent: `IN THE UNITED STATES PATENT AND TRADEMARK OFFICE\n\nApplicant: NovaStar Biomedical, Inc.\nTitle: METHOD AND SYSTEM FOR REAL-TIME NEURAL PATHWAY MAPPING USING ADAPTIVE MULTI-FREQUENCY ELECTROMAGNETIC STIMULATION\nFiling Date: February 14, 2024\nApplication No.: 18/439,721\nArt Unit: 3793\nExaminer: Dr. Rachel M. Torres\nAttorney Docket No.: NOVA-2024-0087\n\nSPECIFICATION\n\nTITLE OF THE INVENTION\n\nMethod and System for Real-Time Neural Pathway Mapping Using Adaptive Multi-Frequency Electromagnetic Stimulation\n\nCROSS-REFERENCE TO RELATED APPLICATIONS\n\nThis application claims the benefit of U.S. Provisional Application No. 63/584,192, filed October 15, 2023, the entire disclosure of which is incorporated herein by reference.\n\nFIELD OF THE INVENTION\n\nThe present invention relates generally to neuroimaging and brain-computer interfaces, and more particularly to methods and systems for mapping neural pathways in real time using adaptive electromagnetic stimulation at multiple frequencies.\n\nBACKGROUND OF THE INVENTION\n\nExisting methods for neural pathway mapping, such as diffusion tensor imaging (DTI), functional magnetic resonance imaging (fMRI), and transcranial magnetic stimulation (TMS) mapping, suffer from significant limitations. DTI provides only static structural connectivity information and cannot capture real-time functional dynamics. fMRI offers functional information but with temporal resolution limited to the hemodynamic response (approximately 1-2 seconds). Conventional TMS mapping is limited to single-frequency stimulation and requires extensive manual repositioning of the stimulation coil.\n\nMoreover, current approaches do not account for the frequency-dependent nature of neural conduction along different fiber tracts. Myelinated fibers, unmyelinated fibers, and fibers of varying diameters respond optimally to different stimulation frequencies, a phenomenon well-documented in the neurophysiology literature. See, e.g., Rattay, F., "Analysis of Models for Extracellular Fiber Stimulation," IEEE Trans. Biomed. Eng., 36(7):676-682 (1989).\n\nAccordingly, there is a need for an improved method and system for real-time neural pathway mapping that leverages adaptive multi-frequency stimulation to achieve comprehensive, high-resolution connectivity mapping.\n\nSUMMARY OF THE INVENTION\n\nIn accordance with one aspect of the present invention, a method for real-time neural pathway mapping comprises: (a) positioning a multi-element electromagnetic stimulation array on or proximate to a subject's scalp; (b) delivering electromagnetic stimulation pulses at a first frequency to a target cortical region; (c) simultaneously recording evoked electromagnetic responses from a plurality of sensor elements distributed over the subject's scalp; (d) adaptively adjusting the stimulation frequency based on the recorded responses to optimize signal propagation along identified neural pathways; (e) repeating steps (b) through (d) at a plurality of stimulation frequencies spanning a range from approximately 50 Hz to approximately 5,000 Hz; and (f) constructing a three-dimensional neural pathway map from the aggregated response data using a computational model that correlates response latencies and amplitudes with pathway geometry and myelination characteristics.\n\nIn accordance with another aspect of the present invention, a system for real-time neural pathway mapping comprises: a multi-element electromagnetic stimulation array comprising a plurality of independently controllable stimulation coils arranged in a predetermined spatial configuration; a multi-channel sensor array comprising a plurality of electromagnetic field sensors; a controller configured to generate stimulation signals at selectable frequencies and to adaptively modify stimulation parameters in real time based on recorded responses; and a processing unit configured to execute a neural pathway reconstruction algorithm that generates a three-dimensional connectivity map from the recorded response data.\n\nDETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS\n\nReferring now to the drawings, wherein like reference numerals designate identical or corresponding parts throughout the several views, FIG. 1 illustrates a system 100 for real-time neural pathway mapping in accordance with the present invention.\n\nThe system 100 comprises a wearable headset 110 that incorporates both stimulation and sensing elements. The headset 110 includes a stimulation array 120 comprising thirty-two (32) independently controllable miniaturized electromagnetic stimulation coils 122 arranged in a geodesic configuration over the subject's scalp. Each stimulation coil 122 is capable of generating focused electromagnetic fields at frequencies ranging from 50 Hz to 5,000 Hz, with peak field intensities of up to 2.0 Tesla at the coil surface.\n\nThe headset 110 further includes a sensor array 130 comprising sixty-four (64) high-sensitivity magnetoencephalography (MEG) sensors 132 interleaved with the stimulation coils 122. The MEG sensors 132 are optically pumped magnetometers (OPMs) based on rubidium-87 vapor cells, providing sensitivity on the order of 10 fT/√Hz at room temperature.\n\nA controller unit 140 is communicatively coupled to the stimulation array 120 and the sensor array 130 via a high-speed digital interface 142. The controller unit 140 comprises a field-programmable gate array (FPGA) 144 configured to generate arbitrary stimulation waveforms with microsecond timing precision, and an analog-to-digital conversion subsystem 146 capable of simultaneously sampling all sixty-four sensor channels at a rate of 50,000 samples per second per channel.\n\nA processing unit 150, which may be implemented as a workstation computer or cloud computing resource, executes the neural pathway reconstruction algorithm. The algorithm employs a Bayesian inference framework to estimate the most probable pathway geometry given the observed stimulation-response data, taking into account prior anatomical information from a subject-specific MRI scan when available.\n\nThe adaptive frequency selection algorithm operates as follows. An initial stimulation pulse is delivered at a center frequency of 1,000 Hz to the target cortical region. The evoked responses recorded by the sensor array 130 are analyzed to identify responding sensor channels and their respective latencies. Based on the response characteristics, the algorithm classifies the responding pathways into categories corresponding to different fiber types (e.g., large myelinated fibers, small myelinated fibers, unmyelinated C fibers) and selects the optimal stimulation frequency for each category.\n\nCLAIMS\n\n1. A method for real-time neural pathway mapping, comprising:\n(a) positioning a multi-element electromagnetic stimulation array proximate to a subject's scalp;\n(b) delivering electromagnetic stimulation pulses at a first frequency to a target cortical region;\n(c) recording evoked electromagnetic responses from a plurality of sensor elements;\n(d) adaptively adjusting the stimulation frequency based on the recorded responses;\n(e) repeating steps (b) through (d) at a plurality of frequencies spanning from approximately 50 Hz to approximately 5,000 Hz; and\n(f) constructing a three-dimensional neural pathway map from aggregated response data.\n\n2. The method of claim 1, wherein the step of adaptively adjusting comprises classifying responding neural pathways by fiber type based on response latency and amplitude characteristics.\n\n3. The method of claim 2, wherein the fiber types comprise at least large myelinated fibers, small myelinated fibers, and unmyelinated fibers.\n\n4. The method of claim 1, wherein the constructing step employs a Bayesian inference framework incorporating subject-specific anatomical prior information.\n\n5. The method of claim 1, further comprising displaying the three-dimensional neural pathway map in real time during the stimulation procedure.\n\n6. A system for real-time neural pathway mapping, comprising:\na multi-element electromagnetic stimulation array comprising a plurality of independently controllable stimulation coils;\na multi-channel sensor array comprising a plurality of electromagnetic field sensors;\na controller configured to generate stimulation signals at selectable frequencies and to adaptively modify stimulation parameters; and\na processing unit configured to generate a three-dimensional connectivity map from recorded response data.\n\n7. The system of claim 6, wherein the stimulation coils are arranged in a geodesic configuration on a wearable headset.\n\n8. The system of claim 6, wherein the electromagnetic field sensors comprise optically pumped magnetometers.\n\n9. The system of claim 6, wherein the controller comprises a field-programmable gate array configured to generate stimulation waveforms with microsecond timing precision.\n\n10. The system of claim 6, wherein the processing unit is further configured to classify neural pathways by fiber type based on frequency-dependent response characteristics.\n\nABSTRACT\n\nA method and system for real-time neural pathway mapping using adaptive multi-frequency electromagnetic stimulation. The system includes a wearable headset with an array of miniaturized stimulation coils and high-sensitivity magnetoencephalography sensors. An adaptive algorithm selects optimal stimulation frequencies to interrogate different neural fiber types, enabling comprehensive connectivity mapping with high spatial and temporal resolution. A Bayesian inference framework reconstructs three-dimensional pathway geometry from the stimulation-response data.`,

  settlement: `SETTLEMENT AGREEMENT AND MUTUAL RELEASE\n\nThis Settlement Agreement and Mutual Release ("Agreement") is entered into as of May 1, 2024, by and among:\n\n(1) VERTEX PHARMACEUTICALS GROUP, INC., a Massachusetts corporation ("Vertex" or "Defendant"), and\n\n(2) LAURA THOMPSON, JAMES RODRIGUEZ, and ANNA KOWALSKI, individually and as designated Class Representatives on behalf of the Settlement Class (as defined herein) (collectively, "Plaintiffs" or "Class Representatives"),\n\nin connection with the class action lawsuit captioned Thompson et al. v. Vertex Pharmaceuticals Group, Inc., Case No. 1:22-cv-04521-PBS, pending in the United States District Court for the District of Massachusetts (the "Litigation").\n\nRECITALS\n\nA. On August 10, 2022, Plaintiffs filed the Litigation alleging that Vertex engaged in deceptive marketing practices regarding its prescription pain medication VX-440 (marketed as "ReliefPro"), claiming that Vertex overstated the drug's efficacy and understated its risk of dependency in violation of the Massachusetts Consumer Protection Act, M.G.L. c. 93A, and analogous state consumer protection statutes.\n\nB. On March 15, 2023, the Court certified a class consisting of all persons in the United States who purchased or were prescribed ReliefPro between January 1, 2020, and December 31, 2022.\n\nC. The Parties have conducted extensive discovery, including the review and production of over 1.2 million documents, depositions of twenty-three fact witnesses and eight expert witnesses, and analysis of prescription data, internal marketing materials, and clinical trial records.\n\nD. The Parties engaged in arm's-length settlement negotiations facilitated by the Honorable Edward F. Harrington (Ret.) of JAMS, including two full-day mediation sessions held on January 18, 2024, and March 5, 2024.\n\nE. Vertex denies all allegations of wrongdoing and liability but has agreed to enter into this Agreement to avoid the burden, expense, risk, and uncertainty of continued litigation.\n\nF. Class Counsel have conducted a thorough investigation and analysis of the facts, law, and allegations in the Litigation, and believe that the settlement set forth herein is fair, reasonable, and adequate, and in the best interests of the Settlement Class.\n\nNOW, THEREFORE, in consideration of the mutual covenants, agreements, and releases set forth herein, and for other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the Parties agree as follows:\n\nARTICLE 1. DEFINITIONS\n\n1.1 "Settlement Fund" means the non-reversionary sum of Two Hundred Seventy-Five Million Dollars ($275,000,000.00) to be paid by Vertex as set forth in Article 3.\n\n1.2 "Settlement Class" means all persons in the United States who purchased or were prescribed ReliefPro (VX-440) between January 1, 2020, and December 31, 2022, excluding: (a) Vertex, its officers, directors, and employees; (b) the judges presiding over the Litigation; and (c) persons who timely and validly exclude themselves.\n\n1.3 "Claims Administrator" means the independent third-party administrator appointed by the Court to administer the claims process, currently Epiq Class Action & Claims Solutions, Inc.\n\n1.4 "Effective Date" means the date on which the Court's Final Approval Order becomes final and non-appealable.\n\nARTICLE 2. CLASS SETTLEMENT PROCEDURES\n\n2.1 Preliminary Approval. Within fourteen (14) days of execution of this Agreement, Plaintiffs shall move the Court for entry of a Preliminary Approval Order that: (a) preliminarily approves this Agreement; (b) approves the form and manner of notice to the Settlement Class; (c) establishes a procedure for Settlement Class members to opt out or object; and (d) sets a date for a Final Approval Hearing.\n\n2.2 Notice Program. The Claims Administrator shall implement a notice program including: (a) individual notice by first-class mail and email to all reasonably identifiable Settlement Class members; (b) publication notice in USA Today, The New York Times, and People Magazine; (c) digital notice through targeted social media and internet advertising; and (d) a dedicated settlement website at www.ReliefProSettlement.com.\n\n2.3 Opt-Out and Objection Deadlines. Settlement Class members shall have sixty (60) days from the date of initial notice to submit written opt-out requests or objections to the settlement.\n\nARTICLE 3. SETTLEMENT CONSIDERATION\n\n3.1 Monetary Relief. Vertex shall pay or cause to be paid the Settlement Fund of $275,000,000.00 into an interest-bearing escrow account within thirty (30) days of Preliminary Approval.\n\n3.2 Allocation of Settlement Fund. The Settlement Fund shall be allocated as follows:\n\n(a) Tier 1 Claims (Documented Purchases with Adverse Effects): Settlement Class members who submit proof of ReliefPro purchase and documented medical records showing adverse effects consistent with dependency shall receive a pro rata share from seventy percent (70%) of the Net Settlement Fund.\n\n(b) Tier 2 Claims (Documented Purchases): Settlement Class members who submit proof of ReliefPro purchase but do not claim adverse effects shall receive a pro rata share from thirty percent (30%) of the Net Settlement Fund.\n\n3.3 Service Awards. Subject to Court approval, Class Representatives shall each receive a service award of $25,000.00 from the Settlement Fund in recognition of their service to the Settlement Class.\n\n3.4 Attorneys' Fees and Costs. Class Counsel shall petition the Court for an award of attorneys' fees not to exceed one-third (33.33%) of the Settlement Fund, plus reimbursement of reasonable litigation costs and expenses. Vertex shall take no position on the fee petition.\n\nARTICLE 4. INJUNCTIVE RELIEF\n\n4.1 Marketing Modifications. Within ninety (90) days of the Effective Date, Vertex shall:\n\n(a) Revise all marketing materials for ReliefPro to include clear and prominent warnings regarding the risk of dependency;\n(b) Discontinue all direct-to-consumer advertising that references pain relief without equally prominent disclosure of dependency risks;\n(c) Implement a mandatory physician education program regarding the appropriate prescribing of ReliefPro and monitoring for dependency.\n\n4.2 Independent Monitoring. Vertex shall retain an independent medical monitor, approved by Class Counsel, to oversee compliance with the injunctive relief provisions for a period of three (3) years from the Effective Date.\n\nARTICLE 5. RELEASE OF CLAIMS\n\n5.1 Upon the Effective Date, Plaintiffs and all Settlement Class members who have not timely and validly excluded themselves shall fully, finally, and forever release and discharge Vertex and its past, present, and future parents, subsidiaries, affiliates, officers, directors, employees, agents, insurers, and attorneys (the "Released Parties") from any and all claims, demands, rights, liabilities, and causes of action of every nature and description, whether known or unknown, that were or could have been asserted in the Litigation arising from or relating to the purchase, prescription, marketing, sale, or use of ReliefPro.\n\n5.2 Waiver of Unknown Claims. Plaintiffs and all Settlement Class members expressly waive and relinquish the provisions, rights, and benefits of Section 1542 of the California Civil Code, which provides: "A general release does not extend to claims that the creditor or releasing party does not know or suspect to exist in his or her favor at the time of executing the release and that, if known by him or her, would have materially affected his or her settlement with the debtor or released party."\n\nARTICLE 6. MISCELLANEOUS PROVISIONS\n\n6.1 Governing Law. This Agreement shall be governed by and construed in accordance with the laws of the Commonwealth of Massachusetts, without regard to its conflict of laws principles.\n\n6.2 Entire Agreement. This Agreement constitutes the entire agreement among the Parties and supersedes all prior and contemporaneous negotiations, representations, and agreements.\n\n6.3 No Admission. This Agreement is not an admission of liability, wrongdoing, or fault by Vertex.\n\nIN WITNESS WHEREOF, the Parties have executed this Agreement.\n\nVERTEX PHARMACEUTICALS GROUP, INC.\n\nBy: /s/ Margaret Sullivan\nMargaret Sullivan, Executive Vice President and General Counsel\n\nCLASS REPRESENTATIVES:\n\n/s/ Laura Thompson\nLaura Thompson\n\n/s/ James Rodriguez\nJames Rodriguez\n\n/s/ Anna Kowalski\nAnna Kowalski\n\nAPPROVED AS TO FORM:\n\nFor Plaintiffs:\n/s/ Richard Chen\nRichard Chen, Esq.\nChen & Associates LLP\nClass Counsel\n\nFor Defendant:\n/s/ William Hartford\nWilliam Hartford, Esq.\nKirkland & Ellis LLP\nCounsel for Vertex Pharmaceuticals Group, Inc.`,

  employment: `EXECUTIVE EMPLOYMENT AGREEMENT\n\nThis Executive Employment Agreement ("Agreement") is entered into as of January 2, 2024, by and between:\n\nEMPLOYER: Pinnacle Financial Holdings, Inc., a Delaware corporation (the "Company"), with its principal offices at 300 South Wacker Drive, Suite 4000, Chicago, Illinois 60606; and\n\nEXECUTIVE: Dr. Michael A. Torres ("Executive"), an individual residing at 1847 North Astor Street, Chicago, Illinois 60614.\n\nRECITALS\n\nWHEREAS, the Company desires to employ Executive as its Chief Technology Officer, and Executive desires to accept such employment, on the terms and conditions set forth herein;\n\nNOW, THEREFORE, in consideration of the mutual covenants contained herein and other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the parties agree as follows:\n\nARTICLE 1. EMPLOYMENT AND DUTIES\n\n1.1 Position. The Company hereby employs Executive as Chief Technology Officer ("CTO"), reporting directly to the Chief Executive Officer. Executive shall have responsibility for all technology strategy, software engineering, data infrastructure, cybersecurity, and information technology operations of the Company and its subsidiaries.\n\n1.2 Duties. Executive shall devote his full business time, attention, and energies to the performance of his duties and responsibilities, and shall perform such duties faithfully and to the best of his abilities. Executive may serve on the boards of directors of nonprofit organizations and engage in charitable activities, provided such activities do not materially interfere with Executive's duties hereunder.\n\n1.3 Principal Place of Employment. Executive's principal place of employment shall be the Company's Chicago headquarters, provided that Executive may be required to travel as reasonably necessary in connection with the Company's business.\n\nARTICLE 2. TERM\n\n2.1 Initial Term. The term of this Agreement shall commence on January 15, 2024 (the "Start Date") and shall continue for a period of three (3) years, unless earlier terminated in accordance with Article 6 (the "Initial Term").\n\n2.2 Automatic Renewal. Following the Initial Term, this Agreement shall automatically renew for successive one-year periods (each a "Renewal Term") unless either party provides written notice of non-renewal at least ninety (90) days prior to the expiration of the then-current term.\n\nARTICLE 3. COMPENSATION\n\n3.1 Base Salary. The Company shall pay Executive an annual base salary of Five Hundred Twenty-Five Thousand Dollars ($525,000.00) (the "Base Salary"), payable in accordance with the Company's standard payroll practices. The Base Salary shall be reviewed annually by the Board of Directors (the "Board") or its Compensation Committee and may be increased, but not decreased, in the Board's sole discretion.\n\n3.2 Annual Bonus. Executive shall be eligible to receive an annual performance bonus (the "Annual Bonus") with a target of seventy-five percent (75%) of Base Salary (the "Target Bonus") and a maximum of one hundred fifty percent (150%) of Base Salary, based on the achievement of individual and Company performance objectives established by the Board. The Annual Bonus, if earned, shall be paid within ninety (90) days following the end of the applicable fiscal year.\n\n3.3 Signing Bonus. The Company shall pay Executive a one-time signing bonus of One Hundred Fifty Thousand Dollars ($150,000.00), payable within thirty (30) days of the Start Date. If Executive voluntarily resigns without Good Reason or is terminated for Cause within twelve (12) months of the Start Date, Executive shall repay the full signing bonus. If such termination occurs between twelve (12) and twenty-four (24) months, Executive shall repay fifty percent (50%) of the signing bonus.\n\n3.4 Equity Compensation. Executive shall be granted the following equity awards under the Company's 2023 Equity Incentive Plan:\n\n(a) Stock Options: An option to purchase 150,000 shares of Company common stock at an exercise price equal to the fair market value on the date of grant, vesting in equal annual installments over four (4) years from the Start Date, subject to Executive's continued employment.\n\n(b) Restricted Stock Units: 50,000 restricted stock units ("RSUs"), vesting as follows: 25% on the first anniversary of the Start Date, and the remainder in equal quarterly installments over the following three (3) years, subject to Executive's continued employment.\n\n(c) Performance Stock Units: 30,000 performance stock units ("PSUs"), vesting based on the Company's achievement of three-year total shareholder return targets established by the Compensation Committee.\n\nARTICLE 4. BENEFITS\n\n4.1 Employee Benefits. Executive shall be entitled to participate in all employee benefit plans and programs generally available to senior executives of the Company, including health, dental, and vision insurance, life insurance, disability insurance, and the Company's 401(k) retirement plan.\n\n4.2 Paid Time Off. Executive shall be entitled to twenty-five (25) days of paid time off per calendar year, plus all Company-recognized holidays.\n\n4.3 Executive Perquisites. The Company shall provide Executive with: (a) a monthly automobile allowance of $1,500; (b) reimbursement of reasonable professional development and continuing education expenses up to $15,000 per year; (c) an annual executive physical examination; and (d) reimbursement of reasonable relocation expenses up to $75,000 in connection with Executive's relocation to Chicago, if applicable.\n\nARTICLE 5. RESTRICTIVE COVENANTS\n\n5.1 Confidential Information. During and after Executive's employment, Executive shall not disclose or use any Confidential Information except in the performance of his duties. "Confidential Information" includes trade secrets, proprietary technology, customer data, financial information, business strategies, algorithms, and any other non-public information relating to the Company's business.\n\n5.2 Non-Competition. During Executive's employment and for a period of twelve (12) months following the termination of Executive's employment for any reason (the "Restricted Period"), Executive shall not, directly or indirectly, engage in, be employed by, or provide services to any Competing Business within the United States. "Competing Business" means any entity that provides financial technology services, digital banking platforms, or payment processing solutions that compete with the Company's products and services.\n\n5.3 Non-Solicitation. During the Restricted Period, Executive shall not, directly or indirectly: (a) solicit, recruit, or hire any employee of the Company or its affiliates; or (b) solicit or induce any customer, client, vendor, or business partner of the Company to terminate or reduce its business relationship with the Company.\n\n5.4 Non-Disparagement. Executive shall not make any public statements that disparage the Company, its officers, directors, employees, or products. The Company shall instruct its senior officers and directors not to make any public statements that disparage Executive.\n\nARTICLE 6. TERMINATION\n\n6.1 Termination by the Company for Cause. The Company may terminate Executive's employment immediately for Cause. "Cause" means: (a) conviction of or plea of guilty or nolo contendere to a felony; (b) willful misconduct or gross negligence in the performance of duties; (c) material breach of this Agreement or Company policies; (d) fraud, embezzlement, or material dishonesty; or (e) willful failure to follow lawful directives of the Board after written notice and a thirty-day cure period.\n\n6.2 Termination Without Cause or for Good Reason. If the Company terminates Executive without Cause or Executive resigns for Good Reason, Executive shall be entitled to: (a) continued payment of Base Salary for eighteen (18) months; (b) payment of one and one-half (1.5) times the Target Bonus; (c) COBRA premium payments for eighteen (18) months; (d) accelerated vesting of all stock options and RSUs that would have vested within the twelve (12) months following termination; and (e) twelve (12) months of executive outplacement services.\n\n6.3 Change of Control. If Executive's employment is terminated without Cause or Executive resigns for Good Reason within twelve (12) months following a Change of Control (as defined in the Company's Equity Incentive Plan), Executive shall be entitled to: (a) a lump-sum payment equal to two (2) times the sum of Base Salary and Target Bonus; (b) immediate full vesting of all outstanding equity awards; and (c) COBRA premium payments for twenty-four (24) months.\n\n6.4 Good Reason. "Good Reason" means: (a) a material diminution in Executive's title, duties, or authority; (b) a reduction in Base Salary or Target Bonus percentage; (c) relocation of Executive's principal place of employment more than fifty (50) miles; or (d) a material breach of this Agreement by the Company, in each case that is not cured within thirty (30) days after written notice from Executive.\n\nARTICLE 7. GENERAL PROVISIONS\n\n7.1 Governing Law. This Agreement shall be governed by the laws of the State of Illinois, without regard to its conflict of laws principles.\n\n7.2 Dispute Resolution. Any dispute arising under this Agreement shall be resolved by binding arbitration in Chicago, Illinois, administered by JAMS under its Employment Arbitration Rules.\n\n7.3 Section 409A Compliance. This Agreement is intended to comply with or be exempt from Section 409A of the Internal Revenue Code, and shall be interpreted accordingly.\n\n7.4 Entire Agreement. This Agreement constitutes the entire agreement between the parties and supersedes all prior agreements relating to Executive's employment.\n\nIN WITNESS WHEREOF, the parties have executed this Agreement as of the date first written above.\n\nPINNACLE FINANCIAL HOLDINGS, INC.\n\nBy: /s/ Rebecca A. Morrison\nName: Rebecca A. Morrison\nTitle: Chief Executive Officer\n\nEXECUTIVE:\n\n/s/ Michael A. Torres\nDr. Michael A. Torres`,

  appellate: `IN THE UNITED STATES COURT OF APPEALS\nFOR THE FIFTH CIRCUIT\n\nNo. 24-30127\n\nGULF COAST ENVIRONMENTAL COALITION;\nBAYOU PRESERVATION SOCIETY;\nLOUISIANA WILDLIFE FEDERATION,\n\n    Petitioners-Appellants,\n\nv.\n\nUNITED STATES ENVIRONMENTAL PROTECTION AGENCY;\nMICHAEL S. REGAN, Administrator,\n\n    Respondents-Appellees,\n\nand\n\nPETROSTAR REFINING COMPANY, LLC,\n\n    Intervenor-Appellee.\n\nOn Appeal from the United States District Court\nfor the Eastern District of Louisiana\nNo. 2:23-cv-01847-MVL-JCW\n\nBRIEF OF PETITIONERS-APPELLANTS\n\nSTATEMENT OF JURISDICTION\n\nThe District Court had jurisdiction under 28 U.S.C. § 1331 and the Administrative Procedure Act, 5 U.S.C. §§ 701-706. The District Court entered final judgment on January 8, 2024. Petitioners timely filed their Notice of Appeal on February 5, 2024. This Court has jurisdiction under 28 U.S.C. § 1291.\n\nSTATEMENT OF THE ISSUES\n\n1. Whether the Environmental Protection Agency acted arbitrarily and capriciously in violation of the Administrative Procedure Act, 5 U.S.C. § 706(2)(A), when it issued a Clean Water Act permit to PetroStar Refining Company without adequately analyzing the cumulative impacts of industrial discharge on an already-impaired waterway.\n\n2. Whether the EPA violated the National Environmental Policy Act, 42 U.S.C. § 4332(C), by failing to prepare an Environmental Impact Statement for a permitting action that will significantly affect the quality of the human environment in an Environmental Justice community.\n\n3. Whether the EPA violated the Clean Water Act, 33 U.S.C. § 1342, by issuing a National Pollutant Discharge Elimination System permit that fails to ensure compliance with applicable water quality standards.\n\nSTATEMENT OF THE CASE\n\nThis case concerns the EPA's issuance of a National Pollutant Discharge Elimination System ("NPDES") permit to PetroStar Refining Company, LLC ("PetroStar") authorizing the discharge of up to 12 million gallons per day of treated industrial wastewater into Bayou Lafourche in Lafourche Parish, Louisiana.\n\nBayou Lafourche is a 106-mile distributary of the Mississippi River that serves as the primary drinking water source for approximately 300,000 residents in Lafourche and Terrebonne Parishes. The bayou has been listed as impaired under Section 303(d) of the Clean Water Act for dissolved oxygen, nutrients, and fecal coliform since 2008. The communities along Bayou Lafourche are predominantly low-income and minority populations that have been disproportionately burdened by industrial pollution.\n\nOn June 15, 2023, EPA Region 6 issued NPDES Permit No. LA0082341 to PetroStar, authorizing the discharge of treated wastewater containing, among other pollutants, benzene, toluene, ethylbenzene, xylenes (collectively, "BTEX compounds"), phenols, ammonia nitrogen, and total suspended solids. The permit was issued without the preparation of an Environmental Impact Statement under NEPA.\n\nPetitioners, three environmental organizations with members who live along, recreate on, and draw drinking water from Bayou Lafourche, challenged the permit in the District Court. The District Court granted summary judgment for Respondents on all claims. This appeal follows.\n\nSUMMARY OF THE ARGUMENT\n\nThe EPA's issuance of the PetroStar permit was arbitrary and capricious for three independent reasons.\n\nFirst, the EPA failed to consider the cumulative impacts of PetroStar's discharge in combination with the twelve other industrial facilities already permitted to discharge into the same segment of Bayou Lafourche. The EPA's analysis considered PetroStar's discharge in isolation, ignoring that the bayou is already impaired and that the aggregate loading of pollutants from all sources exceeds the waterway's assimilative capacity. This failure to consider cumulative impacts is the hallmark of arbitrary agency action.\n\nSecond, the EPA violated NEPA by issuing the permit without preparing an Environmental Impact Statement. The discharge of millions of gallons of industrial wastewater daily into an impaired waterway that serves as the drinking water supply for 300,000 people constitutes a "major Federal action significantly affecting the quality of the human environment" under 42 U.S.C. § 4332(C). The EPA's reliance on a Categorical Exclusion was manifestly unreasonable given the extraordinary circumstances present here.\n\nThird, the permit fails to ensure compliance with Louisiana's water quality standards, as required by Section 301(b)(1)(C) of the Clean Water Act, 33 U.S.C. § 1311(b)(1)(C). The permit's effluent limitations for BTEX compounds and ammonia nitrogen are insufficient to meet applicable water quality criteria when combined with existing background concentrations.\n\nARGUMENT\n\nI. STANDARD OF REVIEW\n\nThis Court reviews the District Court's grant of summary judgment de novo. Sierra Club v. EPA, 755 F.3d 968, 973 (5th Cir. 2014). Agency action is reviewed under the arbitrary and capricious standard of the APA, 5 U.S.C. § 706(2)(A). An agency acts arbitrarily and capriciously if it "relied on factors which Congress has not intended it to consider, entirely failed to consider an important aspect of the problem, offered an explanation for its decision that runs counter to the evidence before the agency, or is so implausible that it could not be ascribed to a difference in view or the product of agency expertise." Motor Vehicle Mfrs. Ass'n v. State Farm Mut. Auto. Ins. Co., 463 U.S. 29, 43 (1983).\n\nII. THE EPA FAILED TO CONSIDER CUMULATIVE IMPACTS\n\nThe Clean Water Act requires that NPDES permits ensure compliance with water quality standards. 33 U.S.C. § 1342(a)(1). This necessarily requires consideration of whether a proposed discharge, in combination with existing discharges, will cause or contribute to a violation of water quality standards. See 40 C.F.R. § 122.44(d)(1)(ii).\n\nThe administrative record reveals that the EPA considered only PetroStar's discharge in isolation, without analyzing the combined effect of PetroStar's discharge and the twelve other permitted industrial discharges into the same segment of Bayou Lafourche. This is precisely the type of "ostrich-like" approach to environmental review that courts have consistently rejected. See Kleppe v. Sierra Club, 427 U.S. 390, 410 (1976).\n\nThe record demonstrates that total pollutant loading into the relevant segment of Bayou Lafourche from existing sources already exceeds the waterway's total maximum daily load ("TMDL") for dissolved oxygen and nutrients. Adding PetroStar's discharge will further exceed these limits. The EPA's failure to grapple with this reality renders its permitting decision arbitrary.\n\nIII. THE EPA VIOLATED NEPA\n\nNEPA requires federal agencies to prepare an Environmental Impact Statement for "major Federal actions significantly affecting the quality of the human environment." 42 U.S.C. § 4332(C). The issuance of an NPDES permit is a "major Federal action." The question is whether it "significantly affects" the environment.\n\nThe Council on Environmental Quality's regulations identify several "significance" factors, including: the degree to which the action affects public health; the unique characteristics of the geographic area, such as proximity to drinking water supplies; and whether the action is related to other actions with individually insignificant but cumulatively significant impacts. 40 C.F.R. § 1508.27(b).\n\nAll of these factors are present here. The discharge will introduce known carcinogens (benzene) and other toxic compounds into a waterway that serves as the primary drinking water supply for 300,000 people. The affected communities are Environmental Justice communities already overburdened with industrial pollution. The cumulative impact of this additional discharge, combined with existing industrial sources, is significant.\n\nIV. THE PERMIT FAILS TO ENSURE COMPLIANCE WITH WATER QUALITY STANDARDS\n\nSection 301(b)(1)(C) of the Clean Water Act requires that NPDES permits include effluent limitations necessary to meet water quality standards. 33 U.S.C. § 1311(b)(1)(C). Louisiana's water quality standards establish numeric criteria for toxic pollutants including benzene (51 μg/L for human health criteria) and ammonia nitrogen.\n\nThe administrative record contains the EPA's own modeling showing that PetroStar's permitted discharge, when combined with existing background concentrations, will result in in-stream benzene concentrations of approximately 68 μg/L — exceeding the applicable water quality criterion by thirty-three percent. The EPA's response to this data — that the exceedance is "within the margin of modeling uncertainty" — is the type of post-hoc rationalization that this Court has repeatedly rejected.\n\nCONCLUSION\n\nFor the foregoing reasons, Petitioners respectfully request that this Court reverse the District Court's judgment and remand to the EPA with instructions to vacate NPDES Permit No. LA0082341 and to prepare an Environmental Impact Statement before any reissuance of the permit.\n\nRespectfully submitted,\n\n/s/ Catherine M. Broussard\nCATHERINE M. BROUSSARD\nTulane Environmental Law Clinic\n6329 Freret Street\nNew Orleans, LA 70118\nTel: (504) 865-5789\ncbroussard@tulane.edu\n\nCounsel for Petitioners-Appellants`,

  merger: `AGREEMENT AND PLAN OF MERGER\n\nThis Agreement and Plan of Merger (this "Agreement") is entered into as of February 28, 2024, by and among:\n\nACQUIROR: Constellation Digital Enterprises, Inc., a Delaware corporation ("Parent");\n\nMERGER SUB: CD Acquisition Corp., a Delaware corporation and wholly owned subsidiary of Parent ("Merger Sub"); and\n\nTARGET: Horizon Software Group, Inc., a California corporation (the "Company").\n\nParent, Merger Sub, and the Company are sometimes referred to herein individually as a "Party" and collectively as the "Parties."\n\nRECITALS\n\nWHEREAS, Parent desires to acquire the Company through the merger of Merger Sub with and into the Company, with the Company surviving as a wholly owned subsidiary of Parent (the "Merger"), on the terms and subject to the conditions set forth in this Agreement;\n\nWHEREAS, the Board of Directors of the Company (the "Company Board") has unanimously: (a) determined that this Agreement and the Merger are fair to and in the best interests of the Company and its stockholders; (b) approved and adopted this Agreement and the Merger; and (c) resolved to recommend that the stockholders of the Company adopt this Agreement;\n\nWHEREAS, the respective Boards of Directors of Parent and Merger Sub have approved this Agreement and the Merger; and\n\nWHEREAS, for federal income tax purposes, the Parties intend that the Merger qualify as a reorganization within the meaning of Section 368(a) of the Internal Revenue Code of 1986, as amended (the "Code").\n\nNOW, THEREFORE, in consideration of the mutual covenants and agreements set forth herein, and for other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the Parties agree as follows:\n\nARTICLE I. THE MERGER\n\n1.1 The Merger. Upon the terms and subject to the conditions set forth in this Agreement, at the Effective Time (as defined in Section 1.3), Merger Sub shall be merged with and into the Company. The Company shall be the surviving corporation in the Merger (the "Surviving Corporation") and shall continue its corporate existence under the laws of the State of California. The separate corporate existence of Merger Sub shall cease at the Effective Time.\n\n1.2 Closing. The closing of the Merger (the "Closing") shall take place at 10:00 a.m. Eastern Time on the third (3rd) business day following the satisfaction or waiver of the conditions set forth in Article VII (other than conditions that by their nature are to be satisfied at the Closing, but subject to satisfaction or waiver of such conditions), at the offices of Sullivan & Cromwell LLP, 125 Broad Street, New York, New York 10004, unless another date, time, or place is agreed to in writing by Parent and the Company (the "Closing Date").\n\n1.3 Effective Time. At the Closing, the Parties shall cause a Certificate of Merger to be filed with the Secretary of State of the State of California in accordance with the California General Corporation Law. The Merger shall become effective at the time of filing of the Certificate of Merger or at such later time as is agreed to by the Parties and specified in the Certificate of Merger (the "Effective Time").\n\nARTICLE II. MERGER CONSIDERATION\n\n2.1 Conversion of Company Stock. At the Effective Time, by virtue of the Merger and without any action on the part of Parent, Merger Sub, the Company, or any holder of any securities of the Company:\n\n(a) Each share of common stock of the Company ("Company Common Stock") issued and outstanding immediately prior to the Effective Time (other than Excluded Shares and Dissenting Shares) shall be converted into the right to receive Forty-Seven Dollars and Fifty Cents ($47.50) in cash, without interest (the "Merger Consideration").\n\n(b) Each share of Company Common Stock held in the treasury of the Company or owned by Parent or Merger Sub immediately prior to the Effective Time ("Excluded Shares") shall be cancelled and retired and shall cease to exist.\n\n2.2 Treatment of Company Options. At the Effective Time, each outstanding and unexercised option to purchase shares of Company Common Stock (each, a "Company Option") granted under the Company's equity incentive plans, whether or not then vested and exercisable, shall be cancelled and converted into the right to receive a cash payment equal to the product of (a) the excess, if any, of the Merger Consideration over the exercise price per share of such Company Option, multiplied by (b) the number of shares subject to such Company Option.\n\n2.3 Treatment of Company RSUs. At the Effective Time, each outstanding restricted stock unit with respect to shares of Company Common Stock (each, a "Company RSU"), whether or not then vested, shall be cancelled and converted into the right to receive a cash payment equal to the product of the Merger Consideration multiplied by the number of shares subject to such Company RSU.\n\nARTICLE III. REPRESENTATIONS AND WARRANTIES OF THE COMPANY\n\nThe Company represents and warrants to Parent and Merger Sub as follows:\n\n3.1 Organization. The Company is a corporation duly organized, validly existing, and in good standing under the laws of the State of California and has all requisite corporate power and authority to own, lease, and operate its properties and to carry on its business as presently conducted.\n\n3.2 Capitalization. The authorized capital stock of the Company consists of 200,000,000 shares of Company Common Stock, of which 85,432,167 shares are issued and outstanding as of the date hereof, and 10,000,000 shares of preferred stock, par value $0.001 per share, none of which are outstanding.\n\n3.3 Authority. The Company has all requisite corporate power and authority to execute and deliver this Agreement, to perform its obligations hereunder, and to consummate the Merger, subject to obtaining the Required Company Vote (as defined in Section 3.4).\n\n3.4 Required Company Vote. The affirmative vote of the holders of a majority of the outstanding shares of Company Common Stock entitled to vote thereon at the Company Stockholder Meeting (the "Required Company Vote") is the only vote of the holders of any class or series of capital stock of the Company necessary to adopt this Agreement.\n\nARTICLE IV. REPRESENTATIONS AND WARRANTIES OF PARENT AND MERGER SUB\n\nParent and Merger Sub jointly and severally represent and warrant to the Company as follows:\n\n4.1 Organization. Each of Parent and Merger Sub is a corporation duly organized, validly existing, and in good standing under the laws of the State of Delaware.\n\n4.2 Financing. Parent has delivered to the Company true, correct, and complete copies of executed commitment letters (the "Commitment Letters") pursuant to which the lenders party thereto have committed to provide debt financing in an aggregate amount of $2,800,000,000 (the "Debt Financing"), which together with available cash on hand of Parent, is sufficient to pay the aggregate Merger Consideration and all related fees and expenses.\n\nARTICLE V. COVENANTS\n\n5.1 Conduct of Company Business. During the period from the date hereof until the Effective Time, except as expressly contemplated by this Agreement or consented to in writing by Parent, the Company shall conduct its business in the ordinary course of business consistent with past practice and shall use commercially reasonable efforts to preserve intact its business organization and relationships with customers, suppliers, and employees.\n\n5.2 No Solicitation. From and after the date hereof, the Company shall not, and shall cause its subsidiaries and their respective officers, directors, employees, agents, and representatives not to, directly or indirectly: (a) solicit, initiate, or knowingly encourage any Alternative Proposal; (b) engage in, continue, or participate in any discussions or negotiations with respect to an Alternative Proposal; or (c) enter into any agreement relating to an Alternative Proposal.\n\n5.3 Fiduciary Exception. Notwithstanding Section 5.2, the Company Board may, prior to obtaining the Required Company Vote, engage in discussions with and provide information to a third party that has made a bona fide unsolicited Alternative Proposal that the Company Board determines in good faith, after consultation with its financial advisors and outside legal counsel, constitutes or could reasonably be expected to lead to a Superior Proposal, provided that the Company provides prompt written notice to Parent of any such discussions.\n\nARTICLE VI. TERMINATION\n\n6.1 This Agreement may be terminated at any time prior to the Effective Time: (a) by mutual written consent of Parent and the Company; (b) by either Parent or the Company if the Merger has not been consummated by August 31, 2024 (the "Outside Date"); (c) by either Party if any governmental authority has issued a final, non-appealable order prohibiting the Merger; (d) by Parent if the Company Board has made an Adverse Recommendation Change; or (e) by the Company in order to enter into a definitive agreement with respect to a Superior Proposal, subject to payment of the Termination Fee.\n\n6.2 Termination Fee. If this Agreement is terminated pursuant to Section 6.1(d) or 6.1(e), the Company shall pay Parent a termination fee of $120,000,000 (the "Termination Fee") in immediately available funds within two (2) business days of such termination.\n\nARTICLE VII. CONDITIONS TO CLOSING\n\n7.1 Conditions to Each Party's Obligations. The obligations of each Party to consummate the Merger are subject to: (a) adoption of this Agreement by the Required Company Vote; (b) the absence of any law or order prohibiting the Merger; and (c) the expiration or termination of any waiting period under the Hart-Scott-Rodino Antitrust Improvements Act of 1976.\n\nIN WITNESS WHEREOF, the Parties have caused this Agreement to be executed as of the date first written above.\n\nCONSTELLATION DIGITAL ENTERPRISES, INC.\n\nBy: /s/ Alexander Novak\nName: Alexander Novak\nTitle: Chairman and Chief Executive Officer\n\nCD ACQUISITION CORP.\n\nBy: /s/ Sandra Liu\nName: Sandra Liu\nTitle: President\n\nHORIZON SOFTWARE GROUP, INC.\n\nBy: /s/ Thomas Whitfield\nName: Thomas Whitfield\nTitle: Chairman and Chief Executive Officer`,

  injunction: `UNITED STATES DISTRICT COURT\nMIDDLE DISTRICT OF FLORIDA\nTAMPA DIVISION\n\nCase No. 8:24-cv-00412-CEH-CPT\n\nSOVEREIGN HEALTH NETWORKS, LLC,\na Florida limited liability company,\n\n    Plaintiff,\n\nv.\n\nDR. JENNIFER WHITMORE; WHITMORE\nMEDICAL CONSULTING GROUP, INC.,\na Georgia corporation; and APEX\nHEALTHCARE PARTNERS, LLC, a\nDelaware limited liability company,\n\n    Defendants.\n\nVERIFIED MOTION FOR TEMPORARY RESTRAINING ORDER\nAND PRELIMINARY INJUNCTION\n\nPlaintiff Sovereign Health Networks, LLC ("Sovereign" or "Plaintiff"), by and through undersigned counsel, respectfully moves this Court for entry of a Temporary Restraining Order ("TRO") and Preliminary Injunction against Defendants Dr. Jennifer Whitmore ("Dr. Whitmore"), Whitmore Medical Consulting Group, Inc. ("Whitmore Consulting"), and Apex Healthcare Partners, LLC ("Apex") (collectively, "Defendants"), and in support thereof states as follows:\n\nI. INTRODUCTION\n\n1. Sovereign brings this emergency motion to prevent the continued misappropriation of its trade secrets, breach of contractual non-competition and non-solicitation obligations, and tortious interference with its business relationships by its former Chief Medical Officer, Dr. Jennifer Whitmore, who departed Sovereign on January 31, 2024, and immediately began competing against Sovereign using Sovereign's proprietary information, client relationships, and confidential business strategies.\n\n2. Time is of the essence. Since her departure, Dr. Whitmore has already contacted at least fourteen of Sovereign's twenty largest clients, solicited three key Sovereign employees, and formed a competing entity — Whitmore Medical Consulting Group — that is actively marketing services virtually identical to Sovereign's proprietary care management platform using information and methodologies that Dr. Whitmore developed while at Sovereign and that constitute Sovereign's trade secrets.\n\nII. STATEMENT OF FACTS\n\nA. Sovereign's Business\n\n3. Sovereign is a healthcare management and consulting company headquartered in Tampa, Florida, that provides population health management, clinical analytics, value-based care consulting, and care coordination services to hospitals, health systems, and physician groups throughout the southeastern United States.\n\n4. Sovereign has invested over $18 million over the past six years in developing its proprietary care management platform, known internally as "CareSync Pro," which includes proprietary algorithms for patient risk stratification, care gap identification, quality measure optimization, and predictive analytics for hospital readmission prevention.\n\n5. Sovereign's client list, pricing structures, contract terms, client-specific performance data, and business development pipeline constitute valuable trade secrets that provide Sovereign with a competitive advantage in the healthcare consulting market.\n\nB. Dr. Whitmore's Employment and Contractual Obligations\n\n6. Dr. Whitmore served as Sovereign's Chief Medical Officer from March 2019 through January 31, 2024. In this role, Dr. Whitmore had access to virtually all of Sovereign's confidential business information, including trade secrets, client data, financial information, strategic plans, and proprietary methodologies.\n\n7. On March 1, 2019, Dr. Whitmore executed an Employment Agreement (the "Agreement") containing the following restrictive covenants:\n\n(a) Non-Competition: For a period of eighteen (18) months following termination, Dr. Whitmore agreed not to "directly or indirectly engage in, be employed by, or provide services to any business that provides population health management, clinical analytics, or value-based care consulting services to healthcare providers within the States of Florida, Georgia, Alabama, Tennessee, or the Carolinas."\n\n(b) Non-Solicitation of Clients: For a period of twenty-four (24) months following termination, Dr. Whitmore agreed not to "directly or indirectly solicit, contact, or provide services to any client or prospective client of Sovereign with whom Dr. Whitmore had material contact during the last two years of her employment."\n\n(c) Non-Solicitation of Employees: For a period of eighteen (18) months following termination, Dr. Whitmore agreed not to "directly or indirectly recruit, solicit, or hire any employee of Sovereign."\n\n(d) Confidentiality: Dr. Whitmore agreed to maintain the confidentiality of all Confidential Information (as defined in the Agreement) in perpetuity and to return all Confidential Information upon termination.\n\n8. The Agreement provides that in the event of breach, Sovereign shall be entitled to injunctive relief, and that Dr. Whitmore acknowledges that monetary damages would be an inadequate remedy for any breach of the restrictive covenants.\n\nC. Dr. Whitmore's Misconduct\n\n9. On January 15, 2024, Dr. Whitmore submitted her resignation effective January 31, 2024. During the two-week notice period, Sovereign's IT department discovered that Dr. Whitmore had, between December 15, 2023 and January 14, 2024, downloaded approximately 4,700 files from Sovereign's secure servers to a personal cloud storage account, including:\n\n(a) The complete CareSync Pro technical documentation and algorithm specifications;\n(b) Client contracts, pricing schedules, and performance reports for all current clients;\n(c) Sovereign's three-year strategic business plan and financial projections;\n(d) Employee compensation data and organizational charts; and\n(e) The entire business development pipeline, including proposals in progress.\n\n10. On February 12, 2024, Dr. Whitmore incorporated Whitmore Medical Consulting Group, Inc. in the State of Georgia. The company's website, which went live on February 20, 2024, describes services virtually identical to Sovereign's CareSync Pro platform, using language that appears to be directly copied from Sovereign's proprietary marketing materials.\n\n11. Between February 5, 2024 and March 1, 2024, Dr. Whitmore personally contacted at least fourteen of Sovereign's top twenty clients, including Baptist Health South Florida, Emory Healthcare, and HCA Healthcare's Gulf Coast Division, offering competing services at prices 15-20% below Sovereign's rates — pricing that could only have been derived from knowledge of Sovereign's confidential rate structures.\n\n12. Dr. Whitmore has solicited at least three of Sovereign's key employees: Dr. Robert Kim (Director of Clinical Analytics), Sarah Chen (Vice President of Client Services), and Marcus Johnson (Senior Data Scientist). Dr. Kim has already submitted his resignation, effective March 15, 2024.\n\nIII. LEGAL STANDARD\n\nTo obtain a TRO and preliminary injunction, Plaintiff must demonstrate: (1) a substantial likelihood of success on the merits; (2) a substantial threat of irreparable harm if the injunction is not granted; (3) that the threatened injury outweighs any harm the injunction may cause Defendants; and (4) that the injunction would not be adverse to the public interest. Winter v. Natural Res. Def. Council, Inc., 555 U.S. 7, 20 (2008).\n\nIV. ARGUMENT\n\nA. Substantial Likelihood of Success on the Merits\n\nPlaintiff is substantially likely to prevail on its claims for: (1) trade secret misappropriation under the Defend Trade Secrets Act, 18 U.S.C. § 1836, and the Florida Uniform Trade Secrets Act, Fla. Stat. § 688.001 et seq.; (2) breach of the Non-Competition, Non-Solicitation, and Confidentiality provisions of the Agreement; and (3) tortious interference with business relationships.\n\nThe evidence demonstrates that Dr. Whitmore systematically downloaded Sovereign's trade secrets before her departure, formed a competing entity within two weeks of leaving, and immediately began soliciting Sovereign's clients and employees in direct violation of her contractual obligations.\n\nB. Irreparable Harm\n\nSovereign faces irreparable harm that cannot be remedied by monetary damages alone. The loss of client relationships built over years of service, the disclosure and use of trade secrets whose value is destroyed once revealed to competitors, and the erosion of Sovereign's competitive position constitute classic irreparable injuries. See BellSouth Telecomms., Inc. v. MCIMetro Access Transmission Servs., LLC, 425 F.3d 964, 970 (11th Cir. 2005).\n\nFurthermore, the Agreement itself reflects Dr. Whitmore's acknowledgment that monetary damages would be inadequate in the event of a breach of the restrictive covenants.\n\nC. Balance of Hardships\n\nThe balance of hardships tips decidedly in Sovereign's favor. Sovereign faces the potential loss of client relationships generating over $12 million in annual revenue, the permanent destruction of trade secrets developed at a cost of $18 million, and the loss of key employees. Dr. Whitmore, by contrast, is merely being asked to comply with the contractual obligations she voluntarily assumed.\n\nD. Public Interest\n\nThe public interest favors enforcement of valid contractual obligations and the protection of trade secrets. See Burger King Corp. v. Ashland Equities, Inc., 181 F. Supp. 2d 1366, 1372 (S.D. Fla. 2002).\n\nV. REQUESTED RELIEF\n\nWHEREFORE, Plaintiff respectfully requests that this Court enter a Temporary Restraining Order and Preliminary Injunction:\n\n(a) Enjoining Dr. Whitmore from engaging in any business that competes with Sovereign within the geographic and temporal scope of the Non-Competition covenant;\n(b) Enjoining all Defendants from soliciting or providing services to any current or former client of Sovereign;\n(c) Enjoining all Defendants from soliciting, recruiting, or hiring any current employee of Sovereign;\n(d) Requiring Dr. Whitmore to immediately return all Confidential Information and trade secrets of Sovereign, including all copies in any form;\n(e) Requiring Dr. Whitmore to provide Sovereign with access to her personal devices and cloud storage accounts for forensic imaging to identify and recover Sovereign's Confidential Information; and\n(f) Granting such other and further relief as the Court deems just and proper.\n\nDated: March 5, 2024\nTampa, Florida\n\nRespectfully submitted,\n\nCARLTON FIELDS, P.A.\n\nBy: /s/ Victoria R. Gonzalez\nVICTORIA R. GONZALEZ (Fla. Bar No. 987654)\nMATTHEW J. DAVIDSON (Fla. Bar No. 876543)\n4221 W. Boy Scout Boulevard, Suite 1000\nTampa, FL 33607\nTelephone: (813) 223-7000\nvgonzalez@carltonfields.com\nmdavidson@carltonfields.com\n\nAttorneys for Plaintiff\nSovereign Health Networks, LLC\n\nVERIFICATION\n\nI, David R. Castellano, as Chief Executive Officer of Sovereign Health Networks, LLC, hereby verify under penalty of perjury that I have read the foregoing Verified Motion for Temporary Restraining Order and Preliminary Injunction, and the facts stated therein are true and correct to the best of my knowledge, information, and belief.\n\n/s/ David R. Castellano\nDavid R. Castellano\nChief Executive Officer\nSovereign Health Networks, LLC\n\nSworn to and subscribed before me this 5th day of March, 2024.\n\n/s/ Maria L. Santos\nMaria L. Santos\nNotary Public, State of Florida\nMy Commission Expires: September 30, 2026`,

  regulatory: `BEFORE THE SECURITIES AND EXCHANGE COMMISSION\n\nIn the Matter of:\n\nSILVERLINE CAPITAL MANAGEMENT, LLC,\nRegistered Investment Adviser,\nFile No. 801-78234\n\nRESPONDENT'S RESPONSE TO ORDER INSTITUTING ADMINISTRATIVE PROCEEDINGS\nPursuant to Sections 203(e) and 203(k) of the Investment Advisers Act of 1940\n\nI. PRELIMINARY STATEMENT\n\nRespondent Silverline Capital Management, LLC ("Silverline" or "Respondent"), through its undersigned counsel, submits this Response to the Order Instituting Administrative Proceedings ("OIP") dated January 22, 2024. Silverline respectfully contends that the Division of Enforcement (the "Division") has overstated the nature and extent of the alleged violations, and that the relief sought is disproportionate to the conduct at issue.\n\nSilverline is a registered investment adviser based in Greenwich, Connecticut, founded in 2012, with approximately $3.2 billion in assets under management. Silverline provides investment advisory services to institutional investors, pension funds, endowments, and high-net-worth individuals through several private investment funds focused on technology and healthcare sectors.\n\nSilverline takes its compliance obligations seriously. Upon identifying the issues raised by the Division, Silverline took immediate corrective action, voluntarily disclosed the matters to the Commission, cooperated fully throughout the investigation, and has implemented comprehensive remedial measures to prevent recurrence.\n\nII. RESPONSE TO ALLEGATIONS\n\nA. Alleged Failure to Disclose Conflicts of Interest (OIP ¶¶ 12-24)\n\nThe Division alleges that Silverline failed to adequately disclose conflicts of interest arising from: (1) its allocation of investment opportunities between the Silverline Technology Fund, LP ("Tech Fund") and the Silverline Healthcare Opportunities Fund, LP ("Healthcare Fund"); and (2) Silverline's co-investment arrangements with certain employees.\n\n1. Investment Allocation\n\nSilverline acknowledges that during the period from January 2021 through June 2023, its allocation procedures for cross-over investments — investments suitable for both the Tech Fund and the Healthcare Fund — were not sufficiently documented. However, Silverline disputes the Division's characterization that the allocation process was "arbitrary" or designed to favor one fund over another.\n\nThe facts demonstrate that Silverline's Investment Committee made allocation decisions based on legitimate investment criteria, including each fund's investment thesis, portfolio concentration limits, available capital, and sector exposure targets. An independent analysis conducted by Ernst & Young LLP at Silverline's request confirmed that during the relevant period, the Tech Fund and Healthcare Fund received substantially equal economic value from cross-over allocations when adjusted for fund size and available capital.\n\nSilverline acknowledges that its Form ADV Part 2A disclosure regarding the allocation process was insufficiently specific. The disclosure stated that Silverline "seeks to allocate investment opportunities fairly among its funds" but did not describe the specific criteria used for allocation decisions or the potential conflicts inherent in managing multiple funds with overlapping investment mandates. Silverline has since revised its Form ADV to include a detailed description of its allocation policies and procedures, including the role of the Investment Committee, the specific criteria considered, and the independent oversight mechanisms now in place.\n\n2. Employee Co-Investment Arrangements\n\nThe Division alleges that Silverline failed to disclose that certain senior investment professionals were permitted to co-invest in specific transactions alongside Silverline's funds. Silverline acknowledges that from 2020 through 2022, it permitted co-investment by senior professionals under an informal arrangement that was not memorialized in the firm's compliance manual or disclosed in its Form ADV.\n\nSilverline notes, however, that the co-investment was limited to the firm's four most senior investment professionals, the aggregate co-investment did not exceed 2% of any single transaction, and the co-investment was made on terms identical to those of the funds. No investor was disadvantaged by these arrangements, and no investor has alleged otherwise.\n\nNonetheless, Silverline recognizes that the failure to disclose the co-investment arrangement was inconsistent with its fiduciary duty to provide full and fair disclosure. Silverline has: (a) terminated the informal co-investment arrangement; (b) adopted a formal Co-Investment Policy that requires advance approval by the Chief Compliance Officer and disclosure to the Advisory Board of each fund; and (c) disclosed the prior co-investment activity and the new policy in its revised Form ADV.\n\nB. Alleged Deficiencies in Compliance Program (OIP ¶¶ 25-35)\n\nThe Division alleges that Silverline's compliance program was inadequate under Rule 206(4)-7 of the Investment Advisers Act during the period from 2020 through mid-2023. Silverline acknowledges that its compliance infrastructure did not keep pace with the firm's growth from approximately $800 million in AUM in 2018 to $3.2 billion by 2023.\n\nSpecifically, Silverline acknowledges: (a) the Chief Compliance Officer from 2019 through March 2023 lacked sufficient resources and authority to effectively oversee the firm's expanded operations; (b) the firm's written compliance policies were not updated to reflect changes in the firm's business practices, including the launch of the Healthcare Fund in 2020; and (c) the annual compliance review required by Rule 206(4)-7 was not conducted in 2021.\n\nSilverline has taken the following remedial steps:\n\n(a) Appointed a new Chief Compliance Officer, Jennifer Blake, in April 2023. Ms. Blake has twenty years of compliance experience in the investment management industry, including eight years as CCO at a similarly-sized registered investment adviser.\n\n(b) Engaged Compliance Solutions Associates, LLC as an independent compliance consultant to conduct a comprehensive review of Silverline's compliance program and to recommend enhancements.\n\n(c) Adopted a completely revised Compliance Manual, addressing all areas identified by the Division and the independent consultant, including: allocation procedures, conflict-of-interest disclosures, personal trading, code of ethics, valuation procedures, marketing and advertising, and cybersecurity.\n\n(d) Implemented a compliance technology platform (ComplySci) for automated monitoring of personal trading, outside business activities, and political contributions.\n\n(e) Conducted mandatory compliance training for all employees, with enhanced training for investment professionals and senior management.\n\nC. Alleged Valuation Deficiencies (OIP ¶¶ 36-42)\n\nThe Division alleges that Silverline failed to implement adequate procedures for the valuation of certain illiquid private investments held by its funds, and that this resulted in overstatement of fund net asset values during certain quarterly periods.\n\nSilverline disputes that its valuation practices resulted in material overstatement of fund NAVs. Silverline's funds invest primarily in late-stage private technology and healthcare companies that have received institutional venture capital financing. Valuations were based on the most recent round of institutional financing, adjusted for subsequent material events, and were reviewed by the funds' independent auditor, Deloitte & Touche LLP.\n\nSilverline acknowledges that in three instances during 2022, interim valuations of portfolio companies were not adjusted in a timely manner following material negative developments (specifically, the failure to achieve clinical milestones for two healthcare investments and a significant customer loss for one technology investment). In each case, the valuation was corrected in the following quarter, and the aggregate impact across all three instances was an overstatement of fund NAV of approximately 1.2% for one quarter.\n\nSilverline has: (a) adopted a formal Valuation Policy that requires monthly review of portfolio company developments and interim valuation adjustments when material events occur; (b) engaged Duff & Phelps as an independent valuation firm to provide quarterly valuations of all Level 3 assets; and (c) established a Valuation Committee consisting of the CFO, CCO, and an independent advisory board member.\n\nIII. RESPONSE TO PROPOSED SANCTIONS\n\nThe Division seeks: (a) a cease-and-desist order; (b) censure; (c) a civil monetary penalty of $4,500,000; and (d) disgorgement of $1,200,000 in allegedly ill-gotten gains plus prejudgment interest.\n\nSilverline respectfully submits that the proposed sanctions are disproportionate given: (1) Silverline's voluntary self-disclosure and full cooperation; (2) the absence of any investor losses attributable to the alleged violations; (3) the comprehensive remedial measures already implemented; (4) Silverline's clean disciplinary history over twelve years of registration; and (5) the fact that the conduct at issue reflects compliance deficiencies rather than intentional misconduct or fraud.\n\nSilverline does not oppose entry of a cease-and-desist order and censure. With respect to monetary sanctions, Silverline respectfully requests that the Commission consider: (a) a reduced civil monetary penalty of $1,500,000, reflecting the mitigating factors described above; and (b) that disgorgement is not appropriate because no investor suffered any loss and Silverline did not obtain any ill-gotten gains from the conduct at issue.\n\nIV. CONCLUSION\n\nSilverline takes these proceedings seriously and is committed to maintaining the highest standards of compliance and investor protection. The comprehensive remedial measures described above demonstrate Silverline's commitment to full compliance with the Investment Advisers Act and the rules thereunder.\n\nRespectfully submitted,\n\nDAVIS POLK & WARDWELL LLP\n\nBy: /s/ Andrew M. Hutchinson\nANDREW M. HUTCHINSON\nKATHERINE R. O'CONNOR\n450 Lexington Avenue\nNew York, NY 10017\nTelephone: (212) 450-4000\nandrew.hutchinson@davispolk.com\nkatherine.oconnor@davispolk.com\n\nCounsel for Respondent\nSilverline Capital Management, LLC\n\nDated: March 20, 2024`,

  narr_pi: `MARTINEZ v. REGIONAL TRANSIT AUTHORITY\nCase No. 2023-CV-04872\nClient: Rosa Martinez\nMatter: Personal Injury — Bus Collision / Traumatic Brain Injury\n\nBILLING NARRATIVE — TIME ENTRIES\n\n03/04/2024  S. Nakamura  3.50 hrs\nReviewed emergency room records from St. Luke's Medical Center (48 pages) and ambulance transport records from City EMS regarding client's injuries sustained in March 1 bus collision at intersection of Broadway and 42nd Street. Identified documented loss of consciousness at scene, GCS score of 12, and CT findings showing left temporal subdural hematoma. Cross-referenced ER physician notes with paramedic field observations regarding mechanism of injury and client's reported symptoms at scene including confusion, nausea, and left-sided weakness. Began organizing medical records chronology for treating physician depositions.\n\n03/04/2024  S. Nakamura  1.80 hrs\nTelephone conference with client Rosa Martinez regarding current symptom status and upcoming neuropsychological evaluation scheduled for March 18 with Dr. Patricia Hoffman. Discussed importance of completing symptom diary as previously instructed. Client reports ongoing headaches (daily, rated 6-7/10), difficulty concentrating at work as administrative assistant, word-finding difficulties, and disrupted sleep patterns. Client reports she has been unable to return to full-time hours since the accident and is currently working 20 hours per week with accommodations from employer. Confirmed client's appointment with Dr. Raymond Chen (treating neurologist) on March 11.\n\n03/05/2024  J. Caldwell  4.20 hrs\nDrafted and served comprehensive discovery requests to defendant Regional Transit Authority, including first set of interrogatories (28 interrogatories) and first request for production of documents (42 categories). Discovery requests cover: complete maintenance and inspection records for Bus No. 4417 for the 24-month period preceding the collision; driver personnel file and training records for operator Michael Simmons including any prior accidents, complaints, or disciplinary actions; all bus surveillance camera footage from Bus No. 4417 for March 1, 2023, from 2:00 PM through 4:00 PM; RTA's policies and procedures regarding driver fatigue management, maximum shift lengths, and rest period requirements; post-accident drug and alcohol testing results for driver Simmons; all communications regarding the intersection of Broadway and 42nd Street including any prior accident reports or safety concerns; RTA's insurance policies and coverage limits.\n\n03/05/2024  J. Caldwell  2.10 hrs\nResearched and analyzed RTA's common carrier duty of care under state transportation code Section 14-801 et seq. and relevant case law regarding heightened standard of care applicable to public transit operators. Reviewed Patterson v. Metro Transit Auth., 847 F.3d 592 (2019) (holding common carriers liable for even slight negligence); Hendricks v. City Bus Lines, Inc., 234 State Rep. 441 (App. 2021) (addressing admissibility of driver fatigue evidence and federal hours-of-service regulations as evidence of standard of care). Prepared memorandum summarizing applicable legal standards for use in opposition to anticipated summary judgment motion.\n\n03/06/2024  S. Nakamura  2.80 hrs\nAttended scene inspection at intersection of Broadway and 42nd Street with accident reconstruction expert Dr. William Forester. Documented sight lines, traffic signal timing, lane configurations, and location of bus stop relative to intersection. Dr. Forester measured braking distances and reviewed skid mark evidence documented in police accident report. Photographed intersection from multiple angles including driver's perspective approaching from northbound Broadway. Noted absence of dedicated bus pull-off lane and proximity of crosswalk to bus stop, consistent with our theory that RTA failed to advocate for safety improvements at a known high-risk location.\n\n03/06/2024  S. Nakamura  1.50 hrs\nReviewed police accident report (Report No. 2023-0301-4872) and supplemental witness statements. Officer Rodriguez's report documents that bus operator Simmons stated he "didn't see the light change" before entering the intersection. Two independent witnesses — pedestrian Karen Liu and motorist David Fontana — both stated the bus entered the intersection after the signal had turned red. Cross-referenced witness observations with traffic camera footage request submitted to city Department of Transportation.\n\n03/07/2024  J. Caldwell  3.40 hrs\nPrepared and filed motion to compel defendant's production of bus operator Simmons's complete personnel file, including pre-employment screening records and any records of prior moving violations or accidents while operating RTA vehicles. Defendant's initial objection on privacy grounds is insufficient given the direct relevance of the driver's safety record to our negligent hiring, training, and retention claims. Brief cites Johnson v. ABC Trucking, 289 State Rep. 112 (2018) (personnel records discoverable where driver competence is at issue) and argues that a protective order adequately addresses any legitimate privacy concerns. Filed simultaneously a proposed protective order for the court's consideration.\n\n03/07/2024  S. Nakamura  1.20 hrs\nTelephone conference with Dr. Raymond Chen's office to coordinate medical records production and schedule Dr. Chen's deposition. Discussed with Dr. Chen's medical records coordinator the specific treatment notes and imaging studies we will need certified for trial. Dr. Chen's office confirmed they can produce complete treatment records within 14 days of receiving our HIPAA-compliant authorization. Calendared Dr. Chen deposition for April 15, 2024, at his office.\n\n03/08/2024  J. Caldwell  2.60 hrs\nResearched and analyzed potential punitive damages claim based on evidence that RTA was aware of driver fatigue issues system-wide. Reviewed publicly available reports from the National Transportation Safety Board regarding transit operator fatigue and FTA safety directives. Located RTA board meeting minutes from 2022 in which safety director presented data showing 34% increase in operator-caused incidents during overtime shifts, with board taking no corrective action. This evidence supports a claim that RTA consciously disregarded a known risk of harm, potentially meeting the clear and convincing evidence standard for punitive damages under state law.\n\n03/08/2024  S. Nakamura  0.80 hrs\nReviewed and analyzed client's wage and employment records from Greenfield Administrative Services LLC. Client's pre-accident earnings were $52,400 annually ($25.19/hour, 40 hours/week). Current reduced schedule of 20 hours/week results in weekly lost wages of $503.80. Calculated lost wages from date of accident through present at $26,197.60. Began preparing lost wage summary and economic damages worksheet for use in demand package and trial exhibits.\n\n03/11/2024  S. Nakamura  2.40 hrs\nAttended client's appointment with Dr. Raymond Chen (treating neurologist) at University Neurology Associates. Dr. Chen reviewed updated MRI results showing resolution of acute subdural hematoma but persistent white matter changes in left temporal region consistent with diffuse axonal injury. Dr. Chen documented continued cognitive deficits including impaired processing speed, reduced working memory, and executive function difficulties. Dr. Chen's prognosis indicates client has reached maximum medical improvement for structural injury but will likely require ongoing cognitive rehabilitation therapy for 12-18 months, with permanent residual deficits "more likely than not." Dr. Chen agreed to provide causation and prognosis opinion testimony at trial.`,

  narr_antitrust: `IN RE: INDUSTRIAL CHEMICAL MANUFACTURERS ANTITRUST LITIGATION\nMDL No. 2:23-md-03041-RJL\nClient: Consolidated Plaintiffs Steering Committee\nMatter: Antitrust Class Action — Horizontal Price-Fixing Conspiracy\n\nBILLING NARRATIVE — TIME ENTRIES\n\n03/04/2024  M. Thornton  5.80 hrs\nContinued review and analysis of document production from Defendant Chemtrex Global, Inc. (Production Volume 14, Bates Nos. CHEMTREX-0284001 through CHEMTREX-0297500, approximately 13,500 documents). Identified and flagged 47 documents containing inter-competitor communications between Chemtrex VP of Sales Richard Albrecht and counterparts at co-defendants Triton Chemical Corp. and Pacific Solvents Ltd. Key documents include email chain dated June 14, 2021 (CHEMTREX-0289442) in which Albrecht writes to Triton's Mark Hofstetter: "We should align on Q3 pricing before the ICMA conference — last year's approach worked well for everyone." This communication directly supports the conspiracy allegations and contradicts defendants' position that pricing decisions were made independently. Tagged documents in Relativity with "Hot — Price Coordination" coding designation and updated privilege log review notes.\n\n03/04/2024  K. Vasquez  3.20 hrs\nPrepared detailed memorandum analyzing economic evidence of parallel pricing behavior across the three defendant chemical manufacturers for the period 2019-2023. Compiled and analyzed quarterly price announcement data from industry publications Chemical Week and ICIS for sodium hydroxide (caustic soda), hydrochloric acid, and sulfuric acid — the three product markets at issue. Analysis demonstrates that defendants announced price increases within 1-7 days of each other in 14 of 16 quarters, with increase amounts within $5/ton of each other in 12 of those instances. Incorporated Dr. Eleanor Park's (plaintiffs' economics expert) preliminary regression analysis showing that the probability of such pricing parallelism occurring by chance is less than 0.001. Memorandum to be used in support of class certification motion.\n\n03/05/2024  M. Thornton  4.50 hrs\nPrepared for and attended Rule 30(b)(6) deposition of Chemtrex Global's corporate designee on Topic 12 (pricing policies and procedures for sodium hydroxide products, 2019-2023) and Topic 15 (attendance and participation in industry trade association events). Chemtrex designated VP of Pricing Operations Sandra Lee. Key testimony: Ms. Lee confirmed that Chemtrex's pricing committee met quarterly to set published list prices, and that the committee received and reviewed competitors' publicly announced prices prior to each meeting. Ms. Lee testified that competitor pricing was "one of several factors" considered but could not identify any instance in which Chemtrex deviated from the prevailing industry price point. On Topic 15, Ms. Lee confirmed that Chemtrex executives attended the International Chemical Manufacturers Association annual conference and regional meetings, and that informal social events at these conferences included attendees from competitor companies. Deposition transcript to be ordered on expedited basis.\n\n03/05/2024  K. Vasquez  2.40 hrs\nResearched legal standards for class certification in antitrust price-fixing cases in this Circuit. Analyzed recent decisions including In re Bromine Antitrust Litig., 78 F.4th 412 (2023) (certifying class where common evidence of conspiracy predominated over individual damages questions); Kleen Prods. LLC v. Int'l Paper Co., 831 F.3d 919 (7th Cir. 2016) (discussing requirements for demonstrating common impact through econometric models). Prepared outline of class certification brief incorporating analysis of how our evidence satisfies Rule 23(a) and 23(b)(3) requirements, with particular focus on predominance of common questions regarding the existence, scope, and duration of the alleged conspiracy.\n\n03/06/2024  M. Thornton  6.20 hrs\nReviewed Production Volume 15 from Defendant Triton Chemical Corp. (Bates Nos. TRITON-0412001 through TRITON-0430000). Focused review on documents from Triton's executive leadership team during the period January 2020 through December 2022. Identified critical document: handwritten notes from Triton CEO Jonathan Mercer's personal notebook (TRITON-0418793), dated September 22, 2021, containing entries reading "RBA [believed to be Chemtrex's Richard Albrecht] — NaOH +$15 Jan, HCl +$8 Feb" and "PS [believed to be Pacific Solvents] on board — announce 2 weeks after." These notes appear to memorialize a price-fixing agreement among the three defendants and directly contradict Triton's interrogatory response denying any communications with competitors regarding pricing. Prepared hot document memorandum for Steering Committee review and circulated to co-lead counsel.\n\n03/06/2024  A. Petrov  3.80 hrs\nConference call with plaintiffs' economics expert Dr. Eleanor Park and her research team at Berkeley regarding refinement of overcharge damages model. Discussed Dr. Park's updated regression analysis comparing actual prices during the alleged conspiracy period (2019-2023) with "but-for" competitive prices estimated using pre-conspiracy period data (2015-2018) and structural market variables. Dr. Park's preliminary estimate of average overcharge is 12.7% for sodium hydroxide, 9.3% for hydrochloric acid, and 14.1% for sulfuric acid, resulting in aggregate class-wide damages of approximately $1.87 billion before trebling. Discussed need to address defendants' anticipated Daubert challenge to Dr. Park's methodology, particularly regarding her treatment of input cost pass-through and her use of fixed-effects panel data regression versus defendants' expert's preferred instrumental variables approach.\n\n03/07/2024  M. Thornton  3.60 hrs\nPrepared and filed letter motion requesting judicial intervention regarding defendants' continued assertion of blanket work product protection over 842 documents created by or sent to defendants' in-house counsel. Our position is that the mere involvement of in-house counsel in business communications does not transform those communications into protected work product, particularly where the communications relate to pricing decisions that are at the core of the conspiracy allegations. Brief cites In re Kellogg Brown & Root, Inc., 756 F.3d 754 (D.C. Cir. 2014) and argues that defendants must produce a privilege log sufficient to permit document-by-document assessment of their work product claims.\n\n03/07/2024  K. Vasquez  4.10 hrs\nDrafted sections III through V of plaintiffs' memorandum in support of class certification. Section III addresses numerosity (estimated 14,000 direct purchasers during the class period) and commonality (common questions regarding existence of conspiracy, participants, duration, and mechanism). Section IV addresses typicality through analysis of named plaintiffs' purchases and impact. Section V addresses predominance, incorporating Dr. Park's econometric analysis demonstrating that common proof can establish both the fact and amount of overcharge damages on a class-wide basis. Reviewed and incorporated relevant exhibits including pricing data compilations, trade association attendance records, and the Albrecht-Hofstetter email chain.\n\n03/08/2024  M. Thornton  2.90 hrs\nAttended monthly Plaintiffs' Steering Committee conference call. Presented summary of key documents identified in recent productions, including the Mercer notebook entries and Albrecht email chain. Committee discussed strategy for upcoming depositions of defendant executives, with agreement to depose Chemtrex's Albrecht, Triton's Mercer, and Pacific Solvents' CEO Diane Nakashima in consecutive weeks in April to maximize the effectiveness of cross-referencing testimony. Committee also discussed status of settlement discussions with Pacific Solvents, which has indicated through counsel a willingness to explore early resolution and potential cooperation.\n\n03/08/2024  A. Petrov  1.80 hrs\nPrepared subpoena to International Chemical Manufacturers Association ("ICMA") for production of complete attendee lists, agendas, presentations, and committee meeting minutes for all ICMA conferences, regional meetings, and committee meetings from 2018 through 2023. The ICMA conferences are alleged to have served as a venue for the conspirators to coordinate pricing, and ICMA records will establish which defendant representatives attended the same events and committee meetings. Coordinated service of subpoena with ICMA's registered agent in Washington, D.C.`,

  narr_contract: `GREENFIELD MANUFACTURING — SUPPLY CHAIN MASTER AGREEMENT\nClient: Greenfield Manufacturing, Inc.\nMatter No.: 2024-TR-0134\nMatter: Commercial Contract — Multi-Year Supply Agreement with Apex Components Ltd.\n\nBILLING NARRATIVE — TIME ENTRIES\n\n03/04/2024  R. Fitzgerald  3.80 hrs\nReviewed and analyzed initial draft of Master Supply Agreement ("MSA") received from Apex Components Ltd.'s outside counsel (Morrison & Foerster). Agreement proposes a five-year exclusive supply arrangement for precision-machined titanium components used in Greenfield's aerospace and defense product lines. Draft is 67 pages with 14 exhibits. Identified twenty-three provisions requiring substantive negotiation, including: (1) exclusivity scope — Apex seeks worldwide exclusivity for all titanium components, but Greenfield needs to carve out military/classified programs subject to DFARS domestic sourcing requirements; (2) pricing mechanism — Apex proposes fixed pricing with annual CPI adjustments only, which inadequately addresses titanium commodity price volatility; (3) liability cap — Apex seeks to cap aggregate liability at 12 months' fees, which is insufficient given the potential consequential damages from component failure in aerospace applications; (4) IP ownership — Apex claims ownership of all tooling and process improvements developed during the engagement, including those funded by Greenfield.\n\n03/04/2024  R. Fitzgerald  1.60 hrs\nTelephone conference with client's VP of Supply Chain (Thomas Park) and Director of Engineering (Lisa Chen) to discuss commercial priorities and technical requirements for the MSA. Key business objectives: (a) ensure uninterrupted supply of flight-critical components with guaranteed lead times not exceeding 12 weeks; (b) maintain flexibility to dual-source for military programs; (c) secure favorable pricing that accounts for raw material cost fluctuations; (d) protect Greenfield's proprietary specifications and engineering drawings; (e) include robust quality assurance provisions with right to audit Apex's manufacturing facilities. Client confirmed that Greenfield's annual spend on titanium components is approximately $34 million, with projected growth to $52 million by Year 3 based on new program awards from Boeing and Lockheed Martin.\n\n03/05/2024  R. Fitzgerald  5.20 hrs\nDrafted comprehensive redline of MSA Sections 1 through 8. Key revisions include: Section 2 (Exclusivity) — narrowed exclusivity to commercial aerospace applications only, carved out all defense and government programs, and added a performance-based exclusivity provision requiring Apex to maintain 98.5% on-time delivery and less than 0.1% defect rate to retain exclusive supplier status. Section 3 (Pricing) — replaced fixed-price-plus-CPI mechanism with a commodity-indexed pricing formula tied to published titanium sponge prices (Platts assessment) with quarterly true-ups, subject to a pricing corridor of +/-15% from base price to provide predictability for both parties. Section 4 (Term and Termination) — added termination for convenience with 180 days' notice and transition assistance obligations, and added termination for persistent quality failures (three or more quality escapes in any rolling 12-month period). Section 5 (Delivery and Lead Times) — added guaranteed maximum lead times of 12 weeks for standard orders and 8 weeks for expedited orders, with liquidated damages of 2% of order value per week of delay (capped at 20%).\n\n03/05/2024  A. Morrison  2.40 hrs\nResearched UCC Article 2 provisions applicable to the MSA, with particular focus on: (a) implied warranties of merchantability and fitness for particular purpose as applied to precision-manufactured aerospace components; (b) requirements for effective limitation of consequential damages in commercial contracts between sophisticated parties; (c) enforceability of liquidated damages provisions under current state law (applying Restatement (Second) of Contracts § 356 reasonableness test). Prepared memorandum analyzing risk exposure under various warranty and liability cap scenarios, noting that given the flight-critical nature of the components, courts may be reluctant to enforce broad consequential damages exclusions if component failure results in personal injury or property damage.\n\n03/06/2024  R. Fitzgerald  4.40 hrs\nDrafted redline of MSA Sections 9 through 14 and Exhibits A through D. Key revisions: Section 9 (Quality Assurance) — added comprehensive quality provisions requiring Apex to maintain AS9100D certification (aerospace quality management standard), submit to annual quality audits by Greenfield's quality team at Apex's manufacturing facilities, implement statistical process control on all critical-to-quality dimensions, and provide First Article Inspection Reports for each new part number. Section 10 (Intellectual Property) — revised to provide that Greenfield retains ownership of all specifications, engineering drawings, and proprietary designs furnished to Apex; Apex retains ownership of its pre-existing manufacturing processes but grants Greenfield an irrevocable license to use all tooling funded by Greenfield; and any joint improvements are jointly owned with each party having the right to use without accounting. Section 11 (Indemnification) — added mutual indemnification for third-party IP infringement claims and product liability claims arising from defective components. Section 12 (Insurance) — required Apex to maintain aviation products liability insurance of not less than $50 million per occurrence.\n\n03/06/2024  R. Fitzgerald  1.20 hrs\nPrepared negotiation strategy memorandum for client identifying "must-have" provisions, "important" provisions, and potential concession points for upcoming negotiation session. Recommended conceding on Apex's request for a three-year minimum commitment (versus our proposed two-year) in exchange for the commodity-indexed pricing formula and the performance-based exclusivity provisions. Recommended firm position on IP ownership, quality audit rights, and product liability indemnification given the safety-critical nature of aerospace applications.\n\n03/07/2024  R. Fitzgerald  3.20 hrs\nAttended negotiation session via videoconference with Apex's outside counsel (Sarah Kim, Morrison & Foerster) and Apex's General Counsel (David Walsh). Negotiated resolution on 15 of 23 open issues. Key agreements reached: (a) exclusivity narrowed to commercial aerospace per our proposal, with Apex accepting the defense/government carve-out; (b) pricing will use commodity-indexed formula per our draft, with corridor narrowed to +/-12% (compromise from our +/-15% and Apex's +/-8%); (c) liability cap set at 24 months' fees (up from Apex's 12 months) with carve-outs for IP indemnification and willful misconduct; (d) Apex accepted AS9100D certification requirement and annual quality audits. Remaining open issues for next session: IP ownership of jointly-developed tooling improvements, scope of Greenfield's termination for convenience rights, and Apex's request for volume commitment minimums.\n\n03/08/2024  R. Fitzgerald  2.80 hrs\nRevised MSA to incorporate all agreements reached in March 7 negotiation session. Prepared updated redline showing clean resolution of settled provisions and remaining open items highlighted for discussion. Drafted new Exhibit E (Quality Requirements Specification) incorporating AS9100D compliance requirements, First Article Inspection protocols, statistical process control parameters, and corrective action procedures. Circulated revised draft to client for review prior to next negotiation session scheduled for March 14.\n\n03/08/2024  A. Morrison  1.60 hrs\nResearched enforceability of performance-based exclusivity provisions in long-term supply agreements. Reviewed Mathis v. Exxon Corp., 302 F.3d 448 (5th Cir. 2002) and related cases addressing whether supply agreements containing performance standards for exclusivity can be characterized as requirements contracts subject to UCC § 2-306 good faith and reasonableness limitations. Concluded that performance-based exclusivity provisions are generally enforceable where the performance metrics are objectively measurable and the consequences of failing to meet them are clearly stated. Recommended adding a cure period provision allowing Apex 90 days to remediate any performance shortfall before Greenfield can terminate exclusivity.`,

  narr_ma: `CONSTELLATION DIGITAL / HORIZON SOFTWARE ACQUISITION\nClient: Constellation Digital Enterprises, Inc.\nMatter No.: 2024-MA-0087\nMatter: Acquisition of Horizon Software Group, Inc. — $4.06 Billion Merger\n\nBILLING NARRATIVE — TIME ENTRIES\n\n03/04/2024  P. Richardson  6.40 hrs\nContinued review of Horizon Software Group's virtual data room (VDR) materials in connection with legal due diligence. Reviewed 312 documents in VDR folders 4.3 (Customer Contracts) and 4.4 (Strategic Partnerships). Analyzed Horizon's top 25 customer contracts by revenue, identifying the following issues requiring attention: (a) 8 of 25 contracts contain change-of-control provisions requiring customer consent prior to assignment, representing approximately $187 million in annual recurring revenue at risk; (b) Horizon's agreement with the U.S. Department of Defense (Contract No. W91278-22-C-0041, $43.2M TCV) contains an anti-assignment clause that may require novation through the Defense Contract Management Agency; (c) three enterprise license agreements with Fortune 100 customers contain most-favored-nation pricing clauses that could be triggered if Constellation's existing customer base receives more favorable terms for comparable products. Updated due diligence findings tracker and circulated summary memorandum to deal team.\n\n03/04/2024  C. Dawson  3.80 hrs\nDrafted antitrust analysis memorandum assessing Hart-Scott-Rodino filing requirements and substantive merger review risk for the proposed acquisition. Market definition analysis indicates the relevant markets are: (1) enterprise cloud-based ERP software (Constellation market share approximately 18%, Horizon approximately 7%, combined approximately 25%); (2) healthcare IT workflow solutions (Constellation 12%, Horizon 15%, combined 27%); and (3) AI-powered analytics platforms (Constellation 9%, Horizon 6%, combined 15%). Healthcare IT market concentration raises potential concern given combined share exceeds HHI threshold for enhanced scrutiny. Reviewed recent FTC enforcement actions in software markets, including FTC v. Microsoft/Activision Blizzard (2023) and FTC v. Adobe/Figma (2023, abandoned). Recommended early HSR filing with substantive white paper addressing healthcare IT market competitive dynamics and entry/expansion by Oracle Health, Epic Systems, and Cerner/Oracle.\n\n03/05/2024  P. Richardson  5.60 hrs\nReviewed VDR folders 5.1 through 5.7 (Intellectual Property). Catalogued Horizon's IP portfolio: 147 issued U.S. patents, 38 pending patent applications, 892 registered copyrights (primarily software), 23 registered trademarks, and extensive trade secret portfolio covering proprietary algorithms and machine learning models. Identified potential IP risk: Horizon is defendant in patent infringement action filed by DataStream Technologies Inc. in the Eastern District of Texas (Case No. 6:23-cv-00891), alleging infringement of three patents related to real-time data processing architectures. Horizon's outside patent counsel estimates exposure at $15-45 million. Additionally, identified that Horizon's core "Prism" analytics engine incorporates open-source components licensed under AGPL v3, which could impose copyleft obligations on derivative works — requires further technical diligence with Constellation's engineering team to assess scope of AGPL exposure and whether architectural isolation is sufficient.\n\n03/05/2024  L. Hartman  4.20 hrs\nDrafted and negotiated ancillary transaction documents including: (a) Voting Agreement to be executed by Horizon's directors and executive officers holding approximately 12.3% of outstanding shares, committing them to vote in favor of the merger and against any competing proposal; (b) form of Non-Competition and Non-Solicitation Agreement for Horizon's six C-suite executives, with 24-month post-closing restricted period; (c) Transition Services Agreement providing for Constellation to receive IT infrastructure, payroll administration, and facilities management services from Horizon for up to 12 months post-closing at cost-plus-5% pricing. Circulated drafts to Horizon's counsel (Latham & Watkins) for review.\n\n03/06/2024  P. Richardson  4.80 hrs\nReviewed VDR folders 6.1 through 6.4 (Employment and Benefits). Analyzed Horizon's employee base: 4,287 full-time employees across 14 offices in 8 countries. Key employment issues identified: (a) 127 employees in Horizon's Bangalore development center are engaged through a staffing agency arrangement that may require novation or restructuring post-closing; (b) Horizon's 2019 Equity Incentive Plan has 8.4 million options and 3.1 million RSUs outstanding — treatment in the merger (cash-out at spread) will result in approximately $312 million in equity consideration, with potential Section 280G excise tax issues for five senior executives; (c) Horizon's employment agreements with three key engineering leaders (VP Engineering, Chief Architect, and Head of AI/ML) contain "good reason" termination triggers upon a change of control that would entitle each to 18-24 months' severance, aggregating approximately $4.8 million; (d) WARN Act analysis indicates that any post-closing workforce reductions affecting 100+ employees at Horizon's San Jose headquarters would require 60 days' advance notice.\n\n03/06/2024  C. Dawson  2.90 hrs\nPrepared HSR Premerger Notification Filing (Form 4C) for submission to the Federal Trade Commission and Department of Justice Antitrust Division. Calculated reportable transaction value at $4.06 billion based on Merger Consideration of $47.50 per share multiplied by 85,432,167 shares outstanding. Filing fee tier: $2,250,000 (for transactions valued above $1.61 billion). Compiled required attachments including organizational charts, 4(c) and 4(d) documents (board presentations and third-party reports analyzing the acquisition), annual reports, and product descriptions for both parties. Coordinated with Constellation's FP&A team on revenue breakdowns by NAICS code for Item 5 reporting.\n\n03/07/2024  P. Richardson  3.40 hrs\nTelephone conference with Horizon's General Counsel (Rebecca Winters) and VP of Government Contracts (Mark Sullivan) regarding CFIUS implications of the acquisition. Horizon holds facility security clearances at the Secret level and performs classified work for the Department of Defense and Intelligence Community under multiple contracts. Mandatory CFIUS filing required under the Foreign Investment Risk Review Modernization Act (FIRRMA) because Constellation's board includes two non-U.S. persons (board members from Constellation's UK and German subsidiaries) and Horizon handles classified information. Discussed potential CFIUS mitigation measures including: establishment of a Special Security Agreement (SSA) or proxy board arrangement for Horizon's classified programs; appointment of a Government Security Committee; implementation of Technology Control Plan. Engaged Constellation's CFIUS counsel (Akin Gump) to begin preparing draft voluntary notice.\n\n03/07/2024  L. Hartman  2.60 hrs\nNegotiated revisions to Merger Agreement Sections 5.1 (Conduct of Company Business) and 5.2 (No Solicitation) with Latham & Watkins. Key negotiated changes: (a) expanded list of permitted ordinary course actions to include hiring of employees with base salary up to $350K (increased from $250K) and execution of customer contracts with TCV up to $10M (increased from $5M), reflecting Horizon's growth trajectory; (b) clarified "fiduciary out" provision to require Horizon Board to negotiate with Constellation for three business days before accepting a Superior Proposal (reduced from five days); (c) added "information rights" provision requiring Horizon to provide Constellation with daily reports of any contacts from potential competing bidders. Circulated revised draft to deal team for review.\n\n03/08/2024  P. Richardson  2.20 hrs\nPrepared comprehensive due diligence findings summary for Constellation's Board of Directors meeting scheduled for March 12. Summary organized by risk category (High/Medium/Low) with recommended mitigation strategies for each identified issue. High-risk items: (1) DoD contract anti-assignment clause requiring novation ($43.2M); (2) patent litigation exposure ($15-45M); (3) AGPL open-source licensing risk (requires technical assessment). Medium-risk items: (1) change-of-control consent requirements in customer contracts ($187M ARR); (2) Section 280G excise tax exposure for senior executives; (3) CFIUS filing and potential mitigation requirements. Low-risk items: (1) standard employment transition matters; (2) routine real estate lease assignments. Recommended specific purchase price adjustment, indemnification, or escrow mechanisms for each high-risk item.`,

  narr_bankruptcy: `IN RE: MERIDIAN RETAIL HOLDINGS, INC., et al.\nCase No. 24-10234 (MEW)\nChapter 11\nUnited States Bankruptcy Court, Southern District of New York\nClient: First Lien Secured Lender Group (Agent: JPMorgan Chase Bank, N.A.)\nMatter: Chapter 11 Bankruptcy — Retail Chain Restructuring\n\nBILLING NARRATIVE — TIME ENTRIES\n\n03/04/2024  D. Kowalski  4.60 hrs\nReviewed Debtors' First Day Motions filed on March 1, 2024 in connection with the voluntary Chapter 11 petitions filed by Meridian Retail Holdings, Inc. and its 23 affiliated debtor entities. Analyzed the following motions on behalf of the First Lien Secured Lender Group: (a) Motion for Joint Administration of the Chapter 11 cases (no objection); (b) Motion for Interim and Final Authority to Use Cash Collateral (significant concerns — see below); (c) Motion for Interim and Final Authority to Obtain DIP Financing in the amount of $175 million (significant concerns); (d) Motion for Authority to Pay Prepetition Employee Wages and Benefits (limited objection to scope of retention bonuses); (e) Motion for Authority to Continue Customer Programs (no objection); (f) Motion for Authority to Pay Critical Vendors up to $28 million (objection to breadth of "critical" vendor definition). Prepared preliminary assessment memorandum for Lender Group identifying key areas of concern and recommended positions.\n\n03/04/2024  D. Kowalski  3.20 hrs\nConducted detailed analysis of Debtors' proposed DIP Credit Agreement and Cash Collateral Order. First Lien Lender Group holds $640 million in secured claims under the Prepetition First Lien Credit Agreement, secured by substantially all assets of the Debtors. Key issues with proposed DIP financing: (a) the $175 million DIP facility proposed by Oaktree Capital would prime the First Lien Lenders' liens without adequate protection — replacement liens offered are junior to DIP liens and carve-out, and the proposed adequate protection payments (current interest only at non-default rate) are insufficient given the rapid depreciation of retail inventory collateral; (b) the DIP budget contains $12.4 million in professional fees for the first 13 weeks that appear excessive and uncapped; (c) the proposed milestones require filing of a plan of reorganization within 120 days but do not specify that the plan must be acceptable to the First Lien Lenders; (d) the DIP includes a $8.75 million roll-up of prepetition obligations owed to Oaktree on its second lien position, which would effectively elevate second lien claims ahead of the First Lien Lenders' deficiency claims.\n\n03/05/2024  D. Kowalski  5.40 hrs\nDrafted objection to DIP Financing Motion and Cash Collateral Order on behalf of the First Lien Secured Lender Group. Objection raises the following grounds: (1) Debtors have failed to demonstrate that the proposed DIP financing represents the best available terms, as required under Section 364 of the Bankruptcy Code — the Lender Group was not afforded a meaningful opportunity to propose alternative DIP financing on terms more favorable to the estates; (2) the priming liens are not adequately protected under Section 364(d) because the proposed adequate protection package does not account for the deterioration in collateral value attributable to the Debtors' planned store closures (73 of 312 locations designated for closing in the first 90 days); (3) the second lien roll-up violates the absolute priority rule and constitutes an impermissible sub rosa plan; (4) the budget milestones are inadequate to protect against value erosion during the Chapter 11 cases. Demanded enhanced adequate protection including: payment of current interest at the default rate, monthly collateral valuations, a 10% equity kicker in any reorganized entity, and a requirement that any plan of reorganization provide for payment in full of First Lien claims or be subject to the Lender Group's consent.\n\n03/05/2024  S. Patterson  2.80 hrs\nPrepared analysis of Debtors' 13-week cash flow projections attached to the DIP Motion. Compared Debtors' revenue projections against historical performance data and industry benchmarks for specialty retail. Debtors' projections assume: (a) same-store sales decline of only 8% during the Chapter 11 cases, which appears optimistic given industry experience showing 15-25% declines in Chapter 11 retail bankruptcies (citing recent data from Toys R Us, J.Crew, and Bed Bath & Beyond cases); (b) 85% realization on liquidation of inventory at closing stores, which exceeds the 65-75% range typically achieved in retail liquidation sales; (c) vendor payment terms returning to prepetition levels within 60 days, despite the Debtors' proposal to pay only 70% of prepetition vendor claims. Identified approximately $38 million in projected cash flow that may be overstated, which would result in a DIP facility shortfall by Week 9 of the budget period.\n\n03/06/2024  D. Kowalski  3.80 hrs\nAttended First Day Hearing before Judge Martin E. Williams. Argued limited objection to DIP Motion on behalf of First Lien Lender Group. Court granted interim DIP approval of $85 million (reduced from Debtors' requested $175 million) for the first 30 days, with the following modifications favorable to the Lender Group: (a) second lien roll-up reduced from $8.75 million to $3.5 million; (b) adequate protection payments to include monthly interest at default rate plus a $2 million monthly payment toward principal; (c) Debtors required to provide weekly reporting on collateral values and store closing proceeds; (d) final hearing on DIP set for April 5, with Debtors directed to engage with Lender Group on revised adequate protection package prior to final hearing. Court also approved Employee Wage Motion on an interim basis but deferred ruling on Critical Vendor Motion and Management Retention Program pending further briefing.\n\n03/06/2024  S. Patterson  1.80 hrs\nPrepared summary of First Day Hearing rulings and circulated to all members of the First Lien Lender Group (14 institutional lenders). Summary includes analysis of interim DIP order provisions, upcoming deadlines, and strategic recommendations for the final DIP hearing. Coordinated conference call with Agent counsel (Cravath) and Lender Group members for March 8 to discuss (a) whether Lender Group should propose alternative DIP financing; (b) appropriate adequate protection package for final order; (c) strategy regarding plan process and timeline.\n\n03/07/2024  D. Kowalski  4.20 hrs\nReviewed Debtors' Schedules and Statement of Financial Affairs filed on March 6. Key findings: (a) Debtors' total scheduled assets of $892 million against total scheduled liabilities of $1.47 billion, representing a deficiency of approximately $578 million; (b) First Lien Lender Group's secured claim of $640 million is secured by assets with scheduled value of $712 million (accounts receivable $89M, inventory $423M, real property leases $142M, IP $58M), suggesting the First Lien claim is fully secured at current valuations, but inventory and lease values are likely to decline materially during the Chapter 11 cases; (c) unsecured claims total approximately $312 million, including $87 million in trade payables, $145 million in second lien deficiency claims, and $80 million in lease rejection damages; (d) Debtors disclosed $14.3 million in insider transactions within the 12 months preceding the filing, including $6.2 million in executive bonuses paid 90 days before the petition date that may be subject to avoidance as preferential transfers.\n\n03/08/2024  D. Kowalski  2.40 hrs\nDrafted motion for appointment of an examiner under Section 1104(c) of the Bankruptcy Code to investigate prepetition transactions between Debtors and their private equity sponsor, Greystone Capital Partners. Public reporting and Debtors' Schedules indicate that Greystone caused the Debtors to: (a) pay a $42 million special dividend in June 2023, funded by additional borrowings under the First Lien facility, at a time when the Debtors were already experiencing liquidity stress; (b) enter into a $9.8 million/year management services agreement with Greystone on above-market terms; and (c) pay $6.2 million in executive retention bonuses within 90 days of the filing. These transactions may constitute constructive fraudulent transfers under Section 548 or applicable state law, potentially recoverable for the benefit of the estates and creditors. Motion argues that the magnitude of potential avoidance claims and the inherent conflict of interest in debtor-in-possession management investigating its own sponsor warrant appointment of an independent examiner.\n\n03/08/2024  S. Patterson  1.40 hrs\nPrepared comparison of Debtors' asset valuations in the Schedules against (a) the most recent independent appraisal obtained by the First Lien Agent (Hilco Global, dated November 2023), and (b) current market comparables for retail inventory and lease portfolios. Analysis indicates that Debtors' scheduled inventory values exceed Hilco's net orderly liquidation value by approximately $94 million (Debtors' schedule: $423M; Hilco NOLV: $329M). This discrepancy is critical for the adequate protection analysis at the final DIP hearing, as it suggests the First Lien Lenders' collateral cushion is substantially thinner than the Debtors' Schedules imply.`,

  narr_regulatory: `BRIGHTPATH THERAPEUTICS — FDA REGULATORY MATTERS\nClient: BrightPath Therapeutics, Inc.\nMatter No.: 2024-REG-0056\nMatter: FDA Regulatory Compliance — Biologics License Application and Manufacturing Inspection\n\nBILLING NARRATIVE — TIME ENTRIES\n\n03/04/2024  N. Patel  4.80 hrs\nReviewed and analyzed FDA Complete Response Letter ("CRL") dated February 28, 2024, issued in connection with BrightPath's Biologics License Application ("BLA") for BP-1047 (proposed trade name: Luminara), a recombinant monoclonal antibody for the treatment of moderate-to-severe plaque psoriasis. The CRL identifies three categories of deficiencies requiring response: (1) Chemistry, Manufacturing, and Controls ("CMC") — FDA requests additional process validation data for the upstream cell culture process at BrightPath's biologics manufacturing facility in Research Triangle Park, North Carolina, specifically regarding excursion management protocols and in-process control limits for dissolved oxygen and pH during the perfusion bioreactor phase; (2) Clinical — FDA requests additional subgroup analyses from the Phase 3 ILLUMINATE trial stratified by prior biologic exposure, body weight categories, and disease severity (PASI score quartiles); (3) Labeling — FDA objects to proposed indication statement and requests narrowing to patients who have failed at least one prior systemic therapy. Prepared detailed memorandum for BrightPath's Regulatory Affairs team summarizing each deficiency and our preliminary assessment of the response strategy.\n\n03/04/2024  N. Patel  2.20 hrs\nConference call with BrightPath's Chief Medical Officer (Dr. Sarah Lindgren), VP of Regulatory Affairs (James Takahashi), and VP of Manufacturing (Dr. Ana Reyes) to discuss CRL response strategy and timeline. FDA's response deadline is August 28, 2024 (6 months from CRL date). Discussed critical path items: (a) CMC process validation — Dr. Reyes confirmed that BrightPath has already initiated additional validation runs that will address FDA's concerns regarding dissolved oxygen excursion management, with data expected by May 2024; (b) Clinical subgroup analyses — Dr. Lindgren confirmed that the Phase 3 data set supports the requested analyses and that BrightPath's biostatistics team can complete them within 6 weeks; (c) Labeling — discussed strategic implications of narrowing the indication to second-line therapy versus seeking a broader first-line indication at launch, with potential for supplemental BLA for first-line indication based on ongoing Phase 3b ILLUMINATE-EXTEND study. Agreed to schedule Type A meeting with FDA to align on CRL response expectations.\n\n03/05/2024  N. Patel  3.60 hrs\nDrafted Type A Meeting Request to FDA Center for Drug Evaluation and Research (CDER), Division of Dermatology and Dentistry, requesting a pre-CRL-response meeting to discuss: (1) the scope and format of additional CMC process validation data that would be acceptable to address the CRL deficiency; (2) whether the clinical subgroup analyses can be submitted as an amendment to the existing BLA or whether a new clinical study report is required; (3) FDA's willingness to accept a broader indication statement with appropriate labeling language regarding prior therapy failure. Meeting request includes proposed agenda, list of specific questions for FDA, and background package summarizing BrightPath's proposed response approach for each CRL deficiency. Under FDA guidance, Type A meetings should be scheduled within 30 days of request.\n\n03/05/2024  K. Armstrong  2.80 hrs\nReviewed FDA Form 483 Inspectional Observations issued to BrightPath's Research Triangle Park biologics manufacturing facility following the pre-approval inspection conducted February 12-23, 2024. The Form 483 contains five observations: (1) failure to adequately investigate an out-of-specification ("OOS") result for endotoxin testing on Lot BP-1047-2023-08 — investigation concluded the OOS was due to analyst error without sufficient supporting evidence; (2) inadequate cleaning validation for the 2,000L perfusion bioreactor, specifically regarding demonstration of removal of host cell protein residues to below validated acceptance criteria; (3) environmental monitoring excursion in ISO 5 fill suite on January 14, 2024 (viable air particulate count of 2 CFU vs. action limit of 1 CFU) without adequate root cause analysis; (4) incomplete batch records for three commercial-scale validation lots, with certain in-process test results recorded after, rather than contemporaneously with, the testing; (5) training records for two manufacturing operators did not document completion of revised SOP-MFG-047 (aseptic gowning procedure) prior to their participation in aseptic filling operations. Prepared initial assessment memorandum categorizing each observation by severity and recommending response timeline and strategy.\n\n03/06/2024  K. Armstrong  5.20 hrs\nDrafted comprehensive response to FDA Form 483 for BrightPath's review and submission. Under FDA guidance, responses to Form 483 observations should be submitted within 15 business days of the inspection close-out. Drafted detailed responses to each observation including: Observation 1 (OOS investigation) — BrightPath will revise its OOS investigation SOP to require documented evidence supporting analyst error conclusions, including re-testing by a different analyst, review of analyst training records, equipment calibration verification, and comparison with historical results for the same lot; BrightPath has initiated a retrospective review of all OOS investigations from 2022-2024. Observation 2 (cleaning validation) — BrightPath will conduct additional cleaning validation studies using a worst-case product matrix and host cell protein-specific analytical methods (ELISA with sensitivity to 1 ng/mL), with validation protocol to be completed by April 30, 2024. Observation 3 (environmental monitoring) — BrightPath will implement enhanced environmental monitoring program including additional sampling locations, increased sampling frequency during aseptic operations, and revised action/alert limits based on statistical trending analysis.\n\n03/06/2024  N. Patel  1.80 hrs\nResearched FDA enforcement history regarding Form 483 observations at biologics manufacturing facilities, with particular focus on pre-approval inspection findings and their impact on BLA approval timelines. Reviewed FDA Warning Letters and Import Alerts issued to biologics manufacturers from 2022-2024 to assess the severity threshold at which FDA typically escalates from Form 483 to Warning Letter. Analysis indicates that BrightPath's observations, while requiring prompt corrective action, are generally classified as "moderate" in severity and are unlikely to result in a Warning Letter if adequately addressed within the 15-business-day response window. However, Observation 1 (OOS investigation) and Observation 4 (incomplete batch records) relate to data integrity, which FDA has identified as an enforcement priority, warranting particularly thorough corrective and preventive actions.\n\n03/07/2024  N. Patel  3.40 hrs\nReviewed and analyzed BrightPath's Pediatric Study Plan ("PSP") required under the Pediatric Research Equity Act ("PREA"), 21 U.S.C. § 355c, for BP-1047 in pediatric patients aged 6-17 with moderate-to-severe plaque psoriasis. FDA issued comments on the initial PSP on February 15, 2024, requesting: (a) addition of a pharmacokinetic substudy in patients aged 6-11 using population PK modeling; (b) expansion of the planned efficacy endpoint from PASI 75 to include PASI 90 as a co-primary endpoint; and (c) inclusion of long-term safety follow-up of at least 52 weeks (increased from BrightPath's proposed 24 weeks). Drafted revised PSP incorporating FDA's requested modifications and BrightPath's counterproposals, including a proposal to use weight-based dosing extrapolated from adult PK data for the 12-17 age cohort (supported by published literature on monoclonal antibody pharmacokinetics in adolescents) while conducting a dedicated PK study only in the 6-11 age cohort.\n\n03/08/2024  K. Armstrong  2.60 hrs\nPrepared regulatory strategy memorandum for BrightPath's Board of Directors summarizing current FDA interactions and projected timeline to BLA approval. Key milestones: (a) Form 483 response due March 15, 2024; (b) Type A meeting expected April 2024; (c) CMC validation data available May 2024; (d) CRL response submission targeted for July 2024; (e) FDA review of CRL response (6-month review clock) — projected PDUFA action date of January 2025. Identified potential risk factors that could delay timeline: (i) FDA request for reinspection of manufacturing facility following Form 483 response; (ii) FDA determination that CMC data is insufficient, requiring additional validation runs; (iii) Advisory Committee meeting request (unlikely given mechanism of action is well-characterized but possible given the competitive landscape in psoriasis biologics). Recommended BrightPath initiate pre-submission planning for commercial launch activities in parallel with CRL response preparation.`,

  narr_advisory: `NORTHSTAR TECHNOLOGIES — BOARD ADVISORY\nClient: NorthStar Technologies, Inc. (Board of Directors)\nMatter No.: 2024-ADV-0029\nMatter: Advisory — Corporate Governance, Shareholder Activism Defense, and Strategic Alternatives Review\n\nBILLING NARRATIVE — TIME ENTRIES\n\n03/04/2024  E. Sinclair  4.20 hrs\nReviewed and analyzed Schedule 13D filed by Pinnacle Activist Partners, LP on March 1, 2024, disclosing a 9.2% ownership stake in NorthStar Technologies, Inc. The filing discloses that Pinnacle intends to: (a) seek board representation through nomination of three director candidates at NorthStar's 2024 Annual Meeting; (b) advocate for a "comprehensive strategic review" including potential sale, merger, or separation of NorthStar's Enterprise Software division from its Cloud Infrastructure division; and (c) press for $750 million in share repurchases over the next 12 months funded by "unlocking value trapped in non-core assets." Reviewed Pinnacle's track record in prior activist campaigns (Meridian Corp. 2022, Atlas Digital 2023, Vanguard Systems 2023) to assess likely tactics and timeline. Prepared preliminary assessment memorandum for the Board identifying Pinnacle's likely strategy, potential vulnerabilities in NorthStar's governance structure, and recommended immediate defensive measures.\n\n03/04/2024  E. Sinclair  2.60 hrs\nConference call with NorthStar's Chairman (Margaret Thornton), CEO (David Okafor), General Counsel (Patricia Yamamoto), and CFO (Andrew Kim) to discuss Pinnacle's filing and recommended response. Advised immediate formation of a Board-level Response Committee consisting of three independent directors to oversee the company's response to Pinnacle's campaign. Discussed the importance of maintaining a constructive tone in any public communications while firmly articulating the Board's existing strategic plan. Recommended engagement of a leading proxy solicitation firm (Innisfree M&A or MacKenzie Partners) and an investor relations advisor with activism defense experience (Joele Frank or Sard Verbinnen). Discussed NorthStar's current shareholder base composition: approximately 72% institutional ownership, with top 10 holders controlling 48% of outstanding shares. Key swing shareholders identified for targeted outreach: BlackRock (8.4%), Vanguard (7.1%), State Street (5.3%), and T. Rowe Price (4.2%).\n\n03/05/2024  E. Sinclair  5.40 hrs\nConducted comprehensive review of NorthStar's corporate governance documents and identified areas of potential vulnerability to Pinnacle's campaign. Key findings: (a) NorthStar's board is not classified — all directors stand for election annually, making it easier for Pinnacle to wage a proxy contest for multiple seats; (b) NorthStar's bylaws permit shareholders holding 25% of outstanding shares to call a special meeting (below the 50% threshold recommended by governance best practices); (c) NorthStar's advance notice bylaw requires nomination notices 90-120 days before the anniversary of the prior year's annual meeting — Pinnacle's 13D was filed within this window, and formal nominations are expected imminently; (d) NorthStar does not have a stockholder rights plan (poison pill) in place; (e) NorthStar's board has 11 members, three of whom have served for more than 10 years, which ISS and Glass Lewis may view as impairing independence. Prepared detailed governance vulnerability assessment with recommendations for potential bylaw amendments and other defensive preparations.\n\n03/05/2024  H. Park  3.80 hrs\nResearched and drafted memorandum on NorthStar's legal options for responding to Pinnacle's activist campaign. Analysis covers: (1) adoption of a limited-duration stockholder rights plan (poison pill) — reviewed current Delaware case law post-Selectica v. Versata (Del. Ch. 2010) confirming board authority to adopt a pill with a 10% or higher trigger in the face of an activist accumulating shares, but noted ISS policy generally opposing pills adopted without shareholder approval; (2) bylaw amendments — analyzed permissibility under Delaware law of increasing the special meeting threshold from 25% to 50%, implementing proxy access provisions as a governance sweetener, and adding enhanced disclosure requirements for nomination notices; (3) standstill and settlement framework — reviewed terms of recent activist settlements in the technology sector to establish negotiation parameters. Recommended a "prepare but don't deploy" approach: have the rights plan ready for immediate Board adoption if Pinnacle's stake exceeds 12%, but focus initial efforts on shareholder engagement and demonstrating management's strategic plan.\n\n03/06/2024  E. Sinclair  4.60 hrs\nPrepared and delivered presentation to NorthStar's Board of Directors at special board meeting convened to discuss the Pinnacle situation. Presentation covered: (1) overview of Pinnacle's filing and track record; (2) governance vulnerability assessment; (3) analysis of Pinnacle's three nominee candidates (former tech executives with relevant industry experience — their qualifications will make the proxy contest credible with institutional shareholders); (4) recommended response framework including immediate actions (form Response Committee, engage advisors, begin shareholder outreach), near-term actions (evaluate Pinnacle's strategic proposals on the merits, prepare Board's own strategic plan presentation), and contingency planning (rights plan, potential bylaw amendments, settlement framework). Board approved formation of Response Committee (Directors Chen, Morrison, and Okonkwo) and authorized engagement of Innisfree M&A as proxy solicitor and Evercore as independent financial advisor to evaluate strategic alternatives.\n\n03/06/2024  H. Park  2.40 hrs\nDrafted Board resolutions for: (a) formation of the Response Committee with defined scope of authority (oversee response to Pinnacle, engage advisors, approve public communications, and negotiate with Pinnacle, subject to full Board approval of any settlement or governance changes); (b) engagement of Innisfree M&A Incorporated as proxy solicitor; (c) engagement of Evercore Group LLC as independent financial advisor; (d) authorization for management to commence targeted shareholder engagement program with top 20 institutional holders. Circulated resolutions to full Board for written consent adoption.\n\n03/07/2024  E. Sinclair  3.80 hrs\nAttended initial strategy session with Innisfree M&A (managing director Jennifer Walsh) and Evercore (managing director Michael Torres). Innisfree presented preliminary shareholder analysis indicating that Pinnacle would need to win the support of approximately 30-35% of the institutional shareholder base (beyond its own 9.2% stake) to prevail in a proxy contest for three board seats. Key battleground: index funds (BlackRock, Vanguard, State Street) will vote based on ISS/Glass Lewis recommendations and their internal stewardship policies, making it critical to address governance concerns regarding board tenure and refreshment proactively. Evercore presented preliminary analysis of NorthStar's sum-of-the-parts valuation, indicating a potential 20-35% value gap between current trading price ($67.40) and intrinsic value of the combined Enterprise Software and Cloud Infrastructure businesses. Discussed whether a proactive strategic announcement (e.g., accelerated share repurchase, operational improvement plan, or division-level financial reporting) could address the valuation gap without yielding to Pinnacle's specific demands.\n\n03/07/2024  E. Sinclair  1.60 hrs\nDrafted initial talking points and Q&A document for NorthStar's CEO and CFO to use in upcoming conversations with institutional shareholders. Talking points emphasize: (a) the Board's ongoing commitment to value creation and regular evaluation of strategic alternatives; (b) the strength of NorthStar's organic growth trajectory (18% YoY revenue growth in Cloud Infrastructure); (c) the Board's recent governance enhancements including appointment of two new independent directors in 2023 and adoption of majority voting in uncontested elections; (d) the risks of Pinnacle's proposed separation, including loss of cross-selling synergies (estimated at $120M annually), dis-synergies in shared R&D and go-to-market infrastructure, and tax leakage. Document structured to respond to anticipated shareholder questions regarding Pinnacle's specific proposals.\n\n03/08/2024  E. Sinclair  2.80 hrs\nReviewed Pinnacle Activist Partners' formal letter to the NorthStar Board, delivered on March 8 and simultaneously released publicly. Letter reiterates Pinnacle's positions from the 13D filing and adds: (a) specific criticism of NorthStar's R&D spending as a percentage of revenue (23%) as "excessive and unproductive" compared to peer median (19%); (b) claim that the Cloud Infrastructure division alone is worth $12-15 billion based on comparable company analysis, versus NorthStar's current enterprise value of $9.8 billion; (c) identification of three board nominees: former ServiceNow COO Michael Brennan, former Dell Technologies SVP Lisa Huang, and venture capitalist and former Salesforce executive James Morgan. Drafted initial public response statement for the Board: "NorthStar's Board welcomes constructive input from all shareholders and will carefully evaluate the perspectives expressed in Pinnacle's letter. The Board is confident in NorthStar's strategic direction and remains committed to acting in the best interests of all shareholders. The Board looks forward to engaging directly with Pinnacle and will provide a comprehensive response in due course."\n\n03/08/2024  H. Park  1.80 hrs\nPrepared analysis of Pinnacle's three director nominees' backgrounds, qualifications, and potential conflicts of interest. Key findings: (a) Michael Brennan served on the board of Atlas Digital during Pinnacle's 2023 campaign and was nominated by Pinnacle in that contest — raises questions about independence from Pinnacle; (b) Lisa Huang's current advisory firm has a consulting agreement with a Pinnacle portfolio company; (c) James Morgan's venture fund has co-invested alongside Pinnacle in two prior transactions. These relationships may be relevant to NorthStar's proxy statement disclosures and to the narrative that Pinnacle's nominees would represent Pinnacle's interests rather than those of all shareholders. Recommended retaining a background investigation firm to conduct deeper diligence on all three nominees prior to any settlement discussions.`,

  advice_litigation: `WHITFIELD & ASSOCIATES LLP\nATTORNEYS AT LAW\n\nMEMORANDUM\n\nPRIVILEGED AND CONFIDENTIAL\nATTORNEY-CLIENT COMMUNICATION\nATTORNEY WORK PRODUCT\n\nTO:        Sandra Chen, General Counsel\n           Meridian Health Systems, Inc.\n\nFROM:      David R. Whitfield\n           Julia M. Rosenthal\n\nDATE:      March 18, 2024\n\nRE:        Litigation Risk Assessment — Torres v. Meridian Health Systems, Inc.\n           Potential Exposure: Medical Malpractice / Wrongful Death\n           Superior Court of the State, County of Riverside\n           Case No. 2024-CV-01847\n\nI. EXECUTIVE SUMMARY\n\nYou have asked us to evaluate the litigation risk and exposure arising from the wrongful death and medical malpractice complaint filed on March 4, 2024, by the estate of Maria Torres ("Plaintiff"), alleging that negligent care provided at Meridian's Riverside Community Medical Center ("RCMC") caused the death of the decedent following a routine laparoscopic cholecystectomy. Based on our preliminary review of the medical records, applicable legal standards, and comparable verdicts in this jurisdiction, we assess the overall litigation risk as moderate to high and recommend early exploration of mediation.\n\nII. FACTUAL BACKGROUND\n\nOn January 15, 2024, Maria Torres, age 52, presented at RCMC for an elective laparoscopic cholecystectomy (gallbladder removal) performed by Dr. James Holloway, a general surgeon on Meridian's medical staff. The procedure was scheduled as outpatient surgery with an expected discharge the same day.\n\nAccording to the operative report and medical records we have reviewed to date, the following timeline is relevant:\n\n- 07:30 — Patient checked in for pre-operative preparation; pre-op assessment documented no contraindications to surgery.\n- 09:15 — Procedure commenced under general anesthesia administered by Dr. Lisa Pham (anesthesiology).\n- 09:48 — Dr. Holloway noted "difficult visualization" of the hepatocystic triangle due to inflammation and adhesions from prior abdominal surgery. Rather than converting to an open procedure, Dr. Holloway proceeded laparoscopically.\n- 10:22 — Procedure completed. Operative note describes "routine cholecystectomy without complications."\n- 12:45 — Patient transferred to post-anesthesia care unit; vital signs documented as stable.\n- 15:30 — Patient complained of increasing abdominal pain, rated 8/10. Nurse documented distended abdomen and tachycardia (heart rate 112).\n- 16:00 — Dr. Holloway notified by telephone; ordered additional IV analgesics and "continue to monitor."\n- 18:45 — Patient's blood pressure dropped to 82/54; heart rate 134. Nursing staff paged Dr. Holloway stat.\n- 19:20 — Dr. Holloway arrived at bedside and ordered STAT CT abdomen.\n- 19:55 — CT revealed large volume hemoperitoneum (intra-abdominal bleeding) consistent with injury to the right hepatic artery or cystic artery.\n- 20:15 — Patient taken emergently to operating room for exploratory laparotomy.\n- 20:40 — Intraoperatively, Dr. Holloway identified a complete transection of the common bile duct and laceration of the right hepatic artery — a bile duct injury recognized as the most serious complication of laparoscopic cholecystectomy.\n- Patient underwent hepatic artery repair and Roux-en-Y hepaticojejunostomy for bile duct reconstruction. Total estimated blood loss: 2,800 mL.\n- January 16, 2:15 AM — Patient transferred to surgical ICU in critical condition.\n- January 16–22 — Patient developed sepsis, multi-organ failure, and disseminated intravascular coagulation.\n- January 22, 2024 — Maria Torres pronounced deceased at 14:32.\n\nIII. LEGAL ANALYSIS\n\nA. Standard of Care\n\nThe central liability question is whether Dr. Holloway breached the applicable standard of care at two critical decision points: (1) the decision to continue laparoscopically rather than converting to an open procedure when encountering difficult visualization, and (2) the delayed response to post-operative signs of internal bleeding.\n\n1. Failure to Convert to Open Procedure\n\nThe standard of care for laparoscopic cholecystectomy, as established by the Society of American Gastrointestinal and Endoscopic Surgeons (SAGES) guidelines and reinforced by extensive surgical literature, requires conversion to an open procedure when the critical view of safety cannot be achieved in the hepatocystic triangle. Dr. Holloway's operative note acknowledges "difficult visualization" due to adhesions but does not document achievement of the critical view of safety before clipping and dividing structures.\n\nWe anticipate Plaintiff's surgical expert will opine that the failure to convert to an open procedure when the critical view could not be established fell below the standard of care. This is a strong argument. The SAGES Safe Cholecystectomy Task Force has specifically identified failure to achieve the critical view as a primary cause of bile duct injuries, and conversion rates of 5-10% are considered appropriate for laparoscopic cholecystectomy.\n\nDr. Holloway's failure to document the critical view, combined with the subsequent discovery of a complete common bile duct transection (indicating misidentification of anatomical structures), presents significant liability exposure on this issue.\n\n2. Delayed Recognition and Response\n\nThe timeline reveals a gap of approximately 3 hours and 45 minutes between the first documented signs of potential surgical complication (15:30, abdominal pain and tachycardia) and the ordering of diagnostic imaging (19:20). During this interval, nursing documentation shows progressive deterioration including increasing pain, abdominal distension, tachycardia, and eventual hemodynamic instability.\n\nPlaintiff will likely argue — with support from expert testimony — that the standard of care required in-person evaluation and diagnostic workup at the first signs of post-operative bleeding (15:30-16:00 timeframe), not merely telephone orders for analgesics. Earlier recognition would have led to earlier surgical intervention, with significantly better prognosis.\n\nOur preliminary assessment is that the delayed response to post-operative deterioration represents an independent breach of the standard of care and significantly contributed to the fatal outcome.\n\nB. Causation\n\nPlaintiff must establish that the alleged breaches were a proximate cause of Mrs. Torres's death. On the conversion question, Plaintiff will argue that performing the procedure as an open surgery would have prevented the bile duct injury entirely. This is a strong causation argument, as bile duct injuries are rare in open cholecystectomy (approximately 0.1-0.2%) compared to laparoscopic procedures (0.3-0.6%).\n\nOn the delayed response, Plaintiff will argue that earlier detection and surgical intervention (within 1-2 hours of the initial symptoms) would have prevented the massive blood loss, sepsis, and subsequent multi-organ failure that led to death. Medical literature supports that outcomes in bile duct injuries are significantly better when recognized and addressed intraoperatively or within the first several hours.\n\nWe assess causation as favorable to Plaintiff on both theories.\n\nC. Damages\n\nMrs. Torres was 52 years old, employed as a school administrator earning approximately $78,000 annually, and is survived by her husband (age 55) and two adult children (ages 24 and 21). Under the state wrongful death statute, recoverable damages include:\n\n- Economic damages: Lost earnings and benefits from date of death through projected retirement (estimated work-life expectancy of 13 years). Preliminary economic analysis suggests lost earnings of $850,000-$1,100,000 (present value).\n- Medical expenses: Approximately $487,000 for the January 15-22 hospitalization (ICU, emergency surgery, blood products, etc.).\n- Non-economic damages: Loss of consortium, companionship, and society. This jurisdiction has no cap on non-economic damages in medical malpractice cases. Comparable verdicts in Riverside County for wrongful death of a 52-year-old with surviving spouse and children range from $2,500,000 to $6,000,000.\n- Punitive damages: Unlikely on these facts, as the conduct, while potentially negligent, does not rise to the level of malice or conscious disregard required for punitive damages.\n\nTotal estimated exposure: $3,800,000 to $7,500,000, with a midpoint of approximately $5,500,000.\n\nD. Potential Defenses\n\nWhile we will pursue all available defenses vigorously, we note the following limitations:\n\n1. Informed Consent: Mrs. Torres signed a consent form listing bile duct injury as a known risk of laparoscopic cholecystectomy. However, informed consent is not a defense to negligence in performing the procedure — it merely establishes that the patient accepted the inherent risks of a properly performed surgery.\n\n2. Assumption of Risk: Similar to informed consent, this doctrine does not apply where the injury resulted from negligent performance rather than an inherent risk of a properly conducted procedure.\n\n3. Contributory/Comparative Negligence: We are not aware of any patient conduct contributing to the injury.\n\nIV. CORPORATE LIABILITY AND VICARIOUS LIABILITY ANALYSIS\n\nMeridian faces potential liability on multiple theories:\n\n1. Vicarious Liability: If Dr. Holloway is an employed physician (rather than an independent contractor with staff privileges), Meridian is vicariously liable under respondeat superior. We understand Dr. Holloway is employed by Meridian Physician Partners, a wholly-owned subsidiary, which likely establishes vicarious liability.\n\n2. Corporate Negligence: Under the doctrine of corporate negligence established in Thompson v. Nason Hospital and its progeny, a hospital has independent duties regarding credentialing, privileging, and oversight. We recommend reviewing Dr. Holloway's credentialing file for any prior quality concerns, peer review findings, or privileging restrictions.\n\n3. Nursing Negligence: The nursing staff's failure to escalate the patient's deteriorating condition more aggressively may constitute an independent basis for hospital liability.\n\nV. RECOMMENDATIONS\n\n1. Retain surgical expert immediately to review the complete medical records and provide a preliminary liability assessment. We recommend Dr. Robert Kline (Johns Hopkins, hepatobiliary surgery) or Dr. Sarah Mitchum (Cleveland Clinic, minimally invasive surgery).\n\n2. Preserve all records, including electronic health records, nursing notes, OR logs, PACU records, call records, and any internal quality review or incident reports related to this case.\n\n3. Evaluate mediation: Given the strength of Plaintiff's liability case and the significant damages exposure, we recommend that Meridian consider early mediation (after initial expert review confirms our preliminary assessment). An early resolution in the range of $3,000,000 to $4,500,000 may represent a favorable outcome compared to the risk of a trial verdict at the upper end of our exposure estimate.\n\n4. Review Dr. Holloway's credentialing file and consider whether any peer review or privileging action is warranted.\n\n5. Notify Meridian's professional liability insurer immediately if not already done. The carrier should be involved in the defense strategy from the outset.\n\nWe are available to discuss this assessment at your earliest convenience.\n\nRespectfully submitted,\n\nDavid R. Whitfield\nJulia M. Rosenthal\nWHITFIELD & ASSOCIATES LLP`,

  advice_regulatory: `MITCHELL, GRANT & SULLIVAN LLP\nATTORNEYS AT LAW\nREGULATORY AND GOVERNMENT AFFAIRS PRACTICE\n\nMEMORANDUM\n\nPRIVILEGED AND CONFIDENTIAL\nATTORNEY-CLIENT COMMUNICATION\n\nTO:        Rachel Vasquez, Chief Compliance Officer\n           Orion Pharmaceuticals, Inc.\n\nFROM:      Katherine L. Mitchell\n           Brian J. Nakamura\n\nDATE:      March 20, 2024\n\nRE:        Regulatory Risk Assessment — FDA Compliance Issues\n           Orion Pharmaceuticals Wilmington Manufacturing Facility\n           Impact on Pending NDA for ORN-4218 (Verexapril)\n\nI. EXECUTIVE SUMMARY\n\nYou have asked us to assess the regulatory risk arising from the FDA Form 483 observations issued following the February 26–March 8, 2024, inspection of Orion's Wilmington, Delaware manufacturing facility, and to evaluate the potential impact of these findings on the pending New Drug Application ("NDA") for ORN-4218 (Verexapril), a novel angiotensin receptor-neprilysin inhibitor ("ARNI") for the treatment of heart failure with preserved ejection fraction ("HFpEF"). The PDUFA target action date for ORN-4218 is August 15, 2024.\n\nBased on our review of the Form 483, Orion's internal quality records, applicable FDA guidance, and precedent enforcement actions, we assess the overall regulatory risk as high. Without prompt and comprehensive corrective action, the 483 observations could result in: (a) a Warning Letter, which would effectively delay NDA approval by 6-12 months or longer; (b) a Complete Response Letter ("CRL") for the ORN-4218 NDA citing unresolved manufacturing compliance issues; or (c) in a worst-case scenario, a consent decree governing operations at the Wilmington facility.\n\nThis memorandum outlines our detailed analysis and recommendations for a response strategy designed to mitigate these risks.\n\nII. FORM 483 OBSERVATIONS — SUMMARY AND ANALYSIS\n\nThe FDA investigator (Dr. Patricia Feng, Office of Pharmaceutical Quality, ORA) issued seven observations across three categories. We analyze each below with reference to the applicable Current Good Manufacturing Practice ("cGMP") regulations under 21 CFR Parts 210 and 211.\n\nA. Data Integrity Observations (Observations 1-3)\n\nThese observations present the most significant regulatory risk.\n\nObservation 1: The HPLC systems in the Quality Control laboratory were configured to permit deletion of electronic raw data files. Audit trail review revealed that 14 data files associated with stability testing of three commercial products were deleted between September 2023 and January 2024, and the deletions were not documented, investigated, or reported. The deleted files pertained to out-of-specification ("OOS") results that were not included in annual product quality reviews.\n\nAnalysis: This is an extremely serious observation. Under FDA's December 2018 guidance "Data Integrity and Compliance With Drug CGMP" and the MHRA's 2018 GxP Data Integrity Guidance, deletion of raw analytical data — particularly OOS data — without documentation constitutes a fundamental data integrity failure. The FDA views undocumented data deletions as among the most serious cGMP violations, as they undermine the entire quality system's reliability.\n\nPrecedent: In the recent Warning Letter to Wockhardt Ltd. (October 2023), the FDA cited virtually identical findings — deletion of HPLC data files containing failing results — as evidence of a "pattern of data manipulation" and required the company to retain an independent third-party auditor. Similarly, in the consent decree against Ranbaxy Laboratories (2012), undocumented data deletions were a central basis for the enforcement action.\n\nWe must determine whether the deletions were the result of individual misconduct, a systemic gap in access controls, or (worst case) direction from management. The answer will significantly affect the FDA's enforcement posture and our remediation strategy.\n\nObservation 2: Laboratory analysts were observed using shared login credentials to access the chromatographic data system (Empower 3). Four analysts in the QC laboratory used a single generic login ("QC_Lab1") rather than individual user accounts, making it impossible to attribute specific analytical actions to individual analysts.\n\nAnalysis: Individual accountability is a fundamental principle of data integrity. The use of shared credentials violates 21 CFR 211.68(b), which requires that electronic systems have appropriate controls to prevent unauthorized access and that input to and output from the computer be checked for accuracy. FDA's data integrity guidance specifically requires that each person who uses an electronic system have an individual account. This observation compounds the severity of Observation 1 — because analysts shared credentials, it is impossible to determine who deleted the OOS data files identified in Observation 1.\n\nObservation 3: The backup procedures for electronic laboratory data were inadequate. Backups were performed weekly rather than daily, and the backup verification process did not confirm data completeness. A server failure in November 2023 resulted in loss of approximately 72 hours of analytical data, which was not reported as a deviation or investigated.\n\nAnalysis: While less severe than Observations 1 and 2, this finding further erodes confidence in the integrity of Orion's electronic data. Under 21 CFR 211.68(a), backup data must be exact and complete. The unreported data loss following the server failure is particularly concerning because it may raise questions about what other data may have been lost or corrupted without detection.\n\nB. Process Validation Observations (Observations 4-5)\n\nObservation 4: The process validation for ORN-4218 (Verexapril) tablets, 50 mg and 100 mg strengths, did not include an adequate evaluation of the drug product's sensitivity to variations in the granulation endpoint. Commercial-scale manufacturing records for 12 batches showed granulation endpoint moisture content ranging from 1.8% to 3.4% LOD, but the validation protocol tested only a single granulation endpoint (2.5% LOD).\n\nAnalysis: This observation directly implicates the ORN-4218 NDA. Under FDA's 2011 Process Validation Guidance (Stage 2 — Process Performance Qualification), the manufacturer must demonstrate that the commercial manufacturing process is capable of reproducible performance across the range of conditions encountered during routine manufacturing. A validation protocol that tests only a single point within a range that varies significantly in practice does not demonstrate process understanding or control.\n\nThe NDA reviewer will almost certainly be aware of this 483 observation (FDA's Office of Pharmaceutical Quality coordinates with the Office of Regulatory Affairs), and it could form the basis for a manufacturing-related deficiency in the NDA review. At minimum, we should expect an Information Request during the NDA review cycle requiring additional process validation data.\n\nObservation 5: Continued process verification ("Stage 3" process validation) for two commercial products (Orion's cardiovascular products Cardivex and Venostatin) was inadequate. Statistical trending of critical quality attributes was not performed, and process performance was assessed only by comparison to specification limits rather than through statistical process control methods.\n\nAnalysis: While this observation pertains to existing commercial products rather than ORN-4218, it reflects a systemic deficiency in Orion's process validation lifecycle approach. The FDA's process validation guidance emphasizes that manufacturers must establish an ongoing program to collect and analyze product and process data to detect process drift and ensure continued state of control. This observation will color the FDA's assessment of Orion's overall quality culture.\n\nC. Quality System Observations (Observations 6-7)\n\nObservation 6: The Quality Unit failed to adequately investigate 8 of 23 OOS results identified during routine testing of commercial products in 2023. Investigation reports for these 8 OOS results were closed within 24-48 hours with conclusions attributing the results to "analyst error" without documented evidence supporting that determination.\n\nAnalysis: Premature closure of OOS investigations with unsupported "analyst error" conclusions is a well-known FDA enforcement trigger. Under 21 CFR 211.192 and the FDA's 2022 guidance "Investigating Out-of-Specification (OOS) Test Results for Pharmaceutical Production," a thorough OOS investigation must include a laboratory investigation phase (to identify potential analytical root causes) followed, if necessary, by a manufacturing investigation phase. Attributing an OOS result to analyst error requires specific documented evidence (e.g., a visually observed spill, instrument malfunction log, training deficiency) — a conclusory statement is insufficient.\n\nThis observation is compounded by the data deletion finding in Observation 1: the FDA may question whether "analyst error" attributions were used as a mechanism to dismiss genuine OOS results.\n\nObservation 7: The annual product quality review ("APQR") for Cardivex tablets for the year 2023 did not include trending analysis of critical process parameters, did not analyze the 23 OOS results referenced in Observation 6, and was not completed until February 2024 (two months past the SOP-required deadline of December 31, 2023).\n\nAnalysis: This is the least severe individual observation but contributes to the overall picture of a quality system that is not functioning as designed. The failure to include OOS trending in the APQR is particularly problematic because the APQR is supposed to be a holistic review that identifies quality trends and drives continuous improvement.\n\nIII. IMPACT ON ORN-4218 NDA\n\nThe ORN-4218 NDA is at significant risk due to these findings. Our assessment:\n\n1. Pre-Approval Inspection ("PAI"): If the Wilmington facility PAI has not yet occurred, the 483 observations will almost certainly delay and complicate it. The PAI investigator will focus heavily on the data integrity and process validation findings, and any unremediated deficiencies will likely result in a "withhold approval" recommendation.\n\n2. If the PAI has already occurred with a favorable recommendation: The 483 findings from the subsequent surveillance inspection could prompt the OPQ reviewer to re-evaluate the PAI recommendation, particularly given the process validation observation specific to ORN-4218.\n\n3. Timeline impact: If a Warning Letter issues, industry experience indicates that NDA approval will be delayed until the Warning Letter is resolved, which typically requires: (a) a comprehensive corrective action response; (b) implementation and verification of corrective actions; and (c) a successful reinspection. This process typically takes 6-18 months.\n\n4. Best-case scenario: With an aggressive, comprehensive response and proactive engagement with FDA, we may be able to prevent escalation to a Warning Letter and limit the NDA impact to an Information Request and possible 3-month extension of the review timeline.\n\nIV. RECOMMENDED RESPONSE STRATEGY\n\nA. Immediate Actions (Within 72 Hours)\n\n1. Issue a quality hold on all products manufactured at the Wilmington facility pending completion of an impact assessment of the data integrity findings.\n\n2. Disable all shared login credentials on laboratory information systems and implement individual user accounts with role-based access controls.\n\n3. Disable the data deletion function on all chromatographic data systems and implement system administrator controls requiring documented justification and QA approval for any data modifications.\n\n4. Engage an independent third-party cGMP compliance firm (we recommend Lachman Consultants or NSF International) to conduct a comprehensive data integrity audit of the Wilmington facility, including forensic review of all chromatographic data system audit trails for the period January 2022 through present.\n\n5. Commission a retrospective review of all OOS investigations closed in 2022-2024 to assess whether any were prematurely or inadequately closed.\n\nB. 483 Response (Due April 5, 2024 — 15 Business Days)\n\nThe 483 response is the single most important document in the remediation strategy. We recommend:\n\n1. Executive-level ownership: The response should be signed by Orion's CEO or President, not just the VP of Quality, to demonstrate senior management commitment.\n\n2. Acknowledge without excuse: For each observation, clearly acknowledge the deficiency without qualification or defensiveness. Avoid any language that minimizes the findings.\n\n3. Root cause analysis: For the data integrity observations, provide a preliminary root cause analysis. If the full root cause investigation is not complete, describe the investigation plan with committed milestones.\n\n4. Immediate corrections: Document all actions already taken (shared credentials disabled, deletion function removed, etc.).\n\n5. Long-term CAPA: For each observation, provide a detailed Corrective and Preventive Action ("CAPA") plan with specific deliverables, responsible persons, and completion dates.\n\n6. Third-party audit: Announce the engagement of the independent auditor and commit to sharing the audit findings with FDA.\n\nC. Proactive FDA Engagement\n\n1. Request a Type A meeting with the Office of Pharmaceutical Quality within 30 days to discuss: (a) the remediation plan; (b) the specific impact on the ORN-4218 NDA; and (c) what additional data or actions FDA would require to maintain the current PDUFA date or minimize any extension.\n\n2. Consider whether a voluntary FDA-initiated reinspection (before any Warning Letter issues) would be advantageous — this can demonstrate confidence in the remediation and provide FDA with verification earlier than the standard reinspection timeline.\n\nD. ORN-4218-Specific Actions\n\n1. Conduct supplemental process validation for ORN-4218 addressing the granulation endpoint variability identified in Observation 4. This should include at least three additional PPQ batches manufactured at the extremes of the observed granulation endpoint range.\n\n2. Prepare a proactive submission to the NDA file (Amendment) describing the supplemental validation and the overall quality remediation plan. This demonstrates transparency and may partially mitigate the need for an FDA Information Request.\n\nV. RISK MATRIX\n\nScenario                              | Probability | NDA Impact           | Financial Impact\n--------------------------------------|-------------|----------------------|------------------\nWarning Letter + CRL                  | 35%         | 12-18 month delay    | $180-280M lost revenue\nInformation Request + 3-month delay   | 40%         | 3-6 month delay      | $45-90M lost revenue\nNo Warning Letter, PAI/reinspection   | 20%         | 0-3 month delay      | $0-45M lost revenue\nConsent Decree                        | 5%          | 18-36 month delay    | $350-500M+ impact\n\nEstimates of lost revenue assume ORN-4218 peak annual U.S. revenue projections of $1.2 billion (per Orion's SEC filings) and a linear ramp over 36 months post-launch.\n\nVI. CONCLUSION\n\nThe Wilmington facility 483 observations represent a serious regulatory challenge that requires immediate, comprehensive, and transparent corrective action. The data integrity findings are the most critical and must be addressed with the urgency they demand — any perception that Orion is minimizing or inadequately addressing data integrity concerns will significantly increase the risk of escalation to a Warning Letter or consent decree.\n\nWith the aggressive remediation strategy outlined above, we believe there is a reasonable probability (approximately 60%) of avoiding a Warning Letter and limiting the ORN-4218 NDA impact to a manageable delay of 3-6 months. However, this outcome requires immediate action, full organizational commitment, and transparent engagement with the FDA.\n\nWe recommend scheduling a call with your executive leadership team this week to align on the remediation strategy and resource commitments.\n\nRespectfully submitted,\n\nKatherine L. Mitchell\nBrian J. Nakamura\nMITCHELL, GRANT & SULLIVAN LLP`,

  opinion: `UNITED STATES COURT OF APPEALS FOR THE SEVENTH CIRCUIT\n\nNo. 23-2847\n\nMARIA GONZALEZ,\n  Plaintiff-Appellant,\n\nv.\n\nCITY OF SPRINGFIELD, a municipal corporation, and OFFICER JAMES TAYLOR, individually and in his official capacity,\n  Defendants-Appellees.\n\nAppeal from the United States District Court for the Central District of Illinois.\nNo. 3:22-cv-00891 — Judge Robert Harrison, presiding.\n\nOPINION\n\nWOOD, Circuit Judge.\n\nMaria Gonzalez appeals the district court's grant of summary judgment in favor of the City of Springfield and Officer James Taylor on her claims under 42 U.S.C. \u00A7 1983 for excessive force in violation of the Fourth Amendment and municipal liability under Monell v. Department of Social Services, 436 U.S. 658 (1978).\n\nI. BACKGROUND\n\nOn March 15, 2022, Officer Taylor responded to a domestic disturbance call at Gonzalez's residence. Upon arrival, Officer Taylor encountered Gonzalez on her front porch. According to Gonzalez, she was unarmed and compliant with Officer Taylor's instructions. Despite this, Officer Taylor allegedly used a Taser on Gonzalez, causing her to fall and sustain injuries including a fractured wrist and concussion.\n\nOfficer Taylor maintains that Gonzalez was aggressive and non-compliant, and that his use of the Taser was a reasonable application of force under the circumstances.\n\nII. STANDARD OF REVIEW\n\nWe review the district court's grant of summary judgment de novo, construing all facts and drawing all reasonable inferences in favor of the non-moving party. Scott v. Harris, 550 U.S. 372, 378 (2007). Summary judgment is appropriate when there is no genuine dispute as to any material fact and the movant is entitled to judgment as a matter of law. Fed. R. Civ. P. 56(a).\n\nIII. ANALYSIS\n\nA. Excessive Force Claim\n\nClaims of excessive force during an arrest are analyzed under the Fourth Amendment's objective reasonableness standard. Graham v. Connor, 490 U.S. 386, 395 (1989). The inquiry requires balancing the nature and quality of the intrusion on the individual's Fourth Amendment interests against the countervailing governmental interests at stake. Id. at 396.\n\nThe relevant factors include: (1) the severity of the crime at issue; (2) whether the suspect poses an immediate threat to the safety of officers or others; and (3) whether the suspect is actively resisting arrest or attempting to evade arrest by flight. Id.\n\nHere, the parties present fundamentally different accounts of the encounter. Gonzalez maintains she was compliant and non-threatening, while Officer Taylor asserts she was aggressive. At the summary judgment stage, we must credit Gonzalez's version of events. Under her account, the use of a Taser against an unarmed, compliant individual responding to a domestic call would constitute excessive force.\n\nThe district court erred by crediting Officer Taylor's version of events over Gonzalez's at the summary judgment stage. We REVERSE the grant of summary judgment on the excessive force claim and REMAND for further proceedings.\n\nB. Qualified Immunity\n\nOfficer Taylor asserts qualified immunity. Qualified immunity shields government officials from civil damages liability unless their conduct violates clearly established statutory or constitutional rights. Pearson v. Callahan, 555 U.S. 223, 231 (2009).\n\nTaking the facts in the light most favorable to Gonzalez, a reasonable officer would have known that using a Taser on an unarmed, compliant individual violated the Fourth Amendment. We therefore deny qualified immunity at this stage.\n\nIV. CONCLUSION\n\nThe judgment of the district court is REVERSED in part and REMANDED for further proceedings consistent with this opinion.`
};

// ==============================================
// Initialization
// ==============================================

async function init() {
  checkHealth();
  setInterval(checkHealth, 10000);
  await loadProviders();
  await loadSettings();
  setupDragDrop();

  // Restore cached results from a previous page load (survives live-reload)
  if (!restoreState()) {
    renderProgressStages('pending');
  }
}

// ==============================================
// Health Check — detailed subsystem status
// ==============================================

function setChip(id, dotColor, detail, tooltip) {
  const chip = document.getElementById(id);
  if (!chip) return;
  const dot = chip.querySelector('.chip-dot');
  dot.className = 'chip-dot ' + dotColor;
  const detailEl = document.getElementById(id + 'Detail');
  if (detailEl) detailEl.textContent = detail;
  chip.setAttribute('data-tooltip', tooltip);
}

async function checkHealth() {
  // Quick basic check first
  try {
    const r = await fetch(`${API}/health`);
    if (!r.ok) throw new Error();
    setChip('chipBackend', 'green', 'Connected', 'Backend is running');
  } catch {
    setChip('chipBackend', 'red', 'Offline', 'Cannot reach backend at ' + API);
    setChip('chipFolio', 'gray', '---', 'Backend offline');
    setChip('chipEmbedding', 'gray', '---', 'Backend offline');
    setChip('chipLLM', 'gray', '---', 'Backend offline');
    setChip('chipSpacy', 'gray', '---', 'Backend offline');
    return;
  }

  // Detailed subsystem check
  try {
    const r = await fetch(`${API}/health/detail`);
    if (!r.ok) return;
    const d = await r.json();

    // FOLIO Ontology
    const f = d.folio_ontology || {};
    if (f.status === 'ready') {
      setChip('chipFolio', 'green',
        `${(f.concepts || 0).toLocaleString()} concepts`,
        `FOLIO loaded: ${(f.concepts || 0).toLocaleString()} concepts, ${(f.labels_indexed || 0).toLocaleString()} labels indexed`);
    } else if (f.status === 'not_loaded') {
      setChip('chipFolio', 'orange', 'Standby', 'FOLIO ontology not yet loaded — loads on first enrichment request');
    } else {
      setChip('chipFolio', 'red', 'Error', f.message || 'Failed to load FOLIO ontology');
    }

    // Embedding
    const e = d.embedding || {};
    if (e.status === 'ready') {
      setChip('chipEmbedding', 'green',
        e.provider || 'Ready',
        `Embedding: ${e.provider}, ${(e.index_size || 0).toLocaleString()} vectors indexed`);
    } else if (e.status === 'not_loaded') {
      setChip('chipEmbedding', 'orange', 'Standby', 'Embedding service loads on first use');
    } else {
      setChip('chipEmbedding', 'red', 'Error', e.message || 'Embedding service error');
    }

    // LLM
    const l = d.llm || {};
    const modelShort = (l.model || '').split('/').pop();
    if (l.status === 'configured') {
      setChip('chipLLM', 'green',
        `${l.provider}/${modelShort}`,
        `LLM: ${l.provider} / ${l.model} — API key configured`);
    } else if (l.status === 'no_api_key') {
      setChip('chipLLM', 'orange',
        `${l.provider}/${modelShort}`,
        `LLM: ${l.provider} / ${l.model} — No API key set. EntityRuler-only mode.`);
    } else {
      setChip('chipLLM', 'red', 'Error', l.message || 'LLM error');
    }

    // spaCy
    const s = d.spacy || {};
    if (s.status === 'ready') {
      setChip('chipSpacy', 'green', `v${s.version}`, `spaCy ${s.version} — EntityRuler ready`);
    } else {
      setChip('chipSpacy', 'red', 'Error', s.message || 'spaCy not available');
    }
  } catch {
    // Detail endpoint failed — leave subsystem chips at current state
  }
}

// ==============================================
// LLM Provider Configuration
// ==============================================

async function loadProviders() {
  try {
    // Fetch provider metadata, known models, and pricing in parallel
    const [provR, modR, priceR] = await Promise.all([
      fetch(`${API}/settings/providers`),
      fetch(`${API}/settings/known-models`),
      fetch(`${API}/settings/pricing`).catch(() => null),
    ]);

    if (provR.ok) {
      const data = await provR.json();
      providersData = data.providers || {};

      // Populate inline provider select
      const sel = document.getElementById('providerSelect');
      sel.innerHTML = '';
      for (const [name, meta] of Object.entries(providersData)) {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = meta.display_name || name;
        sel.appendChild(opt);
      }

      // Set current
      if (data.current) {
        document.getElementById('providerSelect').value = data.current.provider;
      }
    }

    if (modR.ok) {
      const modData = await modR.json();
      knownModels = modData.models || {};
    }

    if (priceR && priceR.ok) {
      const priceData = await priceR.json();
      pricingData = priceData.models || priceData || {};
    }

    onProviderChange();
  } catch (e) {
    console.error('Failed to load providers:', e);
  }
}

function onProviderChange() {
  const provider = document.getElementById('providerSelect').value;
  const meta = providersData[provider] || {};
  const modelSelect = document.getElementById('modelSelect');

  // Populate model dropdown from known models
  populateModelSelect(modelSelect, provider);

  // Show/hide API key based on provider metadata
  const needsKey = meta.requires_api_key !== false;
  document.getElementById('apiKeyGroup').style.display = needsKey ? 'block' : 'none';

  // Clear test status when switching providers
  const testStatus = document.getElementById('testStatus');
  if (testStatus) { testStatus.textContent = ''; testStatus.className = 'test-status'; }

  updateLLMSummary();
}

function populateModelSelect(sel, provider) {
  sel.innerHTML = '';
  const models = knownModels[provider] || [];
  for (const m of models) {
    const opt = document.createElement('option');
    opt.value = m.id;
    const ctx = m.context_window ? ` (${(m.context_window / 1000).toFixed(0)}K)` : '';
    opt.textContent = m.name + ctx;
    sel.appendChild(opt);
  }
  // If no known models, add a placeholder
  if (!models.length) {
    const opt = document.createElement('option');
    opt.value = (providersData[provider] || {}).default_model || 'default';
    opt.textContent = opt.value;
    sel.appendChild(opt);
  }
}

async function fetchDynamicModels() {
  const provider = document.getElementById('providerSelect').value;
  const apiKey = document.getElementById('apiKeyInput').value;
  const modelSelect = document.getElementById('modelSelect');
  const currentModel = modelSelect.value;

  try {
    const r = await fetch(`${API}/settings/models`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ provider, api_key: apiKey || undefined }),
    });
    if (!r.ok) return;
    const data = await r.json();
    const models = data.models || [];
    if (models.length > 0) {
      modelSelect.innerHTML = '';
      for (const m of models) {
        const opt = document.createElement('option');
        opt.value = m.id;
        const ctx = m.context_window ? ` (${(m.context_window / 1000).toFixed(0)}K)` : '';
        opt.textContent = (m.name || m.id) + ctx;
        modelSelect.appendChild(opt);
      }
      // Restore previous selection if still available
      if (currentModel) modelSelect.value = currentModel;
    }
  } catch (e) {
    console.debug('Dynamic model fetch failed:', e);
  }
}

function updateLLMSummary() {
  const provider = document.getElementById('providerSelect').value;
  const model = document.getElementById('modelSelect').value;
  document.getElementById('llmSummary').textContent = `${provider} / ${model || '...'}`;
}

async function loadSettings() {
  try {
    const r = await fetch(`${API}/settings`);
    if (!r.ok) return;
    const data = await r.json();
    if (data.llm_provider) {
      document.getElementById('providerSelect').value = data.llm_provider;
      onProviderChange();
      if (data.llm_model) {
        document.getElementById('modelSelect').value = data.llm_model;
      }
    }
    updateLLMSummary();
  } catch (e) {
    console.error('Failed to load settings:', e);
  }
}

async function testConnection() {
  const provider = document.getElementById('providerSelect').value;
  const model = document.getElementById('modelSelect').value;
  const apiKey = document.getElementById('apiKeyInput').value;
  const status = document.getElementById('testStatus');

  status.textContent = 'Testing...';
  status.className = 'test-status';

  // Save provider/model/key to backend settings so health check updates
  try {
    const settingsBody = { llm_provider: provider, llm_model: model };
    if (apiKey) {
      // Map provider to correct API key field
      const keyField = _providerKeyField(provider);
      if (keyField) settingsBody[keyField] = apiKey;
    }
    await fetch(`${API}/settings`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(settingsBody),
    });
  } catch { /* settings save is best-effort */ }

  // Test the connection
  try {
    const r = await fetch(`${API}/settings/test-connection`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ provider, model, api_key: apiKey || undefined }),
    });
    const data = await r.json();
    if (data.success) {
      status.textContent = 'Connection successful' + (data.model ? ` (${data.model})` : '');
      status.className = 'test-status ok';
      // Also fetch dynamic model list on successful connection
      fetchDynamicModels();
    } else {
      status.textContent = data.message || 'Connection failed';
      status.className = 'test-status error';
    }
  } catch (e) {
    status.textContent = e.message;
    status.className = 'test-status error';
  }

  checkHealth();
  updateLLMSummary();
}

function _providerKeyField(provider) {
  const map = {
    openai: 'openai_api_key',
    anthropic: 'anthropic_api_key',
    google: 'google_api_key',
    mistral: 'mistral_api_key',
    cohere: 'cohere_api_key',
    meta_llama: 'meta_llama_api_key',
    groq: 'groq_api_key',
    xai: 'xai_api_key',
    github_models: 'github_models_api_key',
  };
  return map[provider] || null;
}

// ==============================================
// Settings Modal
// ==============================================

function openSettings() {
  document.getElementById('settingsModal').classList.add('visible');
  populateSettingsCards();
}

function closeSettings() {
  document.getElementById('settingsModal').classList.remove('visible');
}

function populateSettingsCards() {
  const container = document.getElementById('settingsProviderCards');
  const cloudProviders = Object.entries(providersData).filter(([_, m]) => m.requires_api_key !== false);
  const activeProvider = document.getElementById('providerSelect').value;

  let html = '';
  for (const [name, meta] of cloudProviders) {
    const displayName = escapeHtml(meta.display_name || name);
    const isActive = name === activeProvider;
    const escapedName = escapeAttr(name);
    html += `<div class="provider-card${isActive ? ' active' : ''}" id="providerCard_${escapedName}">
      <div class="provider-card-header">
        <input type="radio" name="settingsActiveProvider" value="${escapedName}"${isActive ? ' checked' : ''}>
        <span class="provider-name">${displayName}</span>
        <button type="button" class="btn-test-card" onclick="testSettingsProvider('${escapedName}')">Test</button>
        <span class="test-status" id="settingsTestStatus_${escapedName}"></span>
      </div>
      <div class="provider-card-field">
        <span class="field-label">Key</span>
        <input type="password" id="settingsKey_${escapedName}" placeholder="${meta.api_key_set ? 'Key saved — enter new to replace' : 'API key for ' + displayName}"${meta.api_key_set ? ' data-key-saved="true"' : ''}>
      </div>
      <div class="provider-card-field">
        <span class="field-label">Model</span>
        <select id="settingsModel_${escapedName}" onchange="updateSettingsCost('${escapedName}')"></select>
        <button type="button" class="btn-refresh" onclick="refreshSettingsModels('${escapedName}')" title="Refresh model list from API">&#8635;</button>
      </div>
      <div class="provider-card-cost" id="settingsCost_${escapedName}"></div>
    </div>`;
  }
  container.innerHTML = html;

  // Populate model selects and costs
  for (const [name] of cloudProviders) {
    const sel = document.getElementById(`settingsModel_${name}`);
    populateModelSelect(sel, name);
    // Try to set the current model if this is the active provider
    if (name === activeProvider) {
      const currentModel = document.getElementById('modelSelect').value;
      if (currentModel) sel.value = currentModel;
    }
    updateSettingsCost(name);
  }

  // Radio button change listeners
  container.querySelectorAll('input[name="settingsActiveProvider"]').forEach(radio => {
    radio.addEventListener('change', () => {
      container.querySelectorAll('.provider-card').forEach(card => card.classList.remove('active'));
      if (radio.checked) {
        document.getElementById(`providerCard_${radio.value}`).classList.add('active');
      }
    });
  });
}

function updateSettingsCost(providerName) {
  const costEl = document.getElementById(`settingsCost_${providerName}`);
  if (!costEl) return;
  const sel = document.getElementById(`settingsModel_${providerName}`);
  if (!sel) return;
  const modelId = sel.value;

  const pricing = pricingData[modelId];
  if (pricing && (pricing.input_cost_per_1k || pricing.output_cost_per_1k)) {
    const inputCost = pricing.input_cost_per_1k || 0;
    const outputCost = pricing.output_cost_per_1k || 0;
    costEl.textContent = `Est. cost: ~$${((inputCost + outputCost) / 2).toFixed(4)} per pipeline node`;
  } else {
    costEl.textContent = '';
  }
}

async function refreshSettingsModels(providerName) {
  const apiKey = document.getElementById(`settingsKey_${providerName}`).value;
  const sel = document.getElementById(`settingsModel_${providerName}`);
  const currentModel = sel.value;

  try {
    const r = await fetch(`${API}/settings/models`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ provider: providerName, api_key: apiKey || undefined }),
    });
    if (!r.ok) return;
    const data = await r.json();
    const models = data.models || [];
    if (models.length > 0) {
      sel.innerHTML = '';
      for (const m of models) {
        const opt = document.createElement('option');
        opt.value = m.id;
        const ctx = m.context_window ? ` (${(m.context_window / 1000).toFixed(0)}K)` : '';
        opt.textContent = (m.name || m.id) + ctx;
        sel.appendChild(opt);
      }
      if (currentModel) sel.value = currentModel;
      updateSettingsCost(providerName);
    }
  } catch (e) {
    console.debug('Model refresh failed for', providerName, e);
  }
}

async function testSettingsProvider(providerName) {
  const apiKey = document.getElementById(`settingsKey_${providerName}`).value;
  const modelSel = document.getElementById(`settingsModel_${providerName}`);
  const model = modelSel ? modelSel.value : '';
  const status = document.getElementById(`settingsTestStatus_${providerName}`);

  status.textContent = 'Testing...';
  status.className = 'test-status';

  try {
    const r = await fetch(`${API}/settings/test-connection`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ provider: providerName, model, api_key: apiKey || undefined }),
    });
    const data = await r.json();
    if (data.success) {
      status.textContent = 'Connected';
      status.className = 'test-status ok';
    } else {
      status.textContent = data.message || 'Failed';
      status.className = 'test-status error';
    }
  } catch (e) {
    status.textContent = e.message;
    status.className = 'test-status error';
  }
}

async function saveSettings() {
  // Read selected provider from radio
  const checkedRadio = document.querySelector('input[name="settingsActiveProvider"]:checked');
  if (!checkedRadio) { closeSettings(); return; }
  const provider = checkedRadio.value;
  const modelSel = document.getElementById(`settingsModel_${provider}`);
  const model = modelSel ? modelSel.value : '';

  try {
    const body = { llm_provider: provider, llm_model: model };

    // Collect API keys from all provider cards
    const cloudProviders = Object.entries(providersData).filter(([_, m]) => m.requires_api_key !== false);
    for (const [name] of cloudProviders) {
      const input = document.getElementById(`settingsKey_${name}`);
      if (input && input.value) {
        const keyField = _providerKeyField(name);
        if (keyField) body[keyField] = input.value;
      }
    }

    await fetch(`${API}/settings`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });

    // Refresh provider metadata (updates api_key_set flags)
    await loadProviders();

    // Update inline config
    document.getElementById('providerSelect').value = provider;
    onProviderChange();
    document.getElementById('modelSelect').value = model;

    // Sync inline API key with the key for the current provider
    const inlineKey = document.getElementById('apiKeyInput');
    const keyInput = document.getElementById(`settingsKey_${provider}`);
    if (keyInput && keyInput.value) inlineKey.value = keyInput.value;

    updateLLMSummary();
    checkHealth();
    closeSettings();
  } catch (e) {
    alert('Failed to save settings: ' + e.message);
  }
}

// ==============================================
// File Upload
// ==============================================

function setupDragDrop() {
  const zone = document.getElementById('uploadZone');
  zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
  zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('dragover');
    if (e.dataTransfer.files.length) processFile(e.dataTransfer.files[0]);
  });
}

function handleFileUpload(event) {
  const file = event.target.files[0];
  if (file) processFile(file);
}

async function processFile(file) {
  uploadedFilename = file.name;
  const ext = file.name.split('.').pop().toLowerCase();

  if (['pdf', 'docx', 'doc', 'rtf', 'msg'].includes(ext)) {
    // Read as base64
    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result.split(',')[1];
      document.getElementById('docInput').value = base64;
      document.getElementById('docInput').placeholder = `File loaded: ${file.name} (${(file.size/1024).toFixed(1)} KB)`;
    };
    reader.readAsDataURL(file);
  } else {
    // Read as text
    const text = await file.text();
    document.getElementById('docInput').value = text;
  }
}

// ==============================================
// Enrichment Submission & Polling
// ==============================================

async function submitEnrichment() {
  const content = document.getElementById('docInput').value.trim();
  if (!content) return;

  const provider = document.getElementById('providerSelect').value;
  const model = document.getElementById('modelSelect').value;
  const apiKey = document.getElementById('apiKeyInput').value;
  const btn = document.getElementById('enrichBtn');

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Processing...';
  setStatus('Submitting...', 'running');
  renderProgressStages('pending');

  try {
    // Save provider/model/key to backend settings first
    const settingsBody = { llm_provider: provider, llm_model: model };
    if (apiKey) {
      const keyField = _providerKeyField(provider);
      if (keyField) settingsBody[keyField] = apiKey;
    }
    await fetch(`${API}/settings`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(settingsBody),
    }).catch(() => {});

    const body = { content };
    if (uploadedFilename) body.filename = uploadedFilename;
    if (provider) body.llm_provider = provider;
    if (model) body.llm_model = model;
    if (apiKey) body.api_key = apiKey;

    const r = await fetch(`${API}/enrich`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });

    if (!r.ok) {
      const err = await r.json().catch(() => ({ detail: r.statusText }));
      throw new Error(err.detail || r.statusText);
    }

    const data = await r.json();
    currentJobId = data.job_id;
    setStatus(`Job ${currentJobId.slice(0,8)}... submitted`, 'running');
    startSSE();
  } catch (e) {
    setStatus(`Error: ${e.message}`, 'failed');
    btn.disabled = false;
    btn.textContent = 'Enrich Document';
  }
}

function pollJob() {
  if (pollInterval) clearInterval(pollInterval);
  if (pollTimeout) clearTimeout(pollTimeout);

  // Max poll duration: 5 minutes
  pollTimeout = setTimeout(() => {
    if (pollInterval) clearInterval(pollInterval);
    setStatus('Timeout: job took too long', 'failed');
    resetButton();
  }, 300000);

  pollInterval = setInterval(async () => {
    try {
      const r = await fetch(`${API}/enrich/${currentJobId}`);
      if (!r.ok) return;
      const job = await r.json();
      currentJob = job;

      renderProgressStages(job.status);

      if (job.status === 'completed') {
        stopPolling();
        try { renderResults(job); } catch (re) { console.error('Render error:', re); }
        cacheState();
        resetButton();
        const annCount = (job.result?.annotations || []).length;
        setStatus(`Completed: ${annCount} annotations`, 'completed');
      } else if (job.status === 'failed') {
        stopPolling();
        setStatus(`Failed: ${job.error || 'Unknown error'}`, 'failed');
        resetButton();
      } else {
        setStatus(`Stage: ${STAGE_LABELS[job.status] || job.status}`, 'running');
      }
    } catch (e) {
      console.error('Poll error:', e);
    }
  }, 500);
}

function stopPolling() {
  if (pollInterval) clearInterval(pollInterval);
  if (pollTimeout) clearTimeout(pollTimeout);
  pollInterval = null;
  pollTimeout = null;
}

function resetButton() {
  const btn = document.getElementById('enrichBtn');
  btn.disabled = false;
  btn.textContent = 'Enrich Document';
}

// ==============================================
// SSE Streaming
// ==============================================

function startSSE() {
  closeSSE();
  accumulatedAnnotations = [];
  normalizedText = null;

  eventSource = new EventSource(`${API}/enrich/${currentJobId}/stream`);

  eventSource.addEventListener('status', (e) => {
    const data = JSON.parse(e.data);
    renderProgressStages(data.status);
    setStatus(`Stage: ${STAGE_LABELS[data.status] || data.status}`, 'running');
    if (data.canonical_text) normalizedText = data.canonical_text;
  });

  eventSource.addEventListener('preliminary_annotation', (e) => {
    const data = JSON.parse(e.data);
    addAnnotationToView(data);
  });

  eventSource.addEventListener('annotation', (e) => {
    const data = JSON.parse(e.data);
    addAnnotationToView(data);
  });

  eventSource.addEventListener('annotation_update', (e) => {
    const data = JSON.parse(e.data);
    updateAnnotationInView(data);
  });

  eventSource.addEventListener('activity', (e) => {
    const data = JSON.parse(e.data);
    activityEntries.push(data);
    renderActivityLog();
  });

  eventSource.addEventListener('complete', (e) => {
    const data = JSON.parse(e.data);
    closeSSE();
    resetButton();

    if (data.status === 'failed') {
      setStatus(`Failed: ${data.error || 'Unknown error'}`, 'failed');
      renderProgressStages('failed');
      return;
    }

    renderProgressStages('completed');
    setStatus(`Completed: ${data.total_annotations} annotations`, 'completed');
    // Fetch final job for full render (concepts list, metadata, triples, exports)
    fetchFinalJob();
    // Re-fetch after delay to pick up post-pipeline assessments (e.g., areas of law)
    setTimeout(() => fetchFinalJob(), 4000);
  });

  eventSource.addEventListener('error', (e) => {
    const data = e.data ? JSON.parse(e.data) : null;
    if (data && data.error) {
      setStatus(`Error: ${data.error}`, 'failed');
      closeSSE();
      resetButton();
      return;
    }
    // EventSource connection error — fall back to polling
    console.warn('SSE connection error, falling back to polling');
    closeSSE();
    pollJob();
  });
}

function closeSSE() {
  if (eventSource) {
    eventSource.close();
    eventSource = null;
  }
}

function renderActivityLog() {
  const container = document.getElementById('activityLog');
  if (!container) return;
  container.innerHTML = activityEntries.map(e => {
    const t = e.ts ? new Date(e.ts).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'}) : '';
    const cls = e.stage === 'orchestrator' ? ' orchestrator' : '';
    return `<div class="activity-entry"><span class="activity-ts">${t}</span><span class="activity-stage${cls}">${e.stage}</span><span class="activity-msg">${e.msg}</span></div>`;
  }).join('');
  container.scrollTop = container.scrollHeight;
}

function copyActivityLog() {
  const entries = activityEntries.map(e => {
    const t = e.ts ? new Date(e.ts).toISOString() : '';
    return `${t}\t${e.stage}\t${e.msg}`;
  }).join('\n');
  navigator.clipboard.writeText(entries).then(() => {
    const btn = document.querySelector('.btn-copy-log');
    btn.textContent = 'Copied!';
    setTimeout(() => { btn.textContent = 'Copy'; }, 1500);
  }).catch(() => {});
}

function addAnnotationToView(data) {
  // Check for duplicate by id
  const existingIdx = accumulatedAnnotations.findIndex(a => a.id === data.id);
  if (existingIdx >= 0) {
    accumulatedAnnotations[existingIdx] = data;
  } else {
    accumulatedAnnotations.push(data);
  }
  rerenderAnnotatedText();
}

function updateAnnotationInView(data) {
  const idx = accumulatedAnnotations.findIndex(a => a.id === data.id);
  if (idx >= 0) {
    accumulatedAnnotations[idx] = data;
  } else {
    accumulatedAnnotations.push(data);
  }
  rerenderAnnotatedText();
}

function rerenderAnnotatedText() {
  if (!currentJobId) return;
  // Build annotation objects compatible with renderAnnotatedText
  const annotations = accumulatedAnnotations.map(a => ({
    span: a.span,
    concepts: a.concepts,
    state: a.state,
  }));

  // Use normalized text (spans are relative to it); fall back to raw input
  const text = normalizedText || document.getElementById('docInput').value.trim();
  if (text) {
    document.getElementById('emptyState').style.display = 'none';
    document.getElementById('annotatedText').style.display = 'block';
    renderAnnotatedText(text, annotations);
  }
}

async function fetchFinalJob() {
  try {
    const r = await fetch(`${API}/enrich/${currentJobId}`);
    if (!r.ok) return;
    const job = await r.json();
    currentJob = job;
    renderResults(job);
    cacheState();
  } catch (e) {
    console.error('Failed to fetch final job:', e);
  }
}

// ==============================================
// Pipeline Progress
// ==============================================

function renderProgressStages(currentStatus) {
  const container = document.getElementById('progressStages');
  const fill = document.getElementById('progressFill');
  const stages = ['ingesting', 'normalizing', 'enriching', 'identifying', 'resolving', 'matching', 'judging'];
  const currentIdx = stages.indexOf(currentStatus);
  const isComplete = currentStatus === 'completed';
  const isFailed = currentStatus === 'failed';

  fill.style.width = isComplete ? '100%' : isFailed ? '100%' :
    currentIdx >= 0 ? `${((currentIdx + 1) / stages.length) * 100}%` : '0%';
  fill.style.background = isFailed ? 'var(--red)' : isComplete ? 'var(--green)' : 'var(--accent)';

  container.innerHTML = stages.map((s, i) => {
    let cls = 'stage-pill';
    if (isComplete) cls += ' done';
    else if (isFailed && i <= currentIdx) cls += ' error';
    else if (i < currentIdx) cls += ' done';
    else if (i === currentIdx) cls += ' active';
    return `<span class="${cls}">${STAGE_LABELS[s] || s}</span>`;
  }).join('');
}

// ==============================================
// Results Rendering
// ==============================================

function renderResults(job) {
  const text = job.result?.canonical_text?.full_text || '';
  const annotations = job.result?.annotations || [];
  const metadata = job.result?.metadata || {};

  renderAnnotatedText(text, annotations);
  renderConceptsList(annotations);
  renderTriples(metadata.spo_triples || []);
  renderMetadata(metadata, job);
  renderExportButtons();
}

function renderAnnotatedText(text, annotations) {
  const container = document.getElementById('annotatedText');
  const empty = document.getElementById('emptyState');

  if (!text) {
    container.style.display = 'none';
    empty.style.display = 'block';
    return;
  }

  empty.style.display = 'none';
  container.style.display = 'block';

  // Sort annotations by start, then by length descending for nesting
  const sorted = [...annotations].sort((a, b) => a.span.start - b.span.start || (b.span.end - b.span.start) - (a.span.end - a.span.start));

  let pieces = [];
  let lastEnd = 0;

  for (const ann of sorted) {
    if (!ann.concepts || ann.concepts.length === 0) continue;
    if (ann.span.start < lastEnd) continue; // skip overlapping

    const c = ann.concepts[0];
    const branch = (c.branches && c.branches.length > 0) ? c.branches[0] : (c.branch || '');
    const branchColor = BRANCH_COLORS[branch] || '#3b64e0';

    // Text before this annotation
    if (ann.span.start > lastEnd) {
      pieces.push(escapeHtml(text.slice(lastEnd, ann.span.start)));
    }

    const state = ann.state || c.state || 'confirmed';
    const dataAttrs = [
      `data-ann-id="${escapeAttr(ann.id || '')}"`,
      `data-iri="${escapeAttr(c.folio_iri || '')}"`,
      `data-label="${escapeAttr(c.folio_label || c.concept_text)}"`,
      `data-def="${escapeAttr(c.folio_definition || '')}"`,
      `data-branch="${escapeAttr(branch)}"`,
      `data-confidence="${c.confidence}"`,
      `data-source="${escapeAttr(c.source || '')}"`,
      `data-state="${escapeAttr(state)}"`,
    ].join(' ');

    // Confidence-based visual modulation (skip for rejected annotations)
    let confStyle = '';
    if (state !== 'rejected') {
      const confVal = typeof c.confidence === 'number' ? (c.confidence > 1 ? c.confidence / 100 : c.confidence) : 1;
      if (confVal < 0.5) {
        confStyle = 'opacity:0.55;border-bottom-style:dotted;';
      } else if (confVal < 0.8) {
        confStyle = 'opacity:0.75;border-bottom-style:dashed;';
      }
    }

    pieces.push(`<span class="annotation-span" ${dataAttrs}${confStyle ? ` style="${confStyle}"` : ''}>${escapeHtml(text.slice(ann.span.start, ann.span.end))}</span>`);
    lastEnd = Math.max(lastEnd, ann.span.end);
  }

  // Remaining text
  if (lastEnd < text.length) {
    pieces.push(escapeHtml(text.slice(lastEnd)));
  }

  container.innerHTML = pieces.join('');

  // Add click handlers
  container.querySelectorAll('.annotation-span').forEach(el => {
    el.addEventListener('click', (e) => { e.stopPropagation(); showTooltip(e, el); });
  });
}

function showTooltip(event, el) {
  const tooltip = document.getElementById('tooltip');
  const label = el.dataset.label;
  const branch = el.dataset.branch;
  const def = el.dataset.def;
  const iri = el.dataset.iri;
  const conf = parseFloat(el.dataset.confidence);
  const source = el.dataset.source;
  const annId = el.dataset.annId;

  const branchColor = BRANCH_COLORS[branch] || '#6b6b80';

  const confPct = conf > 1 ? conf : conf * 100;
  const confTier = confPct >= 80 ? 'conf-high' : confPct >= 50 ? 'conf-mid' : 'conf-low';

  // Check if this annotation already has feedback from this session
  const existingRating = _feedbackCache[annId] || null;

  tooltip.innerHTML = `
    <div class="tooltip-label">${escapeHtml(label)}</div>
    <div class="tooltip-branch" style="background:${branchColor}20;color:${branchColor}">${escapeHtml(branch || 'Unknown Branch')}</div>
    <div class="tooltip-confidence ${confTier}">${confPct.toFixed(0)}% confidence</div>
    ${def ? `<div class="tooltip-definition">${escapeHtml(def)}</div>` : ''}
    <div class="tooltip-meta">
      <span>Source: ${escapeHtml(source || 'unknown')}</span>
      <span>State: ${escapeHtml(el.dataset.state || 'confirmed')}</span>
    </div>
    ${iri ? `<div class="tooltip-iri" style="margin-top:4px"><a href="${escapeAttr(iri)}/html" target="_blank" rel="noopener">${escapeHtml(iri)}/html</a></div>` : ''}
    <div class="tooltip-feedback" data-ann-id="${escapeAttr(annId)}">
      <div class="tooltip-feedback-row">
        <button class="tooltip-feedback-btn${existingRating === 'up' ? ' active-up' : ''}" data-rating="up" onclick="submitFeedback(this, 'up')">&#x1F44D;</button>
        <button class="tooltip-feedback-btn${existingRating === 'down' ? ' active-down' : ''}" data-rating="down" onclick="submitFeedback(this, 'down')">&#x1F44E;</button>
        <span class="tooltip-feedback-saved" id="feedbackStatus-${escapeAttr(annId)}">${existingRating ? 'Saved' : ''}</span>
      </div>
      <textarea class="tooltip-feedback-note" id="feedbackNote-${escapeAttr(annId)}" placeholder="Add a note (optional)..." rows="1"
        onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();submitNote('${escapeAttr(annId)}')}"
        onblur="submitNote('${escapeAttr(annId)}')"></textarea>
    </div>
    ${annId && currentJobId ? `<div class="tooltip-lineage">
      <button class="tooltip-lineage-toggle" onclick="toggleLineage('${escapeAttr(annId)}')">Show stage lineage</button>
      <ul class="tooltip-lineage-list" id="lineage-${escapeAttr(annId)}" style="display:none"></ul>
    </div>` : ''}
  `;

  tooltip.classList.add('visible');

  // Position tooltip
  const rect = el.getBoundingClientRect();
  tooltip.style.left = '-9999px';
  tooltip.style.top = '-9999px';

  requestAnimationFrame(() => {
    const tw = tooltip.offsetWidth;
    const th = tooltip.offsetHeight;
    let top = rect.bottom + 8;
    let left = rect.left;

    if (left + tw > window.innerWidth) left = window.innerWidth - tw - 10;
    if (left < 10) left = 10;
    if (top + th > window.innerHeight) top = rect.top - th - 8;

    tooltip.style.top = top + 'px';
    tooltip.style.left = left + 'px';
  });
}

// Track feedback already submitted this session (annId → rating)
const _feedbackCache = {};

async function submitFeedback(btn, rating) {
  const feedbackDiv = btn.closest('.tooltip-feedback');
  const annId = feedbackDiv.dataset.annId;
  if (!annId || !currentJobId) return;

  const noteEl = document.getElementById(`feedbackNote-${annId}`);
  const comment = noteEl ? noteEl.value.trim() : '';
  const statusEl = document.getElementById(`feedbackStatus-${annId}`);

  // Optimistic UI: show selection immediately
  feedbackDiv.querySelectorAll('.tooltip-feedback-btn').forEach(b => {
    b.classList.remove('active-up', 'active-down');
  });
  btn.classList.add(rating === 'up' ? 'active-up' : 'active-down');
  _feedbackCache[annId] = rating;
  if (statusEl) statusEl.textContent = 'Saving...';

  try {
    const resp = await fetch(`${API}/feedback`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        job_id: currentJobId,
        annotation_id: annId,
        rating: rating,
        comment: comment,
      }),
    });

    if (resp.ok) {
      if (statusEl) statusEl.textContent = 'Saved';
    } else {
      // Revert on error
      btn.classList.remove('active-up', 'active-down');
      delete _feedbackCache[annId];
      if (statusEl) statusEl.textContent = 'Error saving';
    }
  } catch (e) {
    btn.classList.remove('active-up', 'active-down');
    delete _feedbackCache[annId];
    if (statusEl) statusEl.textContent = 'Error saving';
  }
}

// Track last-submitted note per annotation to avoid duplicate submissions
const _noteCache = {};

async function submitNote(annId) {
  if (!annId || !currentJobId) return;
  const noteEl = document.getElementById(`feedbackNote-${annId}`);
  if (!noteEl) return;
  const comment = noteEl.value.trim();
  if (!comment || comment === _noteCache[annId]) return;

  const rating = _feedbackCache[annId];
  if (!rating) return; // No rating yet — note will be sent with the next thumb click

  const statusEl = document.getElementById(`feedbackStatus-${annId}`);
  if (statusEl) statusEl.textContent = 'Saving...';

  try {
    const resp = await fetch(`${API}/feedback`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        job_id: currentJobId,
        annotation_id: annId,
        rating: rating,
        comment: comment,
      }),
    });
    if (resp.ok) {
      _noteCache[annId] = comment;
      if (statusEl) statusEl.textContent = 'Saved';
    } else {
      if (statusEl) statusEl.textContent = 'Error';
    }
  } catch (e) {
    if (statusEl) statusEl.textContent = 'Error';
  }
}

async function toggleLineage(annId) {
  const list = document.getElementById(`lineage-${annId}`);
  if (!list) return;

  if (list.style.display !== 'none') {
    list.style.display = 'none';
    list.previousElementSibling.textContent = 'Show stage lineage';
    return;
  }

  // Fetch lineage from API
  if (!list.dataset.loaded) {
    try {
      const resp = await fetch(`${API}/enrich/${currentJobId}/annotations/${annId}/lineage`);
      if (resp.ok) {
        const data = await resp.json();
        if (data.lineage && data.lineage.length > 0) {
          const stageLabels = {
            entity_ruler: 'Entity Ruler', semantic_ruler: 'Semantic Ruler',
            llm_concept: 'LLM Analysis', reconciliation: 'Reconciliation',
            resolution: 'Resolution', branch_judge: 'Branch Judge',
            string_matching: 'String Matching',
          };
          list.innerHTML = data.lineage.map(e => `
            <li>
              <span class="lineage-stage-name">${escapeHtml(stageLabels[e.stage] || e.stage)}</span>
              <span class="lineage-action">${escapeHtml(e.action)}</span>
              ${e.confidence != null ? `<span class="lineage-confidence">${(e.confidence * 100).toFixed(0)}%</span>` : ''}
              ${e.detail ? `<span class="lineage-detail-text">${escapeHtml(e.detail)}</span>` : ''}
            </li>
          `).join('');
        } else {
          list.innerHTML = '<li style="color:#a0a0b0">No lineage recorded</li>';
        }
        list.dataset.loaded = 'true';
      }
    } catch (e) {
      list.innerHTML = '<li style="color:#991b1b">Failed to load lineage</li>';
    }
  }

  list.style.display = 'block';
  list.previousElementSibling.textContent = 'Hide stage lineage';
}

// Hide tooltip on click outside
document.addEventListener('click', (e) => {
  if (!e.target.closest('.annotation-span') && !e.target.closest('.concept-tooltip')) {
    document.getElementById('tooltip').classList.remove('visible');
  }
});

// --- Insights panel ---

let _insightsScope = 'job'; // 'job' or 'all'

async function loadInsights() {
  const panel = document.getElementById('insightsPanel');
  if (!panel) return;

  const url = _insightsScope === 'job' && currentJobId
    ? `${API}/feedback/insights/${currentJobId}`
    : `${API}/feedback/insights`;

  panel.innerHTML = '<div class="insights-empty">Loading...</div>';

  try {
    const resp = await fetch(url);
    if (!resp.ok) throw new Error('Failed to load');
    const data = await resp.json();
    renderInsightsPanel(data);
  } catch (e) {
    panel.innerHTML = '<div class="insights-empty">Failed to load insights</div>';
  }
}

function renderInsightsPanel(data) {
  const panel = document.getElementById('insightsPanel');

  if (data.total_feedback === 0) {
    panel.innerHTML = `
      <div class="insights-header">
        <h3>Feedback &amp; Insights</h3>
        <div class="insights-actions">
          ${renderScopeToggle()}
        </div>
      </div>
      <div class="insights-empty">
        No feedback yet. Click an annotation and use the thumbs up/down buttons to rate it.
      </div>
    `;
    return;
  }

  // Stats summary
  const totalPct = data.total_feedback > 0
    ? ((data.thumbs_up / data.total_feedback) * 100).toFixed(0) : 0;

  // Stage breakdown
  let stageHtml = '';
  const stages = Object.entries(data.by_stage || {});
  if (stages.length > 0) {
    stageHtml = stages.map(([stage, counts]) => {
      const total = (counts.up || 0) + (counts.down || 0);
      const upPct = total > 0 ? ((counts.up || 0) / total) * 100 : 0;
      return `
        <div class="insights-stage-row">
          <span class="insights-stage-name">${escapeHtml(stage)}</span>
          <span class="insights-stage-counts">
            <span class="insights-rating-up">${counts.up || 0}</span> /
            <span class="insights-rating-down">${counts.down || 0}</span>
          </span>
          <div class="insights-bar" style="flex:1">
            <div class="insights-bar-up" style="width:${upPct}%"></div>
            <div class="insights-bar-down" style="width:${100 - upPct}%"></div>
          </div>
        </div>
      `;
    }).join('');
  }

  // Most downvoted concepts
  let downvotedHtml = '';
  if (data.most_downvoted_concepts && data.most_downvoted_concepts.length > 0) {
    downvotedHtml = `
      <div class="insights-section">
        <div class="insights-section-title">Most downvoted concepts</div>
        <table class="insights-table">
          <thead><tr><th>Concept</th><th>Downvotes</th></tr></thead>
          <tbody>
            ${data.most_downvoted_concepts.map(c => `
              <tr>
                <td>${escapeHtml(c.folio_label || '')}</td>
                <td><span class="insights-rating-down">${c.downvotes}</span></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    `;
  }

  // Recent feedback entries
  let recentHtml = '';
  if (data.recent_feedback && data.recent_feedback.length > 0) {
    recentHtml = `
      <div class="insights-section">
        <div class="insights-section-title">Recent feedback</div>
        <table class="insights-table">
          <thead><tr><th>Annotation</th><th>Rating</th><th>Details</th></tr></thead>
          <tbody>
            ${data.recent_feedback.map(fb => {
              const stageLabels = {
                entity_ruler: 'Entity Ruler',
                semantic_ruler: 'Semantic Ruler',
                llm_concept: 'LLM Analysis',
                reconciliation: 'Reconciliation',
                resolution: 'Resolution',
                branch_judge: 'Branch Judge',
                string_matching: 'String Matching',
              };
              const lineageHtml = (fb.lineage && fb.lineage.length > 0)
                ? `<div class="insights-lineage-detail">${fb.lineage.map(e => {
                    const label = stageLabels[e.stage] || e.stage;
                    const actionClass = 'act-' + (e.action || '').replace(/\s+/g, '_');
                    const confHtml = (e.confidence != null)
                      ? `<span class="lineage-confidence">${(e.confidence * 100).toFixed(0)}%</span>`
                      : '';
                    const detailHtml = e.detail
                      ? `<span class="lineage-detail-text">${escapeHtml(e.detail)}</span>`
                      : '';
                    return `<div class="lineage-stage">
                      <span class="lineage-stage-name">${escapeHtml(label)}</span>
                      <span class="lineage-action ${actionClass}">${escapeHtml(e.action || '')}</span>
                      ${confHtml}${detailHtml}
                    </div>`;
                  }).join('')}</div>`
                : '';
              return `
                <tr>
                  <td>
                    <span class="insights-concept-label">${escapeHtml(fb.annotation_text || '')}</span>
                    ${fb.folio_label && fb.folio_label !== fb.annotation_text ? `<br><span class="insights-concept-sub">${escapeHtml(fb.folio_label)}</span>` : ''}
                  </td>
                  <td style="text-align:center">
                    <span class="${fb.rating === 'up' ? 'insights-rating-up' : 'insights-rating-down'}">
                      ${fb.rating === 'up' ? '&#x1F44D;' : '&#x1F44E;'}
                    </span>
                  </td>
                  <td>
                    ${fb.comment ? `<div class="insights-comment">${escapeHtml(fb.comment)}</div>` : ''}
                    ${fb.stage ? `<div style="font-size:11px;color:var(--text-dim);margin-top:4px">Stage: ${escapeHtml(fb.stage)}</div>` : ''}
                    ${lineageHtml}
                  </td>
                </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      </div>
    `;
  }

  panel.innerHTML = `
    <div class="insights-header">
      <h3>Feedback &amp; Insights</h3>
      <div class="insights-actions">
        ${renderScopeToggle()}
        <button class="small secondary" onclick="exportFeedback('json')">Export JSON</button>
        <button class="small secondary" onclick="exportFeedback('csv')">Export CSV</button>
        <button class="small secondary" style="color:#f87171;border-color:#f87171" onclick="clearAllFeedback()">Clear All</button>
      </div>
    </div>
    <div class="insights-stats">
      <div class="insights-stat">
        <div class="insights-stat-value">${data.total_feedback}</div>
        <div class="insights-stat-label">Total</div>
      </div>
      <div class="insights-stat stat-up">
        <div class="insights-stat-value">${data.thumbs_up}</div>
        <div class="insights-stat-label">Thumbs Up</div>
      </div>
      <div class="insights-stat stat-down">
        <div class="insights-stat-value">${data.thumbs_down}</div>
        <div class="insights-stat-label">Thumbs Down</div>
      </div>
      <div class="insights-stat">
        <div class="insights-stat-value">${totalPct}%</div>
        <div class="insights-stat-label">Positive</div>
      </div>
    </div>
    ${stages.length > 0 ? `
      <div class="insights-section">
        <div class="insights-section-title">By pipeline stage</div>
        ${stageHtml}
      </div>
    ` : ''}
    ${downvotedHtml}
    ${recentHtml}
  `;
}

function renderScopeToggle() {
  const jobActive = _insightsScope === 'job';
  return `
    <button class="small ${jobActive ? 'primary' : 'secondary'}" onclick="_insightsScope='job'; loadInsights()">This Job</button>
    <button class="small ${!jobActive ? 'primary' : 'secondary'}" onclick="_insightsScope='all'; loadInsights()">All Jobs</button>
  `;
}

async function exportFeedback(format) {
  try {
    const resp = await fetch(`${API}/feedback/export?format=${format}`);
    if (!resp.ok) throw new Error('Export failed');
    const blob = await resp.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `feedback.${format}`;
    a.click();
    URL.revokeObjectURL(url);
  } catch (e) {
    alert('Failed to export feedback');
  }
}

async function clearAllFeedback() {
  if (!confirm('Clear all feedback? This cannot be undone.')) return;
  try {
    const resp = await fetch(`${API}/feedback`, { method: 'DELETE' });
    if (resp.ok) {
      Object.keys(_feedbackCache).forEach(k => delete _feedbackCache[k]);
      loadInsights();
    }
  } catch (e) {
    alert('Failed to clear feedback');
  }
}

function renderConceptsList(annotations) {
  const container = document.getElementById('conceptsList');
  if (!annotations.length) {
    container.innerHTML = '<div class="empty-state"><p>No concepts found</p></div>';
    return;
  }

  // Deduplicate and group by branch
  const conceptMap = new Map();
  for (const ann of annotations) {
    for (const c of ann.concepts) {
      const key = c.folio_iri || c.concept_text;
      if (conceptMap.has(key)) {
        conceptMap.get(key).count++;
      } else {
        conceptMap.set(key, { ...c, count: 1 });
      }
    }
  }

  // Group by branch
  const groups = {};
  for (const c of conceptMap.values()) {
    const branch = (c.branches && c.branches.length > 0) ? c.branches[0] : (c.branch || 'Other');
    if (!groups[branch]) groups[branch] = [];
    groups[branch].push(c);
  }

  // Sort branches, then concepts within each branch by count
  const sortedBranches = Object.keys(groups).sort();
  let html = '';

  for (const branch of sortedBranches) {
    const concepts = groups[branch].sort((a, b) => b.count - a.count);
    const branchColor = BRANCH_COLORS[branch] || '#6b6b80';
    const totalOccurrences = concepts.reduce((s, c) => s + c.count, 0);

    html += `<div class="concept-group">`;
    html += `<div class="concept-group-header" style="color:${branchColor}">
      ${escapeHtml(branch)}
      <span class="concept-group-count">${concepts.length} concepts, ${totalOccurrences} occurrences</span>
    </div>`;

    for (const c of concepts) {
      const confPct = c.confidence > 1 ? c.confidence : c.confidence * 100;
      const confTier = confPct >= 80 ? 'conf-high' : confPct >= 50 ? 'conf-mid' : 'conf-low';
      html += `<div class="concept-item">
        <div class="concept-header">
          <span class="concept-name" style="color:${branchColor}">${escapeHtml(c.folio_label || c.concept_text)}</span>
          <span class="confidence-pct ${confTier}">${confPct.toFixed(0)}%</span>
        </div>
        <div class="concept-meta">${c.count} occurrence${c.count > 1 ? 's' : ''} &middot; ${escapeHtml(c.source || 'unknown')}</div>
        <div class="confidence-bar"><div class="confidence-fill ${confTier}" style="width:${Math.min(confPct, 100)}%"></div></div>
      </div>`;
    }

    html += '</div>';
  }

  container.innerHTML = html;
}

function renderTriples(triples) {
  const container = document.getElementById('triplesList');
  if (!triples || !triples.length) {
    container.innerHTML = '<div class="empty-state"><p>No triples extracted</p></div>';
    return;
  }

  let html = `<p style="font-size:12px;color:#6b6b80;margin-bottom:12px">${triples.length} Subject-Predicate-Object triples extracted from dependency parsing:</p>`;
  html += '<div style="font-size:12px">';

  for (const t of triples) {
    html += `<div style="padding:8px;border:1px solid #d0d0da;border-radius:6px;margin-bottom:4px">
      <span style="color:#1a7a7a;font-weight:600">${escapeHtml(t.subject || '')}</span>
      <span style="color:#6b6b80"> \u2192 </span>
      <span style="color:#9e6b0a">${escapeHtml(t.predicate || '')}</span>
      <span style="color:#6b6b80"> \u2192 </span>
      <span style="color:#6b3fa0;font-weight:600">${escapeHtml(t.object || '')}</span>
      ${t.sentence ? `<div style="font-size:10px;color:#6b6b80;margin-top:4px;font-style:italic">"${escapeHtml(t.sentence.slice(0,120))}${t.sentence.length > 120 ? '...' : ''}"</div>` : ''}
    </div>`;
  }

  html += '</div>';
  container.innerHTML = html;
}

function renderMetadata(metadata, job) {
  const container = document.getElementById('metadataDisplay');
  const fields = metadata.extracted_fields || {};

  let html = '<div class="meta-grid">';
  html += `<div class="meta-key">Job ID</div><div class="meta-value">${escapeHtml(String(job.id))}</div>`;
  html += `<div class="meta-key">Status</div><div class="meta-value">${escapeHtml(job.status)}</div>`;
  html += `<div class="meta-key">Created</div><div class="meta-value">${new Date(job.created_at).toLocaleString()}</div>`;

  if (metadata.document_type) {
    html += `<div class="meta-key">Document Type</div><div class="meta-value">${escapeHtml(metadata.document_type)}</div>`;
  }
  if (metadata.document_type_confidence) {
    const dtcPct = (metadata.document_type_confidence * 100).toFixed(0);
    const dtcTier = dtcPct >= 80 ? 'conf-high' : dtcPct >= 50 ? 'conf-mid' : 'conf-low';
    html += `<div class="meta-key">Type Confidence</div><div class="meta-value"><span class="confidence-badge ${dtcTier}">${dtcPct}%</span></div>`;
  }

  // Statistics
  const resolved = metadata.resolved_concepts || [];
  const ruler = metadata.ruler_concepts || [];
  html += `<div class="meta-key">EntityRuler Matches</div><div class="meta-value">${ruler.length}</div>`;
  html += `<div class="meta-key">Resolved Concepts</div><div class="meta-value">${resolved.length}</div>`;
  html += `<div class="meta-key">Total Annotations</div><div class="meta-value">${(job.result?.annotations || []).length}</div>`;

  const triples = metadata.spo_triples || [];
  if (triples.length) {
    html += `<div class="meta-key">SPO Triples</div><div class="meta-value">${triples.length}</div>`;
  }

  // Areas of Law (post-pipeline assessment)
  const areas = metadata.areas_of_law || [];
  if (areas.length) {
    let aolHtml = '';
    for (const a of areas) {
      const aolPct = typeof a.confidence === 'number' ? (a.confidence > 1 ? a.confidence : a.confidence * 100) : 0;
      const aolTier = aolPct >= 80 ? 'conf-high' : aolPct >= 50 ? 'conf-mid' : 'conf-low';
      aolHtml += `<div class="aol-item">
        <span class="aol-name">${escapeHtml(a.area)}</span>
        <span class="confidence-pct ${aolTier}" style="font-size:11px">${aolPct.toFixed(0)}%</span>
        <div class="confidence-bar"><div class="confidence-fill ${aolTier}" style="width:${Math.min(aolPct, 100)}%"></div></div>
      </div>`;
    }
    html += `<div class="meta-key">Areas of Law</div><div class="meta-value">${aolHtml}</div>`;
  }

  // Extracted fields
  for (const [k, v] of Object.entries(fields)) {
    if (v && !k.startsWith('_')) {
      const display = Array.isArray(v) ? v.join(', ') : typeof v === 'object' ? JSON.stringify(v) : String(v);
      html += `<div class="meta-key">${escapeHtml(k)}</div><div class="meta-value">${escapeHtml(display)}</div>`;
    }
  }

  html += '</div>';
  container.innerHTML = html;
}

function renderExportButtons() {
  const container = document.getElementById('exportButtons');
  if (!currentJobId) {
    container.innerHTML = '<p style="color:#6b6b80;font-size:12px">Complete an enrichment first.</p>';
    return;
  }

  container.innerHTML = EXPORT_FORMATS.map(f =>
    `<button class="secondary export-btn" onclick="exportFormat('${f.name}', '${f.ext}')">
      ${f.label}<span class="ext">${f.ext}</span>
    </button>`
  ).join('');
}

async function exportFormat(format, ext) {
  if (!currentJobId) return;
  try {
    const r = await fetch(`${API}/enrich/${currentJobId}/export?format=${format}`);
    if (!r.ok) {
      const err = await r.json().catch(() => ({ detail: r.statusText }));
      throw new Error(err.detail || 'Export failed');
    }
    const blob = await r.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `folio-enrich-${currentJobId.slice(0,8)}${ext}`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  } catch (e) {
    alert(`Export failed: ${e.message}`);
  }
}

// ==============================================
// Synthetic Document Generator
// ==============================================

async function openSynthetic() {
  document.getElementById('syntheticModal').classList.add('visible');
  await loadDocTypes();
}

function closeSynthetic() {
  document.getElementById('syntheticModal').classList.remove('visible');
}

async function loadDocTypes() {
  const tree = document.getElementById('docTypeTree');
  try {
    const r = await fetch(`${API}/synthetic/types`);
    if (!r.ok) throw new Error();
    const data = await r.json();
    const types = data.types || {};

    let html = '';
    for (const [category, subtypes] of Object.entries(types)) {
      const catId = category.replace(/[^a-zA-Z]/g, '');
      html += `<div class="doc-type-category" onclick="toggleDocCategory('${catId}', '${escapeAttr(category)}')">
        <span class="arrow" id="arrow-${catId}">&#9654;</span>
        <strong>${escapeHtml(category)}</strong>
      </div>`;
      html += `<div class="doc-type-subtypes" id="subtypes-${catId}">`;
      if (Array.isArray(subtypes)) {
        for (const st of subtypes) {
          html += `<div class="doc-type-subtype" onclick="selectDocType(this, '${escapeAttr(st)}')">${escapeHtml(st)}</div>`;
        }
      }
      html += '</div>';
    }

    tree.innerHTML = html;
  } catch (e) {
    tree.innerHTML = '<p style="color:#6b6b80">Failed to load document types. Make sure the backend is running.</p>';
  }
}

function toggleDocCategory(catId, category) {
  const subtypes = document.getElementById(`subtypes-${catId}`);
  const arrow = document.getElementById(`arrow-${catId}`);

  if (subtypes.classList.contains('open')) {
    subtypes.classList.remove('open');
    arrow.style.transform = 'rotate(0deg)';
  } else {
    subtypes.classList.add('open');
    arrow.style.transform = 'rotate(90deg)';
    // If clicking category directly (not expanding), select it
    if (!selectedDocType) {
      selectedDocType = category;
    }
  }
}

function selectDocType(el, type) {
  document.querySelectorAll('.doc-type-subtype').forEach(s => s.classList.remove('selected'));
  el.classList.add('selected');
  selectedDocType = type;
}

async function generateSynthetic() {
  if (!selectedDocType) {
    alert('Please select a document type first.');
    return;
  }

  const length = document.querySelector('input[name="synLength"]:checked')?.value || 'medium';
  const jurisdiction = document.getElementById('synJurisdiction').value;
  const btn = document.getElementById('generateBtn');

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Generating...';

  try {
    const r = await fetch(`${API}/synthetic`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ doc_type: selectedDocType, length, jurisdiction }),
    });

    if (!r.ok) {
      const err = await r.json().catch(() => ({ detail: r.statusText }));
      throw new Error(err.detail || 'Generation failed');
    }

    const data = await r.json();
    document.getElementById('docInput').value = data.document;
    uploadedFilename = null;
    closeSynthetic();

    // Auto-enrich
    submitEnrichment();
  } catch (e) {
    alert('Generation failed: ' + e.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'Generate & Annotate';
  }
}

// ==============================================
// UI Controls
// ==============================================

function toggleCollapsible(header) {
  header.classList.toggle('open');
  const body = header.nextElementSibling;
  body.classList.toggle('open');
}

function switchTab(tabEl, name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  tabEl.classList.add('active');
  document.getElementById(`tab-${name}`).classList.add('active');
}

function toggleUncertain() {
  showUncertain = document.getElementById('hideUncertainToggle').checked;
  // Re-render if we have results
  if (currentJob) renderAnnotatedText(
    currentJob.result?.canonical_text?.full_text || '',
    currentJob.result?.annotations || []
  );
}

function loadSample(name) {
  document.getElementById('docInput').value = SAMPLES[name] || '';
  uploadedFilename = null;
}

function clearAll() {
  clearCache();
  document.getElementById('docInput').value = '';
  document.getElementById('docInput').placeholder = 'Paste your legal document text here...';
  document.getElementById('annotatedText').innerHTML = '';
  document.getElementById('annotatedText').style.display = 'none';
  document.getElementById('emptyState').style.display = 'block';
  document.getElementById('conceptsList').innerHTML = '';
  document.getElementById('triplesList').innerHTML = '';
  document.getElementById('metadataDisplay').innerHTML = '';
  document.getElementById('exportButtons').innerHTML = '';
  document.getElementById('tooltip').classList.remove('visible');
  currentJobId = null;
  currentJob = null;
  uploadedFilename = null;
  closeSSE();
  accumulatedAnnotations = [];
  activityEntries = [];
  document.getElementById('activityLog').innerHTML = '';
  stopPolling();
  setStatus('Ready', 'idle');
  renderProgressStages('pending');

  // Reset to first tab
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelector('.tab[data-tab="annotated"]').classList.add('active');
  document.getElementById('tab-annotated').classList.add('active');
}

function setStatus(text, state) {
  document.getElementById('statusText').textContent = text;
  const badge = document.getElementById('statusBadge');
  const colorMap = { running: 'var(--accent)', completed: 'var(--green)', failed: 'var(--red)', idle: 'var(--text-dim)' };
  badge.style.color = colorMap[state] || 'var(--text-dim)';
  badge.textContent = state;
}

// ==============================================
// Utilities
// ==============================================

function escapeHtml(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function escapeAttr(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) overlay.classList.remove('visible');
  });
});

// ==============================================
// Init
// ==============================================

init();
</script>
</body>
</html>
